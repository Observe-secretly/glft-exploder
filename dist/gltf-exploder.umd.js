/*!
 * gltf-exploder v0.1.1
 * (c) 2026 limin
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/examples/jsm/loaders/GLTFLoader.js"),require("three/examples/jsm/controls/OrbitControls.js")):"function"==typeof define&&define.amd?define(["exports","three","three/examples/jsm/loaders/GLTFLoader.js","three/examples/jsm/controls/OrbitControls.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GLTFExploder={},e.THREE,e.THREE.GLTFLoader,e.THREE.OrbitControls)}(this,function(e,t,i,n){"use strict";var s;!function(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===i&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(":root{--exploder-accent:#2563eb;--exploder-bg-main:#fff;--exploder-bg-sub:#f9fafb;--exploder-border:#e5e7eb;--exploder-text-main:#1f2937;--exploder-text-sub:#6b7280;--exploder-text-muted:#9ca3af}.exploder-ui-root{color:var(--exploder-text-main);font-family:Satoshi,Inter,-apple-system,sans-serif}.exploder-viewport-grid{background-image:linear-gradient(90deg,rgba(0,0,0,.03) 1px,transparent 0),linear-gradient(180deg,rgba(0,0,0,.03) 1px,transparent 0);background-size:40px 40px}.exploder-status-dot{background-color:#10b981;border-radius:50%;display:inline-block;height:8px;width:8px}.exploder-animate-pulse{animation:exploder-pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes exploder-pulse{0%,to{opacity:1}50%{opacity:.5}}.exploder-scrollbar::-webkit-scrollbar{width:4px}.exploder-scrollbar::-webkit-scrollbar-thumb{background:var(--exploder-border);border-radius:10px}.exploder-slider{-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;width:100%}.exploder-slider::-webkit-slider-runnable-track{background:#f3f4f6;border-radius:2px;height:4px}.exploder-slider::-webkit-slider-thumb{-webkit-appearance:none;background:var(--exploder-accent);border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.1);height:16px;margin-top:-6px;width:16px}.exploder-mode-btn{align-items:center;background:var(--exploder-bg-sub);border:1px solid transparent;border-radius:12px;color:var(--exploder-text-sub);cursor:pointer;display:flex;flex-direction:column;font-size:12px;font-weight:600;gap:6px;padding:10px;transition:all .2s}.exploder-mode-btn:hover{border-color:var(--exploder-border)}.exploder-mode-btn.active{background:#eff6ff;border-color:#bfdbfe;color:var(--exploder-accent)}.exploder-card{backdrop-filter:blur(12px);background:hsla(0,0%,100%,.9);border:1px solid rgba(229,231,235,.5);border-radius:16px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}"),function(e){e.RADIAL="radial",e.AXIAL="axial",e.NORMALIZED_RADIAL="normalized_radial",e.SIZE_WEIGHTED="size_weighted",e.HIERARCHICAL="hierarchical",e.FORCE_FIELD="force_field"}(s||(s={}));const o={PROGRESS:{DEFAULT:0,MIN:0,MAX:1,STEP:.01},MULTIPLIER:{DEFAULT:1,MIN:.1,MAX:5,STEP:.1},EXPOSURE:{DEFAULT:1,MIN:.1,MAX:6,STEP:.1},DEFAULT_DURATION:1e3,DEFAULT_MAX_DISTANCE:2,DEFAULT_ADAPT_SIZE:5,WEIGHTS:{BASE:.5,SCALE:1.5,FORCE_FIELD_OFFSET:.2},LIGHTS:{SCENE:{AMBIENT:.2,HEMISPHERE:.3,MAIN_DIRECTIONAL:.5,BACK_DIRECTIONAL:.3,SIDE_DIRECTIONAL:.2},INTERNAL:{AMBIENT:.4,HEMISPHERE:.4,DIRECTIONAL:.8}},DIRECTION:{MIN_LENGTH:.001,ANGLE_FACTOR:.017453292519943295,Z_FACTOR:.5,INDEX_ANGLE:.7853981633974483,XY_OFFSET:.2,Z_OFFSET:.1}};function r(e,i){const n=new t.Vector3;e.getWorldPosition(n);const s=(new t.Vector3).subVectors(n,i);if(s.length()<o.DIRECTION.MIN_LENGTH){const t=function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t%360)}(e.uuid||"");if(s.set(Math.cos(t*o.DIRECTION.ANGLE_FACTOR),Math.sin(t*o.DIRECTION.ANGLE_FACTOR),Math.cos(t*o.DIRECTION.Z_FACTOR)),e.parent){const t=e.parent.children.indexOf(e);t>=0&&(s.x+=Math.cos(t*o.DIRECTION.INDEX_ANGLE)*o.DIRECTION.XY_OFFSET,s.y+=Math.sin(t*o.DIRECTION.INDEX_ANGLE)*o.DIRECTION.XY_OFFSET,s.z+=(t%3-1)*o.DIRECTION.Z_OFFSET)}}return s.normalize()}function l(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error(`找不到容器元素: ${e}`);return t}return e}function a(e,t,i){return Math.max(t,Math.min(i,e))}class h{constructor(e,i,n,l,a={}){this.progress=o.PROGRESS.DEFAULT,this.multiplier=o.MULTIPLIER.DEFAULT,this.mode=s.RADIAL,this.originalPositions=new Map,this.originalRotations=new Map,this.originalScales=new Map,this.explodeDirections=new Map,this.axialDistances=new Map,this.sizeWeights=new Map,this.hierarchicalDepths=new Map,this.modelRadius=1,this.onProgressChangeCallback=null,this.explodableMeshes=[],this.internalLights=[],this.model=e,this.scene=i,this.camera=n,this.renderer=l,this.options={maxDistance:a.maxDistance??o.DEFAULT_MAX_DISTANCE,duration:a.duration??o.DEFAULT_DURATION,createUI:a.createUI??!0,viewport:a.viewport??document.body,container:a.container??document.body,uiType:a.uiType??"slider",hudContainer:a.hudContainer??document.body,uiStyle:a.uiStyle??{width:"200px",height:"30px",position:"bottom"},directionStrategy:a.directionStrategy??r,mode:a.mode??s.RADIAL,axialVector:a.axialVector??new t.Vector3(0,1,0),adaptModel:a.adaptModel??!0,model:a.model??e,models:a.models??[],initialModel:a.initialModel??""},this.mode=this.options.mode,this.options.adaptModel&&this.adaptModelToScene();const h=(new t.Box3).setFromObject(this.model);this.modelCenter=h.getCenter(new t.Vector3);const d=h.getBoundingSphere(new t.Sphere);this.modelRadius=d.radius||1,this.saveOriginalTransforms(this.model),this.setupInternalLighting()}adaptModelToScene(){const e=(new t.Box3).setFromObject(this.model).getSize(new t.Vector3),i=Math.max(e.x,e.y,e.z);if(i>0){const e=o.DEFAULT_ADAPT_SIZE/i;this.model.scale.multiplyScalar(e);const n=(new t.Box3).setFromObject(this.model).getCenter(new t.Vector3);this.model.position.sub(n)}}setupInternalLighting(){const e=new t.AmbientLight(16777215,o.LIGHTS.INTERNAL.AMBIENT);this.scene.add(e),this.internalLights.push(e);const i=new t.HemisphereLight(16777215,4473924,o.LIGHTS.INTERNAL.HEMISPHERE);this.scene.add(i),this.internalLights.push(i);const n=3*this.modelRadius;[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]].forEach(([e,i,s])=>{const r=new t.DirectionalLight(16777215,o.LIGHTS.INTERNAL.DIRECTIONAL);r.position.set(this.modelCenter.x+e*n,this.modelCenter.y+i*n,this.modelCenter.z+s*n),r.target=this.model,this.scene.add(r),this.internalLights.push(r)})}setInternalLightingVisible(e){this.internalLights.forEach(t=>{t.visible=e}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}setInternalLightingExposure(e){this.internalLights.forEach(i=>{i instanceof t.AmbientLight?i.intensity=o.LIGHTS.INTERNAL.AMBIENT*e:i instanceof t.HemisphereLight?i.intensity=o.LIGHTS.INTERNAL.HEMISPHERE*e:i instanceof t.DirectionalLight&&(i.intensity=o.LIGHTS.INTERNAL.DIRECTIONAL*e)}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}calculateAxialDistances(){const e=this.options.axialVector.clone().normalize(),i=(new t.Box3).setFromObject(this.model),n=i.min.dot(e),s=i.max.dot(e),o=Math.abs(s-n),r=o>1e-4?1/o:1;for(const t of this.explodableMeshes){const i=this.originalPositions.get(t);if(i){const n=i.clone().sub(this.modelCenter).dot(e);this.axialDistances.set(t,n*r)}}}saveOriginalTransforms(e){this.traverseAndSave(e),this.calculateAxialDistances(),this.calculateSizeWeights(),this.calculateHierarchicalDepths()}calculateHierarchicalDepths(){let e=0;const t=new Map;for(const i of this.explodableMeshes){let n=0,s=i.parent;for(;s&&s!==this.model;)n++,s=s.parent;t.set(i,n),e=Math.max(e,n)}const i=e>0?1/e:1;for(const[e,n]of t)this.hierarchicalDepths.set(e,o.WEIGHTS.BASE+n*i*o.WEIGHTS.SCALE)}calculateSizeWeights(){let e=0;const i=new Map;for(const n of this.explodableMeshes)if(n instanceof t.Mesh){const s=n.geometry;s.boundingBox||s.computeBoundingBox();const o=s.boundingBox;if(o){const s=new t.Vector3;o.getSize(s);const r=s.x*s.y*s.z;i.set(n,r),e=Math.max(e,r)}}const n=e>0?1/e:1;for(const[e,t]of i)this.sizeWeights.set(e,o.WEIGHTS.BASE+t*n*o.WEIGHTS.SCALE)}traverseAndSave(e){if(!e.visible)return;const i=new t.Vector3;if(e.getWorldPosition(i),this.originalPositions.set(e,i.clone()),e.rotation&&this.originalRotations.set(e,e.rotation.clone()),e.scale&&this.originalScales.set(e,e.scale.clone()),"isMesh"in e&&!0===e.isMesh){this.explodableMeshes.push(e);const t=this.options.directionStrategy(e,this.modelCenter);this.explodeDirections.set(e,t)}e.children.forEach(e=>{this.traverseAndSave(e)})}setModel(e){this.reset(),this.model=e,this.options.adaptModel&&this.adaptModelToScene();const i=(new t.Box3).setFromObject(this.model);this.modelCenter=i.getCenter(new t.Vector3);const n=i.getBoundingSphere(new t.Sphere);this.modelRadius=n.radius||1,this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.saveOriginalTransforms(this.model),this.updateInternalLighting(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateInternalLighting(){const e=3*this.modelRadius,i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],n=this.internalLights.filter(e=>e instanceof t.DirectionalLight);n.length===i.length?n.forEach((t,n)=>{const[s,o,r]=i[n];t.position.set(this.modelCenter.x+s*e,this.modelCenter.y+o*e,this.modelCenter.z+r*e),t.target=this.model}):(this.internalLights.forEach(e=>{this.scene.remove(e),e.dispose&&e.dispose()}),this.internalLights=[],this.setupInternalLighting())}setProgress(e){this.progress=a(e,o.PROGRESS.MIN,o.PROGRESS.MAX),this.updateExplodedPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress),this.renderer.render(this.scene,this.camera)}updateExplodedPositions(){for(const e of this.explodableMeshes){const t=this.originalPositions.get(e),i=this.explodeDirections.get(e);if(t&&i){const n=this.modelRadius*this.options.maxDistance*this.progress*this.multiplier,r=t.clone();switch(this.mode){case s.RADIAL:r.add(i.clone().multiplyScalar(n));break;case s.AXIAL:{const t=this.axialDistances.get(e)||0,i=this.options.axialVector.clone().normalize();r.add(i.multiplyScalar(t*this.modelRadius*this.options.maxDistance*this.progress*this.multiplier));break}case s.NORMALIZED_RADIAL:{const e=t.clone().sub(this.modelCenter);r.add(e.multiplyScalar(this.options.maxDistance*this.progress*this.multiplier));break}case s.SIZE_WEIGHTED:{const t=this.sizeWeights.get(e)||1;r.add(i.clone().multiplyScalar(n*t));break}case s.HIERARCHICAL:{const t=this.hierarchicalDepths.get(e)||1;r.add(i.clone().multiplyScalar(n*t));break}case s.FORCE_FIELD:{const t=this.originalPositions.get(e);if(t){const e=1/(t.clone().sub(this.modelCenter).length()/this.modelRadius+o.WEIGHTS.FORCE_FIELD_OFFSET);r.add(i.clone().multiplyScalar(n*e))}break}}e.parent&&e.parent.worldToLocal(r),e.position.copy(r)}}}setMode(e){this.mode=e,this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMode(){return this.mode}setAxialVector(e){this.options.axialVector.copy(e),this.calculateAxialDistances(),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getAxialVector(){return this.options.axialVector}reset(){this.progress=0,this.resetToOriginalPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress)}resetToOriginalPositions(){for(const e of this.explodableMeshes){const t=this.originalPositions.get(e),i=this.originalRotations.get(e),n=this.originalScales.get(e);if(t){const i=t.clone();e.parent&&e.parent.worldToLocal(i),e.position.copy(i)}i&&e.rotation&&e.rotation.set(i.x,i.y,i.z),n&&e.scale&&e.scale.set(n.x,n.y,n.z)}}setProgressChangeCallback(e){this.onProgressChangeCallback=e}setMultiplier(e){this.multiplier=a(e,o.MULTIPLIER.MIN,o.MULTIPLIER.MAX),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMultiplier(){return this.multiplier}getProgress(){return this.progress}getModelCenter(){return this.modelCenter.clone()}getOptions(){return this.options}dispose(){this.internalLights.forEach(e=>{this.scene.remove(e),e.dispose&&e.dispose()}),this.internalLights=[],this.reset(),this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.onProgressChangeCallback=null}}class d{constructor(e,t,i=o.PROGRESS.DEFAULT,n={}){this.handleSliderChange=e=>{const t=parseFloat(e.target.value);this.onProgressChange(t)},this.handleReset=()=>{this.update(0),this.onProgressChange(0)},this.onProgressChange=t,this.styles={container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 320px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 32px;\n      padding: 24px;\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 20px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 16px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    "},this.element=document.createElement("div");!e||e===document.body||"body"===e?this.applyStyle(this.element,this.styles.container):this.applyStyle(this.element,"\n        width: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        border-radius: 4px;\n        padding: 12px 16px;\n        color: #ffffff;\n        font-family: -apple-system, sans-serif;\n        box-sizing: border-box;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      "),this.label=document.createElement("label"),this.label.textContent="爆炸视图",this.applyStyle(this.label,this.styles.label),this.element.appendChild(this.label),this.slider=document.createElement("input"),this.slider.type="range",this.slider.min=o.PROGRESS.MIN.toString(),this.slider.max=o.PROGRESS.MAX.toString(),this.slider.step=o.PROGRESS.STEP.toString(),this.slider.value=i.toString(),this.applyStyle(this.slider,this.styles.slider),this.element.appendChild(this.slider),this.resetButton=document.createElement("button"),this.resetButton.textContent="重置",this.applyStyle(this.resetButton,this.styles.button),this.element.appendChild(this.resetButton),this.slider.addEventListener("input",this.handleSliderChange),this.resetButton.addEventListener("click",this.handleReset);const s="string"==typeof e?document.querySelector(e):e;s?s.appendChild(this.element):document.body.appendChild(this.element)}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}updateHelperVisibility(e){}update(e){this.slider.value=e.toString()}dispose(){this.slider.removeEventListener("input",this.handleSliderChange),this.resetButton.removeEventListener("click",this.handleReset),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=t.replace(/\s+/g," ").trim();e.style.cssText=i}}class p{constructor(e,i,n,r,l,a,h,d=o.MULTIPLIER.DEFAULT,p=o.EXPOSURE.DEFAULT,c=s.RADIAL,u=new t.Vector3(0,1,0),m=!0,x=[],g,y={}){this.modeButtons=new Map,this.onMultiplierChange=i,this.onExposureChange=n,this.onModeChange=r,this.onAxialChange=l,this.onModelChange=a,this.onHelperVisibilityChange=h,this.styles={container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 320px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 32px;\n      padding: 24px;\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 20px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 16px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    "},this.element=document.createElement("aside"),this.element.className="exploder-ui-root exploder-card exploder-scrollbar",this.applyStyle(this.element,this.styles.container);const b=document.createElement("div");this.applyStyle(b,this.styles.sectionHeader),b.innerHTML=`\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M2 12h20M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10 10 10 0 0 1-10-10 10 10 0 0 1 10-10z"/></svg>\n      <h3 style="${this.styles.title}">参数控制面板</h3>\n    `,this.element.appendChild(b);const E=document.createElement("div");if(this.applyStyle(E,"display: flex; flex-direction: column; gap: 32px; flex: 1;"),this.element.appendChild(E),x&&x.length>0){const e=this.createSection("模型资源","选择需要展示的 3D 资产"),t=document.createElement("select");this.modelSelect=t,t.className="exploder-select",this.applyStyle(t,this.styles.select),x.forEach(e=>{const i=document.createElement("option"),n="string"==typeof e?e:e.value;i.value=n,i.textContent="string"==typeof e?e.split("/").pop()||e:e.label,n===g&&(i.selected=!0),t.appendChild(i)}),e.appendChild(t),E.appendChild(e)}const f=this.createSection("爆炸系数","调整组件之间分离的距离倍数"),S=this.createLabelWrapper("分离倍数");this.multiplierDisplay=document.createElement("span"),this.multiplierDisplay.className="exploder-value",this.applyStyle(this.multiplierDisplay,this.styles.value),this.multiplierDisplay.textContent=`${d.toFixed(1)}x`,S.appendChild(this.multiplierDisplay),f.insertBefore(S,f.firstChild),this.multiplierSlider=document.createElement("input"),this.multiplierSlider.type="range",this.multiplierSlider.className="exploder-slider",this.multiplierSlider.min=o.MULTIPLIER.MIN.toString(),this.multiplierSlider.max=o.MULTIPLIER.MAX.toString(),this.multiplierSlider.step=o.MULTIPLIER.STEP.toString(),this.multiplierSlider.value=d.toString(),this.applyStyle(this.multiplierSlider,this.styles.slider),f.appendChild(this.multiplierSlider),E.appendChild(f);const C=this.createSection("环境亮度","调整 3D 场景的光照表现"),M=this.createLabelWrapper("渲染亮度");this.exposureDisplay=document.createElement("span"),this.exposureDisplay.className="exploder-value",this.applyStyle(this.exposureDisplay,this.styles.value),this.exposureDisplay.textContent=p.toFixed(1),M.appendChild(this.exposureDisplay),C.insertBefore(M,C.firstChild),this.exposureSlider=document.createElement("input"),this.exposureSlider.type="range",this.exposureSlider.className="exploder-slider",this.exposureSlider.min=o.EXPOSURE.MIN.toString(),this.exposureSlider.max=o.EXPOSURE.MAX.toString(),this.exposureSlider.step=o.EXPOSURE.STEP.toString(),this.exposureSlider.value=p.toString(),this.applyStyle(this.exposureSlider,this.styles.slider),C.appendChild(this.exposureSlider),E.appendChild(C);const L=this.createSection("爆炸模式","选择不同的组件分离算法"),v=document.createElement("div");this.applyStyle(v,this.styles.grid);[{id:s.RADIAL,label:"径向模式",icon:"M12 3v3m0 12v3M3 12h3m12 0h3M5.6 5.6l2.1 2.1m8.6 8.6l2.1 2.1M5.6 18.4l2.1-2.1m8.6-8.6l2.1-2.1"},{id:s.NORMALIZED_RADIAL,label:"归一化径向",icon:"M21 3h-6M3 21h6M3 3v6M21 21v-6M3 3l7.5 7.5M21 21l-7.5-7.5"},{id:s.AXIAL,label:"轴向模式",icon:"M7 7h10M7 12h10M7 17h10"},{id:s.FORCE_FIELD,label:"力场式",icon:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0 M12 12m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0"},{id:s.SIZE_WEIGHTED,label:"尺寸加权",icon:"M3 6h18M7 12h10M10 18h4"},{id:s.HIERARCHICAL,label:"装配树级",icon:"M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"}].forEach(e=>{const t=document.createElement("div");t.className="exploder-mode-btn "+(c===e.id?"active":""),t.innerHTML=`\n        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="${e.icon}"/></svg>\n        <span>${e.label}</span>\n      `,t.onclick=()=>this.handleModeClick(e.id),v.appendChild(t),this.modeButtons.set(e.id,t)}),L.appendChild(v),this.axialContainer=document.createElement("div"),this.applyStyle(this.axialContainer,"margin-top: 12px; display: "+(c===s.AXIAL?"block":"none")),this.axialSelect=document.createElement("select"),this.applyStyle(this.axialSelect,this.styles.select),[{v:"0,1,0",l:"Y 轴 (垂直)"},{v:"1,0,0",l:"X 轴 (横向)"},{v:"0,0,1",l:"Z 轴 (纵向)"}].forEach(e=>{const t=document.createElement("option");t.value=e.v,t.textContent=e.l,e.v===`${u.x},${u.y},${u.z}`&&(t.selected=!0),this.axialSelect.appendChild(t)}),this.axialContainer.appendChild(this.axialSelect),L.appendChild(this.axialContainer),E.appendChild(L);const A=this.createSection("辅助视图","控制场景辅助元素的显示"),I=document.createElement("label");this.applyStyle(I,"display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none;"),this.helperToggle=document.createElement("input"),this.helperToggle.type="checkbox",this.helperToggle.checked=m,this.helperToggle.style.width="16px",this.helperToggle.style.height="16px",this.helperToggle.style.accentColor="var(--exploder-accent)",I.appendChild(this.helperToggle);const T=document.createElement("span");T.textContent="显示网格与坐标轴标签",this.applyStyle(T,"font-size: 12px; font-weight: 500; color: var(--exploder-text-sub);"),I.appendChild(T),A.appendChild(I),E.appendChild(A);const w=document.createElement("div");this.applyStyle(w,"padding-top: 12px; margin-top: auto;"),this.resetButton=document.createElement("button"),this.resetButton.className="exploder-button-reset",this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.innerHTML='\n      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>\n      <span>重置视图与参数</span>\n    ',this.resetButton.onmouseenter=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),this.resetButton.onmouseleave=()=>this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.onmousedown=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetActive),this.resetButton.onmouseup=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),w.appendChild(this.resetButton),this.element.appendChild(w),this.multiplierSlider.oninput=e=>{const t=parseFloat(e.target.value);this.updateMultiplier(t),this.onMultiplierChange(t)},this.exposureSlider.oninput=e=>{const t=parseFloat(e.target.value);this.updateExposure(t),this.onExposureChange?.(t)},this.modelSelect&&(this.modelSelect.onchange=e=>this.onModelChange?.(e.target.value)),this.axialSelect.onchange=e=>{const[i,n,s]=e.target.value.split(",").map(Number);this.onAxialChange?.(new t.Vector3(i,n,s))},this.helperToggle.onchange=e=>this.onHelperVisibilityChange?.(e.target.checked),this.resetButton.onclick=()=>{};(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element)}createSection(e,t){const i=document.createElement("section");this.applyStyle(i,this.styles.section);const n=document.createElement("label");this.applyStyle(n,this.styles.label),n.textContent=e,i.appendChild(n);const s=document.createElement("p");return this.applyStyle(s,this.styles.hint),s.textContent=t,i.appendChild(s),i}createLabelWrapper(e){const t=document.createElement("div");this.applyStyle(t,this.styles.labelContainer);const i=document.createElement("span");return this.applyStyle(i,this.styles.label),i.textContent=e,t.appendChild(i),t}handleModeClick(e){this.updateMode(e),this.onModeChange?.(e)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}show(){this.element.style.display="flex"}hide(){this.element.style.display="none"}update(e){}updateMultiplier(e){this.multiplierSlider.value=e.toString(),this.multiplierDisplay.textContent=`${e.toFixed(1)}x`}updateExposure(e){this.exposureSlider.value=e.toString(),this.exposureDisplay.textContent=e.toFixed(1)}updateMode(e){this.modeButtons.forEach((t,i)=>{i===e?t.classList.add("active"):t.classList.remove("active")}),this.axialContainer&&(this.axialContainer.style.display=e===s.AXIAL?"block":"none")}updateHelperVisibility(e){this.helperToggle&&(this.helperToggle.checked=e)}updateAxialVector(e){this.axialSelect&&(this.axialSelect.value=`${e.x},${e.y},${e.z}`)}dispose(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class c{constructor(e,t,i=o.PROGRESS.DEFAULT){this.onProgressChange=t,this.element=document.createElement("div"),this.element.className="exploder-hud-root",this.applyStyle(this.element,"\n      position: absolute;\n      bottom: 40px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 80%;\n      max-width: 600px;\n      z-index: 100;\n      pointer-events: auto;\n    ");const n=document.createElement("div");n.className="exploder-card",this.applyStyle(n,"\n      display: flex;\n      align-items: center;\n      gap: 20px;\n      padding: 12px 24px;\n      border-radius: 16px;\n      background: rgba(255, 255, 255, 0.9);\n      backdrop-filter: blur(12px);\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n      border: 1px solid rgba(229, 231, 235, 0.5);\n    "),this.element.appendChild(n);const s=document.createElement("div");this.applyStyle(s,"\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    "),n.appendChild(s);const r=document.createElement("div");this.applyStyle(r,"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ");const l=document.createElement("span");l.textContent="当前播放进度",this.applyStyle(l,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),this.valueDisplay=document.createElement("span"),this.valueDisplay.textContent=`${Math.round(100*i)}%`,this.applyStyle(this.valueDisplay,"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-accent);\n    "),r.appendChild(l),r.appendChild(this.valueDisplay),s.appendChild(r),this.slider=document.createElement("input"),this.slider.type="range",this.slider.className="exploder-slider",this.slider.min=o.PROGRESS.MIN.toString(),this.slider.max=o.PROGRESS.MAX.toString(),this.slider.step=o.PROGRESS.STEP.toString(),this.slider.value=i.toString(),this.applyStyle(this.slider,"\n      width: 100%;\n      height: 4px;\n      cursor: pointer;\n    "),s.appendChild(this.slider),this.slider.oninput=e=>{const t=parseFloat(e.target.value);this.update(t),this.onProgressChange(t)};(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element)}update(e){this.slider.value=e.toString(),this.valueDisplay.textContent=`${Math.round(100*e)}%`}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}dispose(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}}class u{constructor(e,t="加载中..."){this.element=document.createElement("div"),this.element.className="exploder-info-hud",this.applyStyle(this.element,"\n      position: absolute;\n      top: 24px;\n      left: 24px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      pointer-events: none;\n      z-index: 100;\n    ");const i=document.createElement("div");i.className="exploder-card",this.applyStyle(i,"\n      padding: 12px 16px;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      pointer-events: auto;\n    ");const n=document.createElement("div");this.applyStyle(n,"\n      width: 40px;\n      height: 40px;\n      background: var(--exploder-accent);\n      color: white;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    "),n.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>';const s=document.createElement("div");this.applyStyle(s,"\n      display: flex;\n      flex-direction: column;\n    "),this.modelNameDisplay=document.createElement("span"),this.modelNameDisplay.textContent=t,this.applyStyle(this.modelNameDisplay,"\n      font-size: 12px;\n      font-weight: 700;\n      color: var(--exploder-text-main);\n      line-height: 1;\n    ");const o=document.createElement("span");o.textContent="GLB 3D 资产已就绪",this.applyStyle(o,"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      font-weight: 700;\n      margin-top: 6px;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),s.appendChild(this.modelNameDisplay),s.appendChild(o),i.appendChild(n),i.appendChild(s),this.element.appendChild(i);const r=document.createElement("div");this.applyStyle(r,"\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.8);\n      backdrop-filter: blur(8px);\n      border: 1px solid rgba(229, 231, 235, 0.5);\n      border-radius: 12px;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n      width: fit-content;\n      pointer-events: auto;\n    ");const l=document.createElement("span");l.className="exploder-status-dot exploder-animate-pulse";const a=document.createElement("span");a.textContent="WebGL 2.0 渲染引擎已启动",this.applyStyle(a,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.02em;\n    "),r.appendChild(l),r.appendChild(a),this.element.appendChild(r);(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element)}setModelName(e){this.modelNameDisplay.textContent=e}dispose(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}}var m;e.UIType=void 0,(m=e.UIType||(e.UIType={})).SLIDER="slider",m.PANEL="panel";class x{constructor(e,i,n,r,l,a,h,d,m,x=o.PROGRESS.DEFAULT,g=o.MULTIPLIER.DEFAULT,y=o.EXPOSURE.DEFAULT,b=s.RADIAL,E=new t.Vector3(0,1,0),f=!0,S,C,M){if(this.element=e,this.panel=new p(e,r,l,a,h,d,m,g,y,b,E,f,S,C,M),this.hud=new c(i,n,x),i){const e=C?C.split("/").pop()||C:"示例模型";this.infoHUD=new u(i,e)}}show(){this.panel.show(),this.hud.show(),this.infoHUD?.element&&(this.infoHUD.element.style.display="flex")}hide(){this.panel.hide(),this.hud.hide(),this.infoHUD?.element&&(this.infoHUD.element.style.display="none")}update(e){this.panel.update(e),this.hud.update(e)}updateMultiplier(e){this.panel.updateMultiplier(e)}updateExposure(e){this.panel.updateExposure(e)}updateMode(e){this.panel.updateMode(e)}updateAxialVector(e){this.panel.updateAxialVector(e)}updateHelperVisibility(e){this.panel.updateHelperVisibility(e)}updateModel(e){if(this.infoHUD){const t=e.split("/").pop()||e;this.infoHUD.setModelName(t)}this.panel.updateModel&&this.panel.updateModel(e)}dispose(){this.panel.dispose(),this.hud.dispose(),this.infoHUD?.dispose()}}e.GLTFExploder=class{constructor(e,i,n,s,o={}){this.core=null,this.ui=null,this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.container=null,e instanceof t.Object3D&&i&&n&&s?(this.options=o,this.renderer=s,this.scene=i,this.camera=n,this.initCore(e,i,n,s,o)):(this.options=e,this.initializeAutoMode())}async initializeAutoMode(){const{viewport:e,model:s}=this.options,r="string"==typeof e?document.querySelector(e):e;this.container=r,this.container||(console.warn("GLTFExploder: 未找到视口容器 (viewport)，将使用 body 作为默认容器"),this.container=document.body),this.scene=new t.Scene,this.scene.background=new t.Color(16777215),this.camera=new t.PerspectiveCamera(45,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.renderer=new t.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.toneMapping=t.ACESFilmicToneMapping,this.renderer.toneMappingExposure=o.EXPOSURE.DEFAULT,this.container.appendChild(this.renderer.domElement),this.controls=new n.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.scene.add(new t.AmbientLight(16777215,.6));const l=new t.DirectionalLight(16777215,1);if(l.position.set(5,10,7.5),this.scene.add(l),"string"==typeof s){(new i.GLTFLoader).load(s,e=>{const t=e.scene;this.scene?.add(t),this.initCore(t,this.scene,this.camera,this.renderer,this.options)})}else s instanceof t.Object3D&&(this.scene.add(s),this.initCore(s,this.scene,this.camera,this.renderer,this.options));this.animate(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){if(!this.container||!this.camera||!this.renderer)return;const e=this.container.clientWidth,i=this.container.clientHeight;this.camera instanceof t.PerspectiveCamera&&(this.camera.aspect=e/i,this.camera.updateProjectionMatrix()),this.renderer.setSize(e,i)}animate(){requestAnimationFrame(this.animate.bind(this)),this.controls&&this.controls.update(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}initCore(i,n,r,a,p){this.core=new h(i,n,r,a,p),!1!==p.createUI&&(this.ui=function(i,n,r,a,h,p,c,u,m=o.PROGRESS.DEFAULT,g=o.MULTIPLIER.DEFAULT,y=o.EXPOSURE.DEFAULT,b=s.RADIAL,E=new t.Vector3(0,1,0),f=!0){if(!1===i.createUI)return null;const S=i.container?l(i.container):document.body;switch(i.uiType||e.UIType.SLIDER){case e.UIType.PANEL:const t=i.hudContainer?l(i.hudContainer):document.body;return new x(S,t,n,r,a,h,p,c,u,m,g,y,b,E,f,i.models,i.initialModel,i.uiStyle);case e.UIType.SLIDER:default:return new d(S,n,m,i.uiStyle)}}(p,this.setProgress.bind(this),this.setMultiplier.bind(this),this.setExposure.bind(this),this.setMode.bind(this),this.setAxialVector.bind(this),this.handleModelChange.bind(this),this.handleHelperVisibilityChange.bind(this),o.PROGRESS.DEFAULT,o.MULTIPLIER.DEFAULT,a.toneMappingExposure,this.core.getMode(),this.core.getAxialVector(),!0))}handleModelChange(e){this.onModelChangeCallback?this.onModelChangeCallback(e):this.container&&this.scene&&this.loadModelAuto(e)}loadModelAuto(e){if(!this.scene)return;(new i.GLTFLoader).load(e,t=>{if(this.core){const e=this.core.model;e&&this.scene?.remove(e),this.core.dispose()}const i=t.scene;this.scene?.add(i),this.initCore(i,this.scene,this.camera,this.renderer,this.options),this.ui&&(this.ui.update(o.PROGRESS.DEFAULT),this.ui.updateModel&&this.ui.updateModel(e))})}handleHelperVisibilityChange(e){this.onHelperVisibilityChangeCallback&&this.onHelperVisibilityChangeCallback(e)}setModelChangeCallback(e){this.onModelChangeCallback=e}setHelperVisibilityChangeCallback(e){this.onHelperVisibilityChangeCallback=e}setModel(e){this.core?.setModel(e)}setInternalLightingVisible(e){this.core?.setInternalLightingVisible(e),this.ui&&this.ui.updateHelperVisibility&&this.ui.updateHelperVisibility(e)}setProgress(e){this.core?.setProgress(e),this.ui&&this.ui.update(e)}setMultiplier(e){this.core?.setMultiplier(e),this.ui&&this.ui.updateMultiplier&&this.ui.updateMultiplier(e)}setExposure(e){this.renderer&&(0===this.renderer.toneMapping&&(this.renderer.toneMapping=3),this.renderer.toneMappingExposure=e,this.core?.setInternalLightingExposure(e),this.ui&&this.ui.updateExposure&&this.ui.updateExposure(e))}setMode(e){this.core?.setMode(e),this.ui&&this.ui.updateMode&&this.ui.updateMode(e)}setAxialVector(e){this.core?.setAxialVector(e),this.ui&&this.ui.updateAxialVector&&this.ui.updateAxialVector(e)}reset(){this.core?.reset(),this.ui&&(this.ui.update(o.PROGRESS.DEFAULT),this.ui.updateMultiplier&&this.ui.updateMultiplier(o.MULTIPLIER.DEFAULT),this.ui.updateMode&&this.ui.updateMode(s.RADIAL))}setProgressChangeCallback(e){this.core?.setProgressChangeCallback(e)}getProgress(){return this.core?.getProgress()||0}showUI(){this.ui&&this.ui.show()}hideUI(){this.ui&&this.ui.hide()}dispose(){this.ui&&(this.ui.dispose(),this.ui=null),this.core?.dispose()}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gltf-exploder.umd.js.map
