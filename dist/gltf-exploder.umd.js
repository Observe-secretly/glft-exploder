/*!
 * gltf-exploder v0.1.5
 * (c) 2026 limin
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/examples/jsm/loaders/GLTFLoader.js"),require("three/examples/jsm/controls/OrbitControls.js")):"function"==typeof define&&define.amd?define(["exports","three","three/examples/jsm/loaders/GLTFLoader.js","three/examples/jsm/controls/OrbitControls.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GLTFExploder={},e.THREE,e.THREE.GLTFLoader,e.THREE.OrbitControls)}(this,function(e,t,i,s){"use strict";var n;!function(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}(":root{--exploder-accent:#2563eb;--exploder-bg-main:#fff;--exploder-bg-sub:#f9fafb;--exploder-border:#e5e7eb;--exploder-text-main:#1f2937;--exploder-text-sub:#6b7280;--exploder-text-muted:#9ca3af}.exploder-ui-root{color:var(--exploder-text-main);font-family:Satoshi,Inter,-apple-system,sans-serif}.exploder-viewport-grid{background-image:linear-gradient(90deg,rgba(0,0,0,.03) 1px,transparent 0),linear-gradient(180deg,rgba(0,0,0,.03) 1px,transparent 0);background-size:40px 40px}.exploder-status-dot{background-color:#10b981;border-radius:50%;display:inline-block;height:8px;width:8px}.exploder-animate-pulse{animation:exploder-pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes exploder-pulse{0%,to{opacity:1}50%{opacity:.5}}.exploder-scrollbar::-webkit-scrollbar{width:4px}.exploder-scrollbar::-webkit-scrollbar-thumb{background:var(--exploder-border);border-radius:10px}.exploder-slider{align-items:center;-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;display:flex;height:32px;width:100%}.exploder-slider::-webkit-slider-runnable-track{background:#f3f4f6;border-radius:3px;height:6px;transition:background .2s}.exploder-slider:active::-webkit-slider-runnable-track{background:#e5e7eb}.exploder-slider::-webkit-slider-thumb{-webkit-appearance:none;background:var(--exploder-accent);border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.1);height:18px;margin-top:-6px;transition:transform .2s,box-shadow .2s;width:18px}.exploder-slider:active::-webkit-slider-thumb{box-shadow:0 0 0 10px rgba(37,99,235,.1);transform:scale(1.2)}@media (max-width:768px){.exploder-slider{height:44px}.exploder-slider::-webkit-slider-thumb{box-shadow:0 4px 6px rgba(0,0,0,.15);height:28px;margin-top:-11px;width:28px}.exploder-slider::-moz-range-thumb{border:2px solid #fff;height:28px;width:28px}.exploder-slider::-webkit-slider-runnable-track{border-radius:4px;height:8px}}.exploder-mode-btn{align-items:center;background:var(--exploder-bg-sub);border:1px solid transparent;border-radius:12px;color:var(--exploder-text-sub);cursor:pointer;display:flex;flex-direction:column;font-size:12px;font-weight:600;gap:6px;padding:10px;transition:all .2s}.exploder-mode-btn:hover{border-color:var(--exploder-border)}.exploder-mode-btn.active{background:#eff6ff;border-color:#bfdbfe;color:var(--exploder-accent)}.exploder-card{background:var(--exploder-bg-main);border:1px solid var(--exploder-border);border-radius:20px;box-shadow:0 10px 15px -3px rgba(0,0,0,.05),0 4px 6px -2px rgba(0,0,0,.02)}.exploder-h-screen{height:100vh}.exploder-flex{display:flex}.exploder-flex-col{flex-direction:column}.exploder-flex-row{flex-direction:row}.exploder-flex-1{flex:1 1 0%}.exploder-relative{position:relative}.exploder-absolute{position:absolute}.exploder-inset-0{bottom:0;left:0;right:0;top:0}.exploder-overflow-hidden{overflow:hidden}.exploder-bg-white{background-color:var(--exploder-bg-main)}.exploder-z-20{z-index:20}@media (min-width:768px){.exploder-md-flex-row{flex-direction:row}}"),function(e){e.RADIAL="radial",e.AXIAL="axial",e.NORMALIZED_RADIAL="normalized_radial",e.SIZE_WEIGHTED="size_weighted",e.HIERARCHICAL="hierarchical",e.FORCE_FIELD="force_field"}(n||(n={}));const o={PROGRESS:{DEFAULT:0,MIN:0,MAX:1,STEP:.01},MULTIPLIER:{DEFAULT:1,MIN:.1,MAX:5,STEP:.1},EXPOSURE:{DEFAULT:1,MIN:.1,MAX:6,STEP:.1},DEFAULT_DURATION:1e3,DEFAULT_MAX_DISTANCE:2,DEFAULT_ADAPT_SIZE:5,WEIGHTS:{BASE:.5,SCALE:1.5,FORCE_FIELD_OFFSET:.2},LIGHTS:{SCENE:{AMBIENT:.2,HEMISPHERE:.3,MAIN_DIRECTIONAL:.5,BACK_DIRECTIONAL:.3,SIDE_DIRECTIONAL:.2},INTERNAL:{AMBIENT:.4,HEMISPHERE:.4,DIRECTIONAL:.8}},DIRECTION:{MIN_LENGTH:.001,ANGLE_FACTOR:.017453292519943295,Z_FACTOR:.5,INDEX_ANGLE:.7853981633974483,XY_OFFSET:.2,Z_OFFSET:.1}};function r(e,i="#2563EB"){const s=document.createElement("canvas"),n=128;s.width=n,s.height=n;const o=s.getContext("2d");o&&(o.beginPath(),o.arc(64,64,n/2.2,0,2*Math.PI),o.fillStyle=i,o.fill(),o.font="bold 72px Inter, system-ui, -apple-system, sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#FFFFFF",o.fillText(e,64,64));const r=new t.CanvasTexture(s),a=new t.SpriteMaterial({map:r,transparent:!0}),l=new t.Sprite(a);return l.scale.set(.4,.4,1),l}function a(e,i){const s=new t.Vector3;e.getWorldPosition(s);const n=(new t.Vector3).subVectors(s,i);if(n.length()<o.DIRECTION.MIN_LENGTH){const t=function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t%360)}(e.uuid||"");if(n.set(Math.cos(t*o.DIRECTION.ANGLE_FACTOR),Math.sin(t*o.DIRECTION.ANGLE_FACTOR),Math.cos(t*o.DIRECTION.Z_FACTOR)),e.parent){const t=e.parent.children.indexOf(e);t>=0&&(n.x+=Math.cos(t*o.DIRECTION.INDEX_ANGLE)*o.DIRECTION.XY_OFFSET,n.y+=Math.sin(t*o.DIRECTION.INDEX_ANGLE)*o.DIRECTION.XY_OFFSET,n.z+=(t%3-1)*o.DIRECTION.Z_OFFSET)}}return n.normalize()}function l(e,t,i){return Math.max(t,Math.min(i,e))}function h(e){if(!e)return"Unknown Model";const t=e.split("/");return t[t.length-1].split("?")[0]}function d(){return"undefined"!=typeof window&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768)}class p{constructor(e,i,s,r,l={}){this.progress=o.PROGRESS.DEFAULT,this.multiplier=o.MULTIPLIER.DEFAULT,this.mode=n.RADIAL,this.originalPositions=new Map,this.originalRotations=new Map,this.originalScales=new Map,this.explodeDirections=new Map,this.axialDistances=new Map,this.sizeWeights=new Map,this.hierarchicalDepths=new Map,this.modelRadius=1,this.onProgressChangeCallback=null,this.explodableMeshes=[],this.internalLights=[],this.model=e,this.scene=i,this.camera=s,this.renderer=r,this.options={maxDistance:l.maxDistance??o.DEFAULT_MAX_DISTANCE,duration:l.duration??o.DEFAULT_DURATION,createUI:l.createUI??!0,viewport:l.viewport??document.body,uiStyle:l.uiStyle??{width:"200px",height:"30px",position:"bottom"},directionStrategy:l.directionStrategy??a,mode:l.mode??n.RADIAL,axialVector:l.axialVector??new t.Vector3(0,1,0),adaptModel:l.adaptModel??!0,model:l.model??e,modelUrl:l.modelUrl||"",showUpload:l.showUpload??!1,showHelpers:l.showHelpers??!1,showPanel:l.showPanel??!0,showProgress:l.showProgress??!0,wheelControlExplosion:l.wheelControlExplosion??!1,models:l.models??[],initialModel:l.initialModel??""},this.mode=this.options.mode,this.options.adaptModel&&this.adaptModelToScene();const h=(new t.Box3).setFromObject(this.model);this.modelCenter=h.getCenter(new t.Vector3);const d=h.getBoundingSphere(new t.Sphere);this.modelRadius=d.radius||1,this.saveOriginalTransforms(this.model),this.setupInternalLighting()}adaptModelToScene(){const e=(new t.Box3).setFromObject(this.model).getSize(new t.Vector3),i=Math.max(e.x,e.y,e.z);if(i>0){const e=o.DEFAULT_ADAPT_SIZE/i;this.model.scale.multiplyScalar(e);const s=(new t.Box3).setFromObject(this.model).getCenter(new t.Vector3);this.model.position.sub(s)}}setupInternalLighting(){const e=new t.AmbientLight(16777215,o.LIGHTS.INTERNAL.AMBIENT);this.scene.add(e),this.internalLights.push(e);const i=new t.HemisphereLight(16777215,4473924,o.LIGHTS.INTERNAL.HEMISPHERE);this.scene.add(i),this.internalLights.push(i);const s=new t.Object3D;this.camera.add(s);for(let e=0;e<3;e++){const i=e/3*Math.PI*2,n=3*Math.cos(i),r=3*Math.sin(i),a=new t.DirectionalLight(16777215,o.LIGHTS.INTERNAL.DIRECTIONAL);a.position.set(n,r,1);const l=new t.Object3D;l.position.set(0,0,-5),s.add(l),a.target=l,s.add(a),this.internalLights.push(a)}const n=.8*o.LIGHTS.INTERNAL.DIRECTIONAL,r=new t.DirectionalLight(16777215,n);r.position.set(5,5,2);const a=new t.Object3D;a.position.set(0,0,-5),s.add(a),r.target=a,s.add(r),this.internalLights.push(r)}setInternalLightingVisible(e){this.internalLights.forEach(t=>{t.visible=e}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}setInternalLightingExposure(e){this.internalLights.forEach(i=>{i instanceof t.AmbientLight?i.intensity=o.LIGHTS.INTERNAL.AMBIENT*e:i instanceof t.HemisphereLight?i.intensity=o.LIGHTS.INTERNAL.HEMISPHERE*e:i instanceof t.DirectionalLight&&(i.intensity=o.LIGHTS.INTERNAL.DIRECTIONAL*e)}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}calculateAxialDistances(){const e=this.options.axialVector.clone().normalize(),i=(new t.Box3).setFromObject(this.model),s=i.min.dot(e),n=i.max.dot(e),o=Math.abs(n-s),r=o>1e-4?1/o:1;for(const t of this.explodableMeshes){const i=this.originalPositions.get(t);if(i){const s=i.clone().sub(this.modelCenter).dot(e);this.axialDistances.set(t,s*r)}}}saveOriginalTransforms(e){this.traverseAndSave(e),this.calculateAxialDistances(),this.calculateSizeWeights(),this.calculateHierarchicalDepths()}calculateHierarchicalDepths(){let e=0;const t=new Map;for(const i of this.explodableMeshes){let s=0,n=i.parent;for(;n&&n!==this.model;)s++,n=n.parent;t.set(i,s),e=Math.max(e,s)}const i=e>0?1/e:1;for(const[e,s]of t)this.hierarchicalDepths.set(e,o.WEIGHTS.BASE+s*i*o.WEIGHTS.SCALE)}calculateSizeWeights(){let e=0;const i=new Map;for(const s of this.explodableMeshes)if(s instanceof t.Mesh){const n=s.geometry;n.boundingBox||n.computeBoundingBox();const o=n.boundingBox;if(o){const n=new t.Vector3;o.getSize(n);const r=n.x*n.y*n.z;i.set(s,r),e=Math.max(e,r)}}const s=e>0?1/e:1;for(const[e,t]of i)this.sizeWeights.set(e,o.WEIGHTS.BASE+t*s*o.WEIGHTS.SCALE)}traverseAndSave(e){if(!e.visible)return;const i=new t.Vector3;if(e.getWorldPosition(i),this.originalPositions.set(e,i.clone()),e.rotation&&this.originalRotations.set(e,e.rotation.clone()),e.scale&&this.originalScales.set(e,e.scale.clone()),"isMesh"in e&&!0===e.isMesh){this.explodableMeshes.push(e);const t=this.options.directionStrategy(e,this.modelCenter);this.explodeDirections.set(e,t)}e.children.forEach(e=>{this.traverseAndSave(e)})}setModel(e){this.reset(),this.model=e,this.options.adaptModel&&this.adaptModelToScene();const i=(new t.Box3).setFromObject(this.model);this.modelCenter=i.getCenter(new t.Vector3);const s=i.getBoundingSphere(new t.Sphere);this.modelRadius=s.radius||1,this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.saveOriginalTransforms(this.model),this.updateInternalLighting(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateInternalLighting(){const e=3*this.modelRadius,i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],s=this.internalLights.filter(e=>e instanceof t.DirectionalLight);s.length===i.length?s.forEach((t,s)=>{const[n,o,r]=i[s];t.position.set(this.modelCenter.x+n*e,this.modelCenter.y+o*e,this.modelCenter.z+r*e),t.target=this.model}):(this.internalLights.forEach(e=>{this.scene.remove(e),e.dispose&&e.dispose()}),this.internalLights=[],this.setupInternalLighting())}setProgress(e){this.progress=l(e,o.PROGRESS.MIN,o.PROGRESS.MAX),this.updateExplodedPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress),this.renderer.render(this.scene,this.camera)}updateExplodedPositions(){for(const e of this.explodableMeshes){const t=this.originalPositions.get(e),i=this.explodeDirections.get(e);if(t&&i){const s=this.modelRadius*this.options.maxDistance*this.progress*this.multiplier,r=t.clone();switch(this.mode){case n.RADIAL:r.add(i.clone().multiplyScalar(s));break;case n.AXIAL:{const t=this.axialDistances.get(e)||0,i=this.options.axialVector.clone().normalize();r.add(i.multiplyScalar(t*this.modelRadius*this.options.maxDistance*this.progress*this.multiplier));break}case n.NORMALIZED_RADIAL:{const e=t.clone().sub(this.modelCenter);r.add(e.multiplyScalar(this.options.maxDistance*this.progress*this.multiplier));break}case n.SIZE_WEIGHTED:{const t=this.sizeWeights.get(e)||1;r.add(i.clone().multiplyScalar(s*t));break}case n.HIERARCHICAL:{const t=this.hierarchicalDepths.get(e)||1;r.add(i.clone().multiplyScalar(s*t));break}case n.FORCE_FIELD:{const t=this.originalPositions.get(e);if(t){const e=1/(t.clone().sub(this.modelCenter).length()/this.modelRadius+o.WEIGHTS.FORCE_FIELD_OFFSET);r.add(i.clone().multiplyScalar(s*e))}break}}e.parent&&e.parent.worldToLocal(r),e.position.copy(r)}}}setMode(e){this.mode=e,this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMode(){return this.mode}setAxialVector(e){this.options.axialVector.copy(e),this.calculateAxialDistances(),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getAxialVector(){return this.options.axialVector}reset(){this.progress=0,this.resetToOriginalPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress)}resetToOriginalPositions(){for(const e of this.explodableMeshes){const t=this.originalPositions.get(e),i=this.originalRotations.get(e),s=this.originalScales.get(e);if(t){const i=t.clone();e.parent&&e.parent.worldToLocal(i),e.position.copy(i)}i&&e.rotation&&e.rotation.set(i.x,i.y,i.z),s&&e.scale&&e.scale.set(s.x,s.y,s.z)}}setProgressChangeCallback(e){this.onProgressChangeCallback=e}setMultiplier(e){this.multiplier=l(e,o.MULTIPLIER.MIN,o.MULTIPLIER.MAX),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMultiplier(){return this.multiplier}getProgress(){return this.progress}getModelCenter(){return this.modelCenter.clone()}getOptions(){return this.options}dispose(){this.internalLights.forEach(e=>{this.scene.remove(e),e.dispose&&e.dispose()}),this.internalLights=[],this.reset(),this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.onProgressChangeCallback=null}}function c(e,t,i){return(i=Math.max(0,Math.min(1,(i-e)/(t-e))))*i*(3-2*i)}function u(e,t,i,s,n){const o=Math.abs(e)-i+n,r=Math.abs(t)-s+n;return Math.min(Math.max(o,r),0)+function(e,t){return Math.sqrt(e*e+t*t)}(Math.max(o,0),Math.max(r,0))-n}class m{constructor(e,t){this.mouse={x:0,y:0},this.mouseUsed=!1,this.canvasDPI=window.devicePixelRatio||1,this.id="lg-"+Math.random().toString(36).substr(2,5),this.width=t.width,this.height=t.height,this.fragment=t.fragment||(e=>{const t=e.x-.5,i=e.y-.5,s=c(.8,0,u(t,i,.3,.2,.6)-.3),n=c(0,1,s);return{type:"t",x:t*n+.5,y:i*n+.5}}),this.init(e)}init(e){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("style","position:absolute; width:0; height:0; pointer-events:none;");const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id",`${this.id}_filter`),i.setAttribute("filterUnits","userSpaceOnUse"),i.setAttribute("colorInterpolationFilters","sRGB"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width",this.width.toString()),i.setAttribute("height",this.height.toString()),this.feImage=document.createElementNS("http://www.w3.org/2000/svg","feImage"),this.feImage.setAttribute("id",`${this.id}_map`),this.feImage.setAttribute("result","map"),this.feImage.setAttribute("width",this.width.toString()),this.feImage.setAttribute("height",this.height.toString()),this.feDisplacementMap=document.createElementNS("http://www.w3.org/2000/svg","feDisplacementMap"),this.feDisplacementMap.setAttribute("in","SourceGraphic"),this.feDisplacementMap.setAttribute("in2","map"),this.feDisplacementMap.setAttribute("xChannelSelector","R"),this.feDisplacementMap.setAttribute("yChannelSelector","G"),i.appendChild(this.feImage),i.appendChild(this.feDisplacementMap),t.appendChild(i),this.svg.appendChild(t),document.body.appendChild(this.svg),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.updateSize(this.width,this.height),e.style.backdropFilter=`url(#${this.id}_filter) blur(0.25px) contrast(1.2) brightness(1.05) saturate(1.1)`,e.style.webkitBackdropFilter=`url(#${this.id}_filter) blur(0.25px) contrast(1.2) brightness(1.05) saturate(1.1)`,this.render(),e.addEventListener("mousemove",t=>{const i=e.getBoundingClientRect();this.mouse.x=(t.clientX-i.left)/i.width,this.mouse.y=(t.clientY-i.top)/i.height,this.mouseUsed&&this.render()})}updateSize(e,t){this.width=e,this.height=t,this.canvas.width=e*this.canvasDPI,this.canvas.height=t*this.canvasDPI,this.render()}render(){const e=this.canvas.width,t=this.canvas.height;if(e<=0||t<=0)return;const i=new Proxy(this.mouse,{get:(e,t)=>(this.mouseUsed=!0,e[t])});this.mouseUsed=!1;const s=new Uint8ClampedArray(e*t*4);let n=0;const o=[];for(let r=0;r<s.length;r+=4){const s=r/4%e,a=Math.floor(r/4/e),l=this.fragment({x:s/e,y:a/t},i),h=l.x*e-s,d=l.y*t-a;n=Math.max(n,Math.abs(h),Math.abs(d)),o.push(h,d)}n*=.5,n<1&&(n=1);let r=0;for(let e=0;e<s.length;e+=4){const t=o[r++]/n+.5,i=o[r++]/n+.5;s[e]=255*t,s[e+1]=255*i,s[e+2]=0,s[e+3]=255}this.context.putImageData(new ImageData(s,e,t),0,0),this.feImage.setAttributeNS("http://www.w3.org/1999/xlink","href",this.canvas.toDataURL()),this.feDisplacementMap.setAttribute("scale",(n/this.canvasDPI).toString())}dispose(){this.svg.remove(),this.canvas.remove()}}class x{constructor(e,i,s,r,a,l,h,d,p=o.MULTIPLIER.DEFAULT,c=o.EXPOSURE.DEFAULT,u=n.RADIAL,x=new t.Vector3(0,1,0),g=!1,b=[],f,y={},w=!1,E=!1){this.modeButtons=new Map,this.onMultiplierChange=i,this.onExposureChange=s,this.onModeChange=r,this.onAxialChange=a,this.onModelChange=l,this.onHelperVisibilityChange=h,this.onReset=d,this.styles={container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 260px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 20px;\n      padding: 16px;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 16px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 12px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 12px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    ",zoomContainer:"\n      position: absolute;\n      top: 24px;\n      left: 50%;\n      transform: translateX(-50%);\n      display: flex;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 12px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n      z-index: 1000;\n    ",zoomButton:"\n      width: 36px;\n      height: 36px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 8px;\n      color: var(--exploder-text-main);\n      cursor: pointer;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      padding: 0;\n      outline: none;\n    ",zoomButtonHover:"\n      background: rgba(255, 255, 255, 0.4);\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      color: var(--exploder-accent);\n    ",zoomButtonActive:"\n      transform: translateY(0) scale(0.95);\n      background: rgba(255, 255, 255, 0.2);\n    "},this.element=document.createElement("aside"),this.element.className="exploder-ui-root exploder-card exploder-scrollbar",this.applyStyle(this.element,this.styles.container);const v=document.createElement("div");this.applyStyle(v,this.styles.sectionHeader),v.innerHTML=`\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.72V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.17a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>\n        <circle cx="12" cy="12" r="3"/>\n      </svg>\n      <h3 style="${this.styles.title}">参数控制面板</h3>\n    `,this.element.appendChild(v);const S=document.createElement("div");this.applyStyle(S,"display: flex; flex-direction: column; gap: 20px; flex: 1;"),this.element.appendChild(S);const C=b&&b.length>0;if(C||w){const e=this.createSection("模型资源",C?"选择或上传 3D 资产":"上传本地 3D 资产进行预览");if(C){const t=document.createElement("select");this.modelSelect=t,t.className="exploder-select",this.applyStyle(t,this.styles.select),b.forEach(e=>{const i=document.createElement("option"),s="string"==typeof e?e:e.value;i.value=s,i.textContent="string"==typeof e?e.split("/").pop()||e:e.label,s===f&&(i.selected=!0),t.appendChild(i)}),e.appendChild(t)}if(w){const t=document.createElement("div");this.applyStyle(t,`\n          margin-top: ${C?"8px":"0"};\n          padding: 8px;\n          background: var(--exploder-bg-sub);\n          border: 1px dashed var(--exploder-border);\n          border-radius: 12px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n          cursor: pointer;\n          transition: all 0.2s;\n        `),t.innerHTML='\n          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--exploder-text-sub)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>\n          <span style="font-size: 11px; font-weight: 600; color: var(--exploder-text-sub);">上传本地 GLB</span>\n          <input type="file" accept=".glb,.gltf" style="display: none;">\n        ';const i=t.querySelector("input");t.onclick=()=>i.click(),i.onchange=e=>{const t=e.target.files?.[0];if(t){const e=URL.createObjectURL(t);this.onModelChange?.(e)}},e.appendChild(t)}S.appendChild(e)}const M=this.createSection("","调整组件之间分离的距离倍数"),A=this.createLabelWrapper("爆炸系数(分离倍数)");this.multiplierDisplay=document.createElement("span"),this.multiplierDisplay.className="exploder-value",this.applyStyle(this.multiplierDisplay,this.styles.value),this.multiplierDisplay.textContent=`${p.toFixed(1)}x`,A.appendChild(this.multiplierDisplay),M.insertBefore(A,M.firstChild),this.multiplierSlider=document.createElement("input"),this.multiplierSlider.type="range",this.multiplierSlider.className="exploder-slider",this.multiplierSlider.min=o.MULTIPLIER.MIN.toString(),this.multiplierSlider.max=o.MULTIPLIER.MAX.toString(),this.multiplierSlider.step=o.MULTIPLIER.STEP.toString(),this.multiplierSlider.value=p.toString(),this.applyStyle(this.multiplierSlider,this.styles.slider),M.appendChild(this.multiplierSlider),S.appendChild(M);const L=this.createSection("","调整 3D 场景的光照表现"),I=this.createLabelWrapper("环境亮度");this.exposureDisplay=document.createElement("span"),this.exposureDisplay.className="exploder-value",this.applyStyle(this.exposureDisplay,this.styles.value),this.exposureDisplay.textContent=c.toFixed(1),I.appendChild(this.exposureDisplay),L.insertBefore(I,L.firstChild),this.exposureSlider=document.createElement("input"),this.exposureSlider.type="range",this.exposureSlider.className="exploder-slider",this.exposureSlider.min=o.EXPOSURE.MIN.toString(),this.exposureSlider.max=o.EXPOSURE.MAX.toString(),this.exposureSlider.step=o.EXPOSURE.STEP.toString(),this.exposureSlider.value=c.toString(),this.applyStyle(this.exposureSlider,this.styles.slider),L.appendChild(this.exposureSlider),S.appendChild(L);const D=this.createSection("爆炸模式","选择不同的组件分离算法"),T=document.createElement("div");this.applyStyle(T,this.styles.grid);if([{id:n.RADIAL,label:"径向模式",icon:"M12 3v3m0 12v3M3 12h3m12 0h3M5.6 5.6l2.1 2.1m8.6 8.6l2.1 2.1M5.6 18.4l2.1-2.1m8.6-8.6l2.1-2.1"},{id:n.NORMALIZED_RADIAL,label:"归一化径向",icon:"M21 3h-6M3 21h6M3 3v6M21 21v-6M3 3l7.5 7.5M21 21l-7.5-7.5"},{id:n.AXIAL,label:"轴向模式",icon:"M7 7h10M7 12h10M7 17h10"},{id:n.FORCE_FIELD,label:"力场式",icon:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0 M12 12m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0"},{id:n.SIZE_WEIGHTED,label:"尺寸加权",icon:"M3 6h18M7 12h10M10 18h4"},{id:n.HIERARCHICAL,label:"装配树级",icon:"M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"}].forEach(e=>{const t=document.createElement("div");t.className="exploder-mode-btn "+(u===e.id?"active":""),t.innerHTML=`\n        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="${e.icon}"/></svg>\n        <span>${e.label}</span>\n      `,t.onclick=()=>this.handleModeClick(e.id),T.appendChild(t),this.modeButtons.set(e.id,t)}),D.appendChild(T),this.axialContainer=document.createElement("div"),this.applyStyle(this.axialContainer,"margin-top: 8px; display: "+(u===n.AXIAL?"block":"none")),this.axialSelect=document.createElement("select"),this.applyStyle(this.axialSelect,this.styles.select),[{v:"0,1,0",l:"Y 轴 (垂直)"},{v:"1,0,0",l:"X 轴 (横向)"},{v:"0,0,1",l:"Z 轴 (纵向)"}].forEach(e=>{const t=document.createElement("option");t.value=e.v,t.textContent=e.l,e.v===`${x.x},${x.y},${x.z}`&&(t.selected=!0),this.axialSelect.appendChild(t)}),this.axialContainer.appendChild(this.axialSelect),D.appendChild(this.axialContainer),S.appendChild(D),E){const e=this.createSection("辅助视图","控制场景辅助元素的显示"),t=document.createElement("label");this.applyStyle(t,"display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none;"),this.helperToggle=document.createElement("input"),this.helperToggle.type="checkbox",this.helperToggle.checked=g,this.helperToggle.style.width="16px",this.helperToggle.style.height="16px",this.helperToggle.style.accentColor="var(--exploder-accent)",t.appendChild(this.helperToggle);const i=document.createElement("span");i.textContent="显示网格与坐标轴标签",this.applyStyle(i,"font-size: 12px; font-weight: 500; color: var(--exploder-text-sub);"),t.appendChild(i),e.appendChild(t),S.appendChild(e)}const R=document.createElement("div");this.applyStyle(R,"padding-top: 8px; margin-top: auto;"),this.resetButton=document.createElement("button"),this.resetButton.className="exploder-button-reset",this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.innerHTML='\n      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>\n      <span>重置视图与参数</span>\n    ',this.resetButton.onmouseenter=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),this.resetButton.onmouseleave=()=>this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.onmousedown=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetActive),this.resetButton.onmouseup=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),R.appendChild(this.resetButton),this.element.appendChild(R),this.multiplierSlider.oninput=e=>{const t=parseFloat(e.target.value);this.updateMultiplier(t),this.onMultiplierChange(t)},this.exposureSlider.oninput=e=>{const t=parseFloat(e.target.value);this.updateExposure(t),this.onExposureChange?.(t)},this.modelSelect&&(this.modelSelect.onchange=e=>this.onModelChange?.(e.target.value)),this.axialSelect.onchange=e=>{const[i,s,n]=e.target.value.split(",").map(Number);this.onAxialChange?.(new t.Vector3(i,s,n))},this.helperToggle&&(this.helperToggle.onchange=e=>this.onHelperVisibilityChange?.(e.target.checked)),this.resetButton.onclick=()=>{this.onReset?.()};if((("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element),this.liquidGlass=new m(this.element,{width:260,height:this.element.offsetHeight||600}),window.ResizeObserver){new ResizeObserver(()=>{this.liquidGlass&&this.liquidGlass.updateSize(260,this.element.offsetHeight)}).observe(this.element)}}createSection(e,t){const i=document.createElement("section");if(this.applyStyle(i,this.styles.section),e){const t=document.createElement("label");this.applyStyle(t,this.styles.label),t.textContent=e,i.appendChild(t)}if(t){const e=document.createElement("p");this.applyStyle(e,this.styles.hint),e.textContent=t,i.appendChild(e)}return i}createLabelWrapper(e){const t=document.createElement("div");this.applyStyle(t,this.styles.labelContainer);const i=document.createElement("span");return this.applyStyle(i,this.styles.label),i.textContent=e,t.appendChild(i),t}handleModeClick(e){this.updateMode(e),this.onModeChange?.(e)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}show(){this.element.style.display="flex"}hide(){this.element.style.display="none"}update(e){}updateMultiplier(e){this.multiplierSlider.value=e.toString(),this.multiplierDisplay.textContent=`${e.toFixed(1)}x`}updateExposure(e){this.exposureSlider.value=e.toString(),this.exposureDisplay.textContent=e.toFixed(1)}updateMode(e){this.modeButtons.forEach((t,i)=>{i===e?t.classList.add("active"):t.classList.remove("active")}),this.axialContainer&&(this.axialContainer.style.display=e===n.AXIAL?"block":"none")}updateHelperVisibility(e){this.helperToggle&&(this.helperToggle.checked=e)}updateAxialVector(e){this.axialSelect&&(this.axialSelect.value=`${e.x},${e.y},${e.z}`)}dispose(){this.liquidGlass?.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class g{constructor(e,t,i=o.PROGRESS.DEFAULT){this.onProgressChange=t,this.element=document.createElement("div"),this.element.className="exploder-hud-root",this.applyStyle(this.element,"\n      position: absolute;\n      bottom: 40px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 80%;\n      max-width: 600px;\n      z-index: 100;\n      pointer-events: auto;\n    ");const s=document.createElement("div");s.className="exploder-card",this.applyStyle(s,"\n      display: flex;\n      align-items: center;\n      gap: 20px;\n      padding: 12px 24px;\n      border-radius: 16px;\n      background: rgba(255, 255, 255, 0.4);\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n    "),this.element.appendChild(s);const n=document.createElement("div");this.applyStyle(n,"\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    "),s.appendChild(n);const r=document.createElement("div");this.applyStyle(r,"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ");const a=document.createElement("span");a.textContent="当前爆炸进度",this.applyStyle(a,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),this.valueDisplay=document.createElement("span"),this.valueDisplay.textContent=`${Math.round(100*i)}%`,this.applyStyle(this.valueDisplay,"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-accent);\n    "),r.appendChild(a),r.appendChild(this.valueDisplay),n.appendChild(r),this.slider=document.createElement("input"),this.slider.type="range",this.slider.className="exploder-slider",this.slider.min=o.PROGRESS.MIN.toString(),this.slider.max=o.PROGRESS.MAX.toString(),this.slider.step=o.PROGRESS.STEP.toString(),this.slider.value=i.toString(),this.applyStyle(this.slider,"\n      width: 100%;\n      height: 4px;\n      cursor: pointer;\n    "),n.appendChild(this.slider),this.slider.oninput=e=>{const t=parseFloat(e.target.value);this.update(t),this.onProgressChange(t)};(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element),this.liquidGlass=new m(s,{width:600,height:80})}update(e){this.slider.value=e.toString(),this.valueDisplay.textContent=`${Math.round(100*e)}%`}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}dispose(){this.liquidGlass?.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}}class b{constructor(e,t="加载中...",i=0){this.element=document.createElement("div"),this.element.className="exploder-info-hud",this.applyStyle(this.element,"\n      position: absolute;\n      top: 24px;\n      left: 24px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      pointer-events: none;\n      z-index: 100;\n    ");const s=document.createElement("div");s.className="exploder-card",this.applyStyle(s,"\n      padding: 12px 16px;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      pointer-events: auto;\n      background: rgba(255, 255, 255, 0.4);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 16px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    ");const n=document.createElement("div");this.applyStyle(n,"\n      width: 40px;\n      height: 40px;\n      background: var(--exploder-accent);\n      color: white;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    "),n.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>';const o=document.createElement("div");this.applyStyle(o,"\n      display: flex;\n      flex-direction: column;\n    "),this.modelNameDisplay=document.createElement("span"),this.modelNameDisplay.textContent=t,this.applyStyle(this.modelNameDisplay,"\n      font-size: 13px;\n      font-weight: 700;\n      color: var(--exploder-text-main);\n      line-height: 1.2;\n      max-width: 200px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    "),this.faceCountDisplay=document.createElement("span"),this.faceCountDisplay.textContent=`面数: ${i.toLocaleString()}`,this.applyStyle(this.faceCountDisplay,"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      font-weight: 700;\n      margin-top: 4px;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),o.appendChild(this.modelNameDisplay),o.appendChild(this.faceCountDisplay),s.appendChild(n),s.appendChild(o),this.element.appendChild(s);const r=document.createElement("div");this.applyStyle(r,"\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.4);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 12px;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n      width: fit-content;\n      pointer-events: auto;\n    ");const a=document.createElement("span");a.className="exploder-status-dot exploder-animate-pulse";const l=document.createElement("span");l.textContent="WebGL 2.0 渲染引擎已启动",this.applyStyle(l,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.02em;\n    "),r.appendChild(a),r.appendChild(l),this.element.appendChild(r);(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element),this.liquidGlass1=new m(s,{width:300,height:80}),this.liquidGlass2=new m(r,{width:300,height:40})}update(e,t){this.modelNameDisplay.textContent=e,this.faceCountDisplay.textContent=`面数: ${t.toLocaleString()}`}setModelName(e){this.modelNameDisplay.textContent=e}setFaceCount(e){this.faceCountDisplay.textContent=`面数: ${e.toLocaleString()}`}show(){this.element.style.display="flex"}hide(){this.element.style.display="none"}dispose(){this.liquidGlass1?.dispose(),this.liquidGlass2?.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}}class f{constructor(e,i,s,r,a,l,h,d,p,c=o.PROGRESS.DEFAULT,u=o.MULTIPLIER.DEFAULT,m=o.EXPOSURE.DEFAULT,f=n.RADIAL,y=new t.Vector3(0,1,0),w=!1,E,v,S,C=!1,M=!1,A="示例模型",L=0,I=!0,D=!0){this.element=e,I&&(this.panel=new x(e,s,r,a,l,h,d,p,u,m,f,y,w,E,v,S,C,M)),D&&(this.hud=new g(e,i,c)),I&&(this.infoHUD=new b(e,A,L)),this.updateResponsiveState(),this.resizeHandler=this.updateResponsiveState.bind(this),window.addEventListener("resize",this.resizeHandler)}updateResponsiveState(){d()?(this.panel?.hide(),this.infoHUD?.hide()):(this.panel?.show(),this.infoHUD?.show())}show(){d()||(this.panel?.show(),this.infoHUD?.show()),this.hud?.show()}hide(){this.panel?.hide(),this.hud?.hide(),this.infoHUD?.hide()}update(e){this.panel?.update(e),this.hud?.update(e)}updateMultiplier(e){this.panel?.updateMultiplier(e)}updateExposure(e){this.panel?.updateExposure(e)}updateMode(e){this.panel?.updateMode(e)}updateAxialVector(e){this.panel?.updateAxialVector(e)}updateHelperVisibility(e){this.panel?.updateHelperVisibility(e)}updateModel(e){this.panel&&this.panel.updateModel&&this.panel.updateModel(e)}updateInfo(e,t){this.infoHUD?.update(e,t)}reset(){this.panel?.updateMultiplier(o.MULTIPLIER.DEFAULT),this.panel?.updateExposure(o.EXPOSURE.DEFAULT),this.panel?.updateMode(n.RADIAL),this.panel?.updateAxialVector(new t.Vector3(0,1,0)),this.panel?.updateHelperVisibility(!0),this.hud?.update(o.PROGRESS.DEFAULT)}dispose(){window.removeEventListener("resize",this.resizeHandler),this.panel?.dispose(),this.hud?.dispose(),this.infoHUD?.dispose()}}function y(e,i,s,r,a,l,h,d,p,c=o.PROGRESS.DEFAULT,u=o.MULTIPLIER.DEFAULT,m=o.EXPOSURE.DEFAULT,x=n.RADIAL,g=new t.Vector3(0,1,0),b=!1,y="示例模型",w=0){if(!1===e.createUI)return null;const E=e.viewport?function(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error(`找不到容器元素: ${e}`);return t}return e}(e.viewport):null,v=E||document.body;if(v instanceof HTMLElement){"static"===window.getComputedStyle(v).position&&(v.style.position="relative")}return new f(v,i,s,r,a,l,h,d,p,c,u,m,x,g,b,e.models,e.initialModel||("string"==typeof e.model?e.model:""),e.uiStyle,e.showUpload,e.showHelpers,y,w,e.showPanel??!0,e.showProgress??!0)}class w{constructor(e,t,i){this.liquidGlass=null,this.zoomStep=.9,this.controls=t,this.container=document.createElement("div"),this.container.className="exploder-zoom-controls",this.container.setAttribute("style",i.zoomContainer);const s=document.createElement("button");s.className="exploder-zoom-button",s.setAttribute("style",i.zoomButton),s.innerHTML='\n      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="12" y1="5" x2="12" y2="19"></line>\n        <line x1="5" y1="12" x2="19" y2="12"></line>\n      </svg>\n    ',s.onclick=()=>this.zoom(this.zoomStep);const n=document.createElement("button");n.className="exploder-zoom-button",n.setAttribute("style",i.zoomButton),n.innerHTML='\n      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="5" y1="12" x2="19" y2="12"></line>\n      </svg>\n    ',n.onclick=()=>this.zoom(1/this.zoomStep),this.container.appendChild(s),this.container.appendChild(n),e.appendChild(this.container),this.applyLiquidGlass(),this.addHoverEffects(s,i),this.addHoverEffects(n,i)}zoom(e){const t=this.controls.object,i=this.controls.target,s=t.position.distanceTo(i)*e;if(s<.1)return;const n=t.position.clone().sub(i).normalize();t.position.copy(i).add(n.multiplyScalar(s)),this.controls.update()}addHoverEffects(e,t){e.onmouseenter=()=>{const i=e.getAttribute("style")||"";e.setAttribute("style",i+t.zoomButtonHover)},e.onmouseleave=()=>{e.setAttribute("style",t.zoomButton)},e.onmousedown=()=>{const i=e.getAttribute("style")||"";e.setAttribute("style",i+t.zoomButtonActive)},e.onmouseup=()=>{const i=e.getAttribute("style")||"";e.setAttribute("style",i.replace(t.zoomButtonActive,""))}}applyLiquidGlass(){this.liquidGlass=new m(this.container,{width:100,height:52})}dispose(){this.liquidGlass&&this.liquidGlass.dispose(),this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}e.GLTFExploder=class{constructor(e,i,s,n,o={}){this.core=null,this.ui=null,this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.container=null,this.gridHelper=null,this.axesHelper=null,this.axisLabels=null,this.zoomControls=null,this.boundOnWheel=null,e instanceof t.Object3D&&i&&s&&n?(this.options=o,this.renderer=n,this.scene=i,this.camera=s,this.initCore(e,i,s,n,o)):(this.options=e,this.initializeAutoMode())}async initializeAutoMode(){const{viewport:e,model:n,modelUrl:a}=this.options,l="string"==typeof e?document.querySelector(e):e;this.container=l,this.container||(console.warn("GLTFExploder: 未找到视口容器 (viewport)，将使用 body 作为默认容器"),this.container=document.body),this.scene=new t.Scene,this.scene.background=new t.Color(16777215),this.camera=new t.PerspectiveCamera(45,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.renderer=new t.WebGLRenderer({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.toneMapping=t.ACESFilmicToneMapping,this.renderer.toneMappingExposure=o.EXPOSURE.DEFAULT,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=2,this.container.appendChild(this.renderer.domElement),this.controls=new s.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.enableZoom=!0,this.controls.enableRotate=!0,this.controls.enablePan=!0,this.controls.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.options.wheelControlExplosion&&(this.controls.enableZoom=!1),this.scene.add(new t.AmbientLight(16777215,.4));const h=new t.Object3D;this.camera.add(h),this.scene.add(this.camera);const d=new t.DirectionalLight(16777215,.8);d.position.set(2,5,5),d.castShadow=!0,d.shadow.bias=-1e-4,d.shadow.normalBias=.02,d.shadow.mapSize.width=2048,d.shadow.mapSize.height=2048;const p=new t.Object3D;p.position.set(0,0,-5),h.add(p),d.target=p,h.add(d);for(let e=0;e<3;e++){const i=e/3*Math.PI*2,s=new t.DirectionalLight(16777215,.4);s.position.set(5*Math.cos(i),5*Math.sin(i),2);const n=new t.Object3D;n.position.set(0,0,-5),h.add(n),s.target=n,h.add(s)}const c=new t.DirectionalLight(16777215,.64);c.position.set(5,5,2);const u=new t.Object3D;u.position.set(0,0,-5),h.add(u),c.target=u,h.add(c),this.gridHelper=new t.GridHelper(10,10,13421772,8947848),this.axesHelper=new t.AxesHelper(5),this.gridHelper.visible=!1,this.axesHelper.visible=!1,this.scene.add(this.gridHelper),this.scene.add(this.axesHelper);const m=r("X","#FF4444"),x=r("Y","#44FF44"),g=r("Z","#4444FF");m.visible=!1,x.visible=!1,g.visible=!1,m.position.set(5.5,0,0),x.position.set(0,5.5,0),g.position.set(0,0,5.5),this.axisLabels={x:m,y:x,z:g},this.scene.add(m,x,g);const b=a||("string"==typeof n?n:null);if(b){(new i.GLTFLoader).load(b,e=>{const t=e.scene;t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),this.scene?.add(t),this.initCore(t,this.scene,this.camera,this.renderer,this.options)})}else n instanceof t.Object3D&&(n.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),this.scene.add(n),this.initCore(n,this.scene,this.camera,this.renderer,this.options));this.animate(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){if(!this.container||!this.camera||!this.renderer)return;const e=this.container.clientWidth,i=this.container.clientHeight;this.camera instanceof t.PerspectiveCamera&&(this.camera.aspect=e/i,this.camera.updateProjectionMatrix()),this.renderer.setSize(e,i)}animate(){requestAnimationFrame(this.animate.bind(this)),this.controls&&this.controls.update(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}initCore(e,t,i,s,n){this.core&&this.core.dispose(),this.core=new p(e,t,i,s,n);const r=function(e){let t=0;return e.traverse(e=>{if(e.isMesh&&e.geometry){const i=e.geometry;i.index?t+=i.index.count/3:i.attributes.position&&(t+=i.attributes.position.count/3)}}),Math.floor(t)}(e);let a="Unknown Model";if(this.options.modelUrl?a=h(this.options.modelUrl):"string"==typeof n.model?a=h(n.model):e.name&&(a=e.name),!1===n.createUI||this.ui?this.ui&&(this.ui.update(o.PROGRESS.DEFAULT),this.ui.updateInfo&&this.ui.updateInfo(a,r)):this.ui=y(n,this.setProgress.bind(this),this.setMultiplier.bind(this),this.setExposure.bind(this),this.setMode.bind(this),this.setAxialVector.bind(this),this.handleModelChange.bind(this),this.handleHelperVisibilityChange.bind(this),this.reset.bind(this),o.PROGRESS.DEFAULT,o.MULTIPLIER.DEFAULT,s.toneMappingExposure,this.core.getMode(),this.core.getAxialVector(),!1,a,r),this.container&&this.controls&&!this.zoomControls){const e=(n.uiStyle,{container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 260px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 20px;\n      padding: 16px;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 16px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 12px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 12px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    ",zoomContainer:"\n      position: absolute;\n      top: 24px;\n      left: 50%;\n      transform: translateX(-50%);\n      display: flex;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 12px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n      z-index: 1000;\n    ",zoomButton:"\n      width: 36px;\n      height: 36px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 8px;\n      color: var(--exploder-text-main);\n      cursor: pointer;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      padding: 0;\n      outline: none;\n    ",zoomButtonHover:"\n      background: rgba(255, 255, 255, 0.4);\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      color: var(--exploder-accent);\n    ",zoomButtonActive:"\n      transform: translateY(0) scale(0.95);\n      background: rgba(255, 255, 255, 0.2);\n    "});this.zoomControls=new w(this.container,this.controls,e)}this.options.wheelControlExplosion&&this.renderer&&(this.boundOnWheel||(this.boundOnWheel=this.onWheel.bind(this)),this.renderer.domElement.removeEventListener("wheel",this.boundOnWheel),this.renderer.domElement.addEventListener("wheel",this.boundOnWheel,{passive:!1}))}onWheel(e){if(!this.core)return;e.preventDefault();const t=e.deltaY>0?.05:-.05,i=this.core.getProgress(),s=Math.min(1,Math.max(0,i+t));this.setProgress(s)}handleModelChange(e){this.onModelChangeCallback?this.onModelChangeCallback(e):this.container&&this.scene&&this.loadModelAuto(e)}loadModelAuto(e){if(!this.scene)return;(new i.GLTFLoader).load(e,t=>{if(this.core){const e=this.core.model;e&&this.scene?.remove(e),this.core.dispose()}const i=t.scene;this.scene?.add(i),this.initCore(i,this.scene,this.camera,this.renderer,this.options),this.ui&&this.ui.updateModel&&this.ui.updateModel(e),e.startsWith("blob:")&&setTimeout(()=>URL.revokeObjectURL(e),1e3)})}handleHelperVisibilityChange(e){this.onHelperVisibilityChangeCallback&&this.onHelperVisibilityChangeCallback(e),this.gridHelper&&(this.gridHelper.visible=e),this.axesHelper&&(this.axesHelper.visible=e),this.axisLabels&&(this.axisLabels.x.visible=e,this.axisLabels.y.visible=e,this.axisLabels.z.visible=e)}setModelChangeCallback(e){this.onModelChangeCallback=e}setHelperVisibilityChangeCallback(e){this.onHelperVisibilityChangeCallback=e}setModel(e){this.core?.setModel(e)}setHelperVisibility(e){this.handleHelperVisibilityChange(e),this.ui&&this.ui.updateHelperVisibility&&this.ui.updateHelperVisibility(e)}setInternalLightingVisible(e){this.core?.setInternalLightingVisible(e),this.ui&&this.ui.updateHelperVisibility&&this.ui.updateHelperVisibility(e)}setProgress(e){this.core?.setProgress(e),this.ui&&this.ui.update(e)}setMultiplier(e){this.core?.setMultiplier(e),this.ui&&this.ui.updateMultiplier&&this.ui.updateMultiplier(e)}setExposure(e){this.renderer&&(0===this.renderer.toneMapping&&(this.renderer.toneMapping=3),this.renderer.toneMappingExposure=e,this.core?.setInternalLightingExposure(e),this.ui&&this.ui.updateExposure&&this.ui.updateExposure(e))}setMode(e){this.core?.setMode(e),this.ui&&this.ui.updateMode&&this.ui.updateMode(e)}setAxialVector(e){this.core?.setAxialVector(e),this.ui&&this.ui.updateAxialVector&&this.ui.updateAxialVector(e)}reset(){if(this.core?.reset(),this.controls&&this.camera&&this.options.adaptModel&&(this.controls.reset(),this.core)){this.core.model&&(this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.controls.target.set(0,0,0),this.controls.update())}this.setExposure(o.EXPOSURE.DEFAULT),this.ui&&(this.ui.reset?.(),this.ui.update(o.PROGRESS.DEFAULT),this.ui.updateMultiplier?.(o.MULTIPLIER.DEFAULT),this.ui.updateExposure?.(o.EXPOSURE.DEFAULT),this.ui.updateMode?.(n.RADIAL),this.ui.updateAxialVector?.(new t.Vector3(0,1,0)),this.ui.updateHelperVisibility?.(!0),this.handleHelperVisibilityChange(!0))}setProgressChangeCallback(e){this.core?.setProgressChangeCallback(e)}getProgress(){return this.core?.getProgress()||0}showUI(){this.ui&&this.ui.show()}hideUI(){this.ui&&this.ui.hide()}dispose(){if(this.ui&&(this.ui.dispose(),this.ui=null),this.zoomControls&&(this.zoomControls.dispose(),this.zoomControls=null),this.gridHelper&&(this.scene?.remove(this.gridHelper),this.gridHelper.geometry.dispose(),Array.isArray(this.gridHelper.material)?this.gridHelper.material.forEach(e=>e.dispose()):this.gridHelper.material.dispose(),this.gridHelper=null),this.axesHelper&&(this.scene?.remove(this.axesHelper),this.axesHelper.geometry.dispose(),Array.isArray(this.axesHelper.material)?this.axesHelper.material.forEach(e=>e.dispose()):this.axesHelper.material.dispose(),this.axesHelper=null),this.axisLabels){const{x:e,y:t,z:i}=this.axisLabels;[e,t,i].forEach(e=>{this.scene?.remove(e),e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose(),e.material.map&&e.material.map.dispose()}),this.axisLabels=null}this.core?.dispose()}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gltf-exploder.umd.js.map
