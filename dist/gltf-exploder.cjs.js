/*!
 * gltf-exploder v0.1.7
 * (c) 2026 limin
 * Released under the MIT License.
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("three"),e=require("three/examples/jsm/loaders/GLTFLoader.js");const i={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},s={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},n={x:0,y:0},o={camera:new t.Matrix4,gizmos:new t.Matrix4},a={type:"change"},r={type:"start"},h={type:"end"},l=new t.Raycaster,c=new t.Vector3,p=new t.Matrix4,d=new t.Matrix4,u=new t.Vector3,m=1e-6;class g extends t.Controls{constructor(e,n=null,o=null){super(e,n),this.scene=o,this.target=new t.Vector3,this._currentTarget=new t.Vector3,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new t.Vector2,this._v3_1=new t.Vector3,this._v3_2=new t.Vector3,this._m4_1=new t.Matrix4,this._m4_2=new t.Matrix4,this._quat=new t.Quaternion,this._translationMatrix=new t.Matrix4,this._rotationMatrix=new t.Matrix4,this._scaleMatrix=new t.Matrix4,this._rotationAxis=new t.Vector3,this._cameraMatrixState=new t.Matrix4,this._cameraProjectionState=new t.Matrix4,this._fovState=1,this._upState=new t.Vector3,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new t.Matrix4,this._up0=new t.Vector3,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new t.Matrix4,this._gizmoMatrixState0=new t.Matrix4,this._target0=new t.Vector3,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=s.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new t.Vector3,this._startCursorPosition=new t.Vector3,this._grid=null,this._gridPosition=new t.Vector3,this._gizmos=new t.Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new t.Vector3,this._cursorPosCurr=new t.Vector3,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.rotateSpeed=1,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.enableFocus=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=i.IDLE,this.setCamera(e),null!=this.scene&&this.scene.add(this._gizmos),this.initializeMouseActions(),this._onContextMenu=b.bind(this),this._onWheel=M.bind(this),this._onPointerUp=f.bind(this),this._onPointerMove=v.bind(this),this._onPointerDown=y.bind(this),this._onPointerCancel=_.bind(this),this._onWindowResize=x.bind(this),null!==n&&this.connect(n)}connect(t){super.connect(t),this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onWheel,{passive:!1}),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),window.addEventListener("resize",this._onWindowResize)}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),window.removeEventListener("resize",this._onWindowResize)}onSinglePanStart(t,e){if(this.enabled)switch(this.dispatchEvent(r),this.setCenter(t.clientX,t.clientY),e){case"PAN":if(!this.enablePan)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(a)),this.updateTbState(i.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(a));break;case"ROTATE":if(!this.enableRotate)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(i.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.object,n.x,n.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(a);break;case"FOV":if(!this.object.isPerspectiveCamera||!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(a)),this.updateTbState(i.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(a)),this.updateTbState(i.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}onSinglePanMove(e,s){if(this.enabled){const o=s!=this._state;switch(this.setCenter(e.clientX,e.clientY),s){case i.PAN:this.enablePan&&(o?(this.dispatchEvent(h),this.dispatchEvent(r),this.updateTbState(s,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case i.ROTATE:if(this.enableRotate)if(o)this.dispatchEvent(h),this.dispatchEvent(r),this.updateTbState(s,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.object,n.x,n.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.object,n.x,n.y,this.domElement,this._tbRadius));const t=this._startCursorPosition.distanceTo(this._currentCursorPosition),e=this._startCursorPosition.angleTo(this._currentCursorPosition),i=Math.max(t/this._tbRadius,e)*this.rotateSpeed;this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),i)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=i,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case i.SCALE:if(this.enableZoom)if(o)this.dispatchEvent(h),this.dispatchEvent(r),this.updateTbState(s,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const t=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y);const e=this._currentCursorPosition.y-this._startCursorPosition.y;let i=1;e<0?i=1/Math.pow(this.scaleFactor,-e*t):e>0&&(i=Math.pow(this.scaleFactor,e*t)),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.scale(i,this._v3_1))}break;case i.FOV:if(this.enableZoom&&this.object.isPerspectiveCamera)if(o)this.dispatchEvent(h),this.dispatchEvent(r),this.updateTbState(s,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y);const i=this._currentCursorPosition.y-this._startCursorPosition.y;let s=1;i<0?s=1/Math.pow(this.scaleFactor,-i*e):i>0&&(s=Math.pow(this.scaleFactor,i*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const o=this._v3_1.distanceTo(this._gizmos.position);let a=o/s;a=t.MathUtils.clamp(a,this.minDistance,this.maxDistance);const r=o*Math.tan(t.MathUtils.DEG2RAD*this._fovState*.5);let h=t.MathUtils.RAD2DEG*(2*Math.atan(r/a));h=t.MathUtils.clamp(h,this.minFov,this.maxFov);const l=r/Math.tan(t.MathUtils.DEG2RAD*(h/2));s=o/l,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(h),this.applyTransformMatrix(this.scale(s,this._v3_2,!1)),c.copy(this._gizmos.position).sub(this.object.position).normalize().multiplyScalar(l/o),this._m4_1.makeTranslation(c.x,c.y,c.z)}}this.dispatchEvent(a)}}onSinglePanEnd(){if(this._state==i.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){const t=Math.abs((this._wPrev+this._wCurr)/2),e=this;this._animationId=window.requestAnimationFrame(function(s){e.updateTbState(i.ANIMATION_ROTATE,!0);const n=e.calculateRotationAxis(e._cursorPosPrev,e._cursorPosCurr);e.onRotationAnim(s,n,Math.min(t,e.wMax))})}else this.updateTbState(i.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(a)}else this.updateTbState(i.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(a)}else this._state!=i.PAN&&this._state!=i.IDLE||(this.updateTbState(i.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(a));this.dispatchEvent(h)}onDoubleTap(t){if(this.enabled&&this.enablePan&&this.enableFocus&&null!=this.scene){this.dispatchEvent(r),this.setCenter(t.clientX,t.clientY);const e=this.unprojectOnObj(this.getCursorNDC(n.x,n.y,this.domElement),this.object);if(null!=e&&this.enableAnimations){const t=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(s){t.updateTbState(i.ANIMATION_FOCUS,!0),t.onFocusAnim(s,e,t._cameraMatrixState,t._gizmoMatrixState)})}else null==e||this.enableAnimations||(this.updateTbState(i.FOCUS,!0),this.focus(e,this.scaleFactor),this.updateTbState(i.IDLE,!1),this.dispatchEvent(a))}this.dispatchEvent(h)}onDoublePanStart(){this.enabled&&this.enablePan&&(this.dispatchEvent(r),this.updateTbState(i.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))}onDoublePanMove(){this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=i.PAN&&(this.updateTbState(i.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(a))}onDoublePanEnd(){this.updateTbState(i.IDLE,!1),this.dispatchEvent(h)}onRotateStart(){this.enabled&&this.enableRotate&&(this.dispatchEvent(r),this.updateTbState(i.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.object.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))}onRotateMove(){if(this.enabled&&this.enableRotate){let e;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=i.ZROTATE&&(this.updateTbState(i.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),e=this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._v3_2)):e=(new t.Vector3).setFromMatrixPosition(this._gizmoMatrixState);const s=t.MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);this.applyTransformMatrix(this.zRotate(e,s)),this.dispatchEvent(a)}}onRotateEnd(){this.updateTbState(i.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(h)}onPinchStart(){this.enabled&&this.enableZoom&&(this.dispatchEvent(r),this.updateTbState(i.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}onPinchMove(){if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const t=12;this._state!=i.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(i.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),t*this._devPxRatio);const e=this._currentFingerDistance/this._startFingerDistance;let s;this.enablePan?this.object.isOrthographicCamera?s=this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._gizmos.position):this.object.isPerspectiveCamera&&(s=this.unprojectOnTbPlane(this.object,n.x,n.y,this.domElement).applyQuaternion(this.object.quaternion).add(this._gizmos.position)):s=this._gizmos.position,this.applyTransformMatrix(this.scale(e,s)),this.dispatchEvent(a)}}onPinchEnd(){this.updateTbState(i.IDLE,!1),this.dispatchEvent(h)}onTriplePanStart(){if(this.enabled&&this.enableZoom){this.dispatchEvent(r),this.updateTbState(i.SCALE,!0);let t=0,e=0;const s=this._touchCurrent.length;for(let i=0;i<s;i++)t+=this._touchCurrent[i].clientX,e+=this._touchCurrent[i].clientY;this.setCenter(t/s,e/s),this._startCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}onTriplePanMove(){if(this.enabled&&this.enableZoom){let e=0,i=0;const s=this._touchCurrent.length;for(let t=0;t<s;t++)e+=this._touchCurrent[t].clientX,i+=this._touchCurrent[t].clientY;this.setCenter(e/s,i/s);const o=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(n.x,n.y,this.domElement).y);const r=this._currentCursorPosition.y-this._startCursorPosition.y;let h=1;r<0?h=1/Math.pow(this.scaleFactor,-r*o):r>0&&(h=Math.pow(this.scaleFactor,r*o)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const l=this._v3_1.distanceTo(this._gizmos.position);let p=l/h;p=t.MathUtils.clamp(p,this.minDistance,this.maxDistance);const d=l*Math.tan(t.MathUtils.DEG2RAD*this._fovState*.5);let u=t.MathUtils.RAD2DEG*(2*Math.atan(d/p));u=t.MathUtils.clamp(u,this.minFov,this.maxFov);const m=d/Math.tan(t.MathUtils.DEG2RAD*(u/2));h=l/m,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(u),this.applyTransformMatrix(this.scale(h,this._v3_2,!1)),c.copy(this._gizmos.position).sub(this.object.position).normalize().multiplyScalar(m/l),this._m4_1.makeTranslation(c.x,c.y,c.z),this.dispatchEvent(a)}}onTriplePanEnd(){this.updateTbState(i.IDLE,!1),this.dispatchEvent(h)}setCenter(t,e){n.x=t,n.y=e}initializeMouseActions(){this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}compareMouseAction(t,e){return t.operation==e.operation&&(t.mouse==e.mouse&&t.key==e.key)}setMouseAction(t,e,s=null){let n;if(!["PAN","ROTATE","ZOOM","FOV"].includes(t)||![0,1,2,"WHEEL"].includes(e)||!["CTRL","SHIFT",null].includes(s))return!1;if("WHEEL"==e&&"ZOOM"!=t&&"FOV"!=t)return!1;switch(t){case"PAN":n=i.PAN;break;case"ROTATE":n=i.ROTATE;break;case"ZOOM":n=i.SCALE;break;case"FOV":n=i.FOV}const o={operation:t,mouse:e,key:s,state:n};for(let t=0;t<this.mouseActions.length;t++)if(this.mouseActions[t].mouse==o.mouse&&this.mouseActions[t].key==o.key)return this.mouseActions.splice(t,1,o),!0;return this.mouseActions.push(o),!0}unsetMouseAction(t,e=null){for(let i=0;i<this.mouseActions.length;i++)if(this.mouseActions[i].mouse==t&&this.mouseActions[i].key==e)return this.mouseActions.splice(i,1),!0;return!1}getOpFromAction(t,e){let i;for(let s=0;s<this.mouseActions.length;s++)if(i=this.mouseActions[s],i.mouse==t&&i.key==e)return i.operation;if(null!=e)for(let e=0;e<this.mouseActions.length;e++)if(i=this.mouseActions[e],i.mouse==t&&null==i.key)return i.operation;return null}getOpStateFromAction(t,e){let i;for(let s=0;s<this.mouseActions.length;s++)if(i=this.mouseActions[s],i.mouse==t&&i.key==e)return i.state;if(null!=e)for(let e=0;e<this.mouseActions.length;e++)if(i=this.mouseActions[e],i.mouse==t&&null==i.key)return i.state;return null}getAngle(t,e){return 180*Math.atan2(e.clientY-t.clientY,e.clientX-t.clientX)/Math.PI}updateTouchEvent(t){for(let e=0;e<this._touchCurrent.length;e++)if(this._touchCurrent[e].pointerId==t.pointerId){this._touchCurrent.splice(e,1,t);break}}applyTransformMatrix(e){if(null!=e.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.updateMatrix(),this._state!=i.ROTATE&&this._state!=i.ZROTATE&&this._state!=i.ANIMATION_ROTATE||this.object.up.copy(this._upState).applyQuaternion(this.object.quaternion)),null!=e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==i.SCALE||this._state==i.FOCUS||this._state==i.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.object),this.adjustNearFar){const e=this.object.position.distanceTo(this._gizmos.position),i=new t.Box3;i.setFromObject(this._gizmos);const s=new t.Sphere;i.getBoundingSphere(s);const n=Math.max(this._nearPos0,s.radius+s.center.length()),o=e-this._initialNear,a=Math.min(n,o);this.object.near=e-a;const r=Math.min(this._farPos0,-s.radius+s.center.length()),h=e-this._initialFar,l=Math.min(r,h);this.object.far=e-l,this.object.updateProjectionMatrix()}else{let t=!1;this.object.near!=this._initialNear&&(this.object.near=this._initialNear,t=!0),this.object.far!=this._initialFar&&(this.object.far=this._initialFar,t=!0),t&&this.object.updateProjectionMatrix()}}calculateAngularSpeed(t,e,i,s){const n=(s-i)/1e3;return 0==n?0:(e-t)/n}calculatePointersDistance(t,e){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))}calculateRotationAxis(t,e){return this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(t,e).applyQuaternion(this._quat),this._rotationAxis.normalize().clone()}calculateTbRadius(e){const i=e.position.distanceTo(this._gizmos.position);if("PerspectiveCamera"==e.type){const s=t.MathUtils.DEG2RAD*e.fov*.5,n=Math.atan(e.aspect*Math.tan(s));return Math.tan(Math.min(s,n))*i*this.radiusFactor}if("OrthographicCamera"==e.type)return Math.min(e.top,e.right)*this.radiusFactor}focus(t,e,i=1){c.copy(t).sub(this._gizmos.position).multiplyScalar(i),this._translationMatrix.makeTranslation(c.x,c.y,c.z),p.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),d.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(e,this._gizmos.position)),this._gizmoMatrixState.copy(p),this._cameraMatrixState.copy(d)}drawGrid(){if(null!=this.scene){const e=8947848,i=3;let s,n,o,a;if(this.object.isOrthographicCamera){const t=this.object.right-this.object.left,e=this.object.bottom-this.object.top;o=Math.max(t,e),a=o/20,s=o/this.object.zoom*i,n=s/a*this.object.zoom}else if(this.object.isPerspectiveCamera){const e=this.object.position.distanceTo(this._gizmos.position),r=t.MathUtils.DEG2RAD*this.object.fov*.5,h=Math.atan(this.object.aspect*Math.tan(r));o=Math.tan(Math.max(r,h))*e*2,a=o/20,s=o*i,n=s/a}null==this._grid&&(this._grid=new t.GridHelper(s,n,e,e),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.object.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}dispose(){-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this.disconnect(),null!==this.scene&&this.scene.remove(this._gizmos),this.disposeGrid()}disposeGrid(){null!=this._grid&&null!=this.scene&&(this.scene.remove(this._grid),this._grid=null)}easeOutCubic(t){return 1-Math.pow(1-t,3)}activateGizmos(t){const e=this._gizmos.children[0],i=this._gizmos.children[1],s=this._gizmos.children[2];t?(e.material.setValues({opacity:1}),i.material.setValues({opacity:1}),s.material.setValues({opacity:1})):(e.material.setValues({opacity:.6}),i.material.setValues({opacity:.6}),s.material.setValues({opacity:.6}))}getCursorNDC(t,e,i){const s=i.getBoundingClientRect();return this._v2_1.setX((t-s.left)/s.width*2-1),this._v2_1.setY((s.bottom-e)/s.height*2-1),this._v2_1.clone()}getCursorPosition(t,e,i){return this._v2_1.copy(this.getCursorNDC(t,e,i)),this._v2_1.x*=.5*(this.object.right-this.object.left),this._v2_1.y*=.5*(this.object.top-this.object.bottom),this._v2_1.clone()}setCamera(t){t.lookAt(this.target),t.updateMatrix(),"PerspectiveCamera"==t.type&&(this._fov0=t.fov,this._fovState=t.fov),this._cameraMatrixState0.copy(t.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(t.projectionMatrix),this._zoom0=t.zoom,this._zoomState=this._zoom0,this._initialNear=t.near,this._nearPos0=t.position.distanceTo(this.target)-t.near,this._nearPos=this._initialNear,this._initialFar=t.far,this._farPos0=t.position.distanceTo(this.target)-t.far,this._farPos=this._initialFar,this._up0.copy(t.up),this._upState.copy(t.up),this.object=t,this.object.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(t),this.makeGizmos(this.target,this._tbRadius)}setGizmosVisible(t){this._gizmos.visible=t,this.dispatchEvent(a)}setTbRadius(e){this.radiusFactor=e,this._tbRadius=this.calculateTbRadius(this.object);const i=new t.EllipseCurve(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),s=(new t.BufferGeometry).setFromPoints(i);for(const t in this._gizmos.children)this._gizmos.children[t].geometry=s;this.dispatchEvent(a)}makeGizmos(e,i){const s=new t.EllipseCurve(0,0,i,i).getPoints(this._curvePts),n=(new t.BufferGeometry).setFromPoints(s),o=new t.LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),a=new t.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),r=new t.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),h=new t.Line(n,o),l=new t.Line(n,a),c=new t.Line(n,r),p=.5*Math.PI;if(h.rotation.x=p,l.rotation.y=p,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),1!==this.object.zoom){const t=1/this.object.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.traverse(function(t){t.isLine&&(t.geometry.dispose(),t.material.dispose())}),this._gizmos.clear(),this._gizmos.add(h),this._gizmos.add(l),this._gizmos.add(c)}onFocusAnim(t,e,s,n){if(-1==this._timeStart&&(this._timeStart=t),this._state==i.ANIMATION_FOCUS){const o=(t-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(n),o>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(e,this.scaleFactor),this._timeStart=-1,this.updateTbState(i.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(a);else{const t=this.easeOutCubic(o),i=1-t+this.scaleFactor*t;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(e,i,t),this.dispatchEvent(a);const r=this;this._animationId=window.requestAnimationFrame(function(t){r.onFocusAnim(t,e,s,n.clone())})}}else this._animationId=-1,this._timeStart=-1}onRotationAnim(t,e,s){if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=t),this._state==i.ANIMATION_ROTATE){const n=(t-this._timeStart)/1e3;if(s+-this.dampingFactor*n>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(n,2)+s*n+0,this.applyTransformMatrix(this.rotate(e,this._angleCurrent)),this.dispatchEvent(a);const t=this;this._animationId=window.requestAnimationFrame(function(i){t.onRotationAnim(i,e,s)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(i.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(a)}else this._animationId=-1,this._timeStart=-1,this._state!=i.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(a))}pan(t,e,i=!1){const s=t.clone().sub(e);if(this.object.isOrthographicCamera)s.multiplyScalar(1/this.object.zoom);else if(this.object.isPerspectiveCamera&&i){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const t=this._v3_1.distanceTo(this._v3_2)/this.object.position.distanceTo(this._gizmos.position);s.multiplyScalar(1/t)}return this._v3_1.set(s.x,s.y,0).applyQuaternion(this.object.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),o}reset(){this.target.copy(this._target0),this.object.zoom=this._zoom0,this.object.isPerspectiveCamera&&(this.object.fov=this._fov0),this.object.near=this._nearPos,this.object.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.up.copy(this._up0),this.object.updateMatrix(),this.object.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.object),this.makeGizmos(this._gizmos.position,this._tbRadius),this.object.lookAt(this._gizmos.position),this.updateTbState(i.IDLE,!1),this.dispatchEvent(a)}rotate(t,e){const i=this._gizmos.position;return this._translationMatrix.makeTranslation(-i.x,-i.y,-i.z),this._rotationMatrix.makeRotationAxis(t,-e),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),o}copyState(){let t;this.object.isOrthographicCamera?t=JSON.stringify({arcballState:{cameraFar:this.object.far,cameraMatrix:this.object.matrix,cameraNear:this.object.near,cameraUp:this.object.up,cameraZoom:this.object.zoom,gizmoMatrix:this._gizmos.matrix,target:this.target}}):this.object.isPerspectiveCamera&&(t=JSON.stringify({arcballState:{cameraFar:this.object.far,cameraFov:this.object.fov,cameraMatrix:this.object.matrix,cameraNear:this.object.near,cameraUp:this.object.up,cameraZoom:this.object.zoom,gizmoMatrix:this._gizmos.matrix,target:this.target}})),navigator.clipboard.writeText(t)}pasteState(){const t=this;navigator.clipboard.readText().then(function(e){t.setStateFromJSON(e)})}saveState(){this.object.updateMatrix(),this._gizmos.updateMatrix(),this._target0.copy(this.target),this._cameraMatrixState0.copy(this.object.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.object.near,this._farPos=this.object.far,this._zoom0=this.object.zoom,this._up0.copy(this.object.up),this.object.isPerspectiveCamera&&(this._fov0=this.object.fov)}scale(t,e,i=!0){u.copy(e);let s=1/t;if(this.object.isOrthographicCamera){this.object.zoom=this._zoomState,this.object.zoom*=t,this.object.zoom>this.maxZoom?(this.object.zoom=this.maxZoom,s=this._zoomState/this.maxZoom):this.object.zoom<this.minZoom&&(this.object.zoom=this.minZoom,s=this._zoomState/this.minZoom),this.object.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(s,s,s),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),u.sub(this._v3_1);const e=u.clone().multiplyScalar(s);return u.sub(e),this._m4_1.makeTranslation(u.x,u.y,u.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),o}if(this.object.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let t=this._v3_1.distanceTo(u),e=t-t*s;const n=t-e;if(n<this.minDistance?(s=this.minDistance/t,e=t-t*s):n>this.maxDistance&&(s=this.maxDistance/t,e=t-t*s),c.copy(u).sub(this._v3_1).normalize().multiplyScalar(e),this._m4_1.makeTranslation(c.x,c.y,c.z),i){const i=this._v3_2;t=i.distanceTo(u),e=t-t*s,c.copy(u).sub(this._v3_2).normalize().multiplyScalar(e),this._translationMatrix.makeTranslation(i.x,i.y,i.z),this._scaleMatrix.makeScale(s,s,s),this._m4_2.makeTranslation(c.x,c.y,c.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-i.x,-i.y,-i.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return o}}setFov(e){this.object.isPerspectiveCamera&&(this.object.fov=t.MathUtils.clamp(e,this.minFov,this.maxFov),this.object.updateProjectionMatrix())}setTransformationMatrices(t=null,e=null){null!=t?null!=o.camera?o.camera.copy(t):o.camera=t.clone():o.camera=null,null!=e?null!=o.gizmos?o.gizmos.copy(e):o.gizmos=e.clone():o.gizmos=null}zRotate(t,e){return this._rotationMatrix.makeRotationAxis(this._rotationAxis,e),this._translationMatrix.makeTranslation(-t.x,-t.y,-t.z),this._m4_1.makeTranslation(t.x,t.y,t.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(t),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,e),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),o}getRaycaster(){return l}unprojectOnObj(t,e){const i=this.getRaycaster();i.near=e.near,i.far=e.far,i.setFromCamera(t,e);const s=i.intersectObjects(this.scene.children,!0);for(let t=0;t<s.length;t++)if(s[t].object.uuid!=this._gizmos.uuid&&null!=s[t].face)return s[t].point.clone();return null}unprojectOnTbSurface(e,i,s,n,o){if("OrthographicCamera"==e.type){this._v2_1.copy(this.getCursorPosition(i,s,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const t=Math.pow(this._v2_1.x,2),e=Math.pow(this._v2_1.y,2),o=Math.pow(this._tbRadius,2);return t+e<=.5*o?this._v3_1.setZ(Math.sqrt(o-(t+e))):this._v3_1.setZ(.5*o/Math.sqrt(t+e)),this._v3_1}if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(i,s,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const a=this._v3_1.clone().normalize(),r=e.position.distanceTo(this._gizmos.position),h=Math.pow(o,2),l=this._v3_1.z,c=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==c)return a.set(this._v3_1.x,this._v3_1.y,o),a;const p=l/c,d=r;let u=Math.pow(p,2)+1,m=2*p*d,g=Math.pow(d,2)-h,x=Math.pow(m,2)-4*u*g;if(x>=0){this._v2_1.setX((-m-Math.sqrt(x))/(2*u)),this._v2_1.setY(p*this._v2_1.x+d);if(t.MathUtils.RAD2DEG*this._v2_1.angle()>=45){const t=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(r-this._v2_1.y,2));return a.multiplyScalar(t),a.z+=r,a}}u=p,m=d,g=.5*-h,x=Math.pow(m,2)-4*u*g,this._v2_1.setX((-m-Math.sqrt(x))/(2*u)),this._v2_1.setY(p*this._v2_1.x+d);const b=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(r-this._v2_1.y,2));return a.multiplyScalar(b),a.z+=r,a}}unprojectOnTbPlane(t,e,i,s,n=!1){if("OrthographicCamera"==t.type)return this._v2_1.copy(this.getCursorPosition(e,i,s)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if("PerspectiveCamera"==t.type){this._v2_1.copy(this.getCursorNDC(e,i,s)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(t.projectionMatrixInverse);const o=this._v3_1.clone().normalize(),a=this._v3_1.z,r=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let h;if(h=n?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):t.position.distanceTo(this._gizmos.position),0==r)return o.set(0,0,0),o;const l=h,c=-l/(a/r),p=Math.sqrt(Math.pow(l,2)+Math.pow(c,2));return o.multiplyScalar(p),o.z=0,o}}updateMatrixState(){this._cameraMatrixState.copy(this.object.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.object.isOrthographicCamera?(this._cameraProjectionState.copy(this.object.projectionMatrix),this.object.updateProjectionMatrix(),this._zoomState=this.object.zoom):this.object.isPerspectiveCamera&&(this._fovState=this.object.fov)}updateTbState(t,e){this._state=t,e&&this.updateMatrixState()}update(){if(!1===this.target.equals(this._currentTarget)&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.object),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.object.isOrthographicCamera){if(this.object.zoom>this.maxZoom||this.object.zoom<this.minZoom){const e=t.MathUtils.clamp(this.object.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(e/this.object.zoom,this._gizmos.position,!0))}}else if(this.object.isPerspectiveCamera){const e=this.object.position.distanceTo(this._gizmos.position);if(e>this.maxDistance+m||e<this.minDistance-m){const i=t.MathUtils.clamp(e,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(i/e,this._gizmos.position)),this.updateMatrixState()}(this.object.fov<this.minFov||this.object.fov>this.maxFov)&&(this.object.fov=t.MathUtils.clamp(this.object.fov,this.minFov,this.maxFov),this.object.updateProjectionMatrix());const i=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.object),i<this._tbRadius-m||i>this._tbRadius+m){const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,i=this._tbRadius/e,s=new t.EllipseCurve(0,0,i,i).getPoints(this._curvePts),n=(new t.BufferGeometry).setFromPoints(s);for(const t in this._gizmos.children)this._gizmos.children[t].geometry=n}}this.object.lookAt(this._gizmos.position)}setStateFromJSON(e){const s=JSON.parse(e);if(null!=s.arcballState){this.target.fromArray(s.arcballState.target),this._cameraMatrixState.fromArray(s.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.up.copy(s.arcballState.cameraUp),this.object.near=s.arcballState.cameraNear,this.object.far=s.arcballState.cameraFar,this.object.zoom=s.arcballState.cameraZoom,this.object.isPerspectiveCamera&&(this.object.fov=s.arcballState.cameraFov),this._gizmoMatrixState.fromArray(s.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.object.updateMatrix(),this.object.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.object);const e=(new t.Matrix4).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(e),this.object.lookAt(this._gizmos.position),this.updateTbState(i.IDLE,!1),this.dispatchEvent(a)}}}function x(){const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.object);const i=this._tbRadius/e,s=new t.EllipseCurve(0,0,i,i).getPoints(this._curvePts),n=(new t.BufferGeometry).setFromPoints(s);for(const t in this._gizmos.children)this._gizmos.children[t].geometry=n;this.dispatchEvent(a)}function b(t){if(this.enabled)for(let e=0;e<this.mouseActions.length;e++)if(2==this.mouseActions[e].mouse){t.preventDefault();break}}function _(){this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=s.NONE}function y(t){if(0==t.button&&t.isPrimary?(this._downValid=!0,this._downEvents.push(t),this._downStart=performance.now()):this._downValid=!1,"touch"==t.pointerType&&this._input!=s.CURSOR)switch(this._touchStart.push(t),this._touchCurrent.push(t),this._input){case s.NONE:this._input=s.ONE_FINGER,this.onSinglePanStart(t,"ROTATE"),window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp);break;case s.ONE_FINGER:case s.ONE_FINGER_SWITCHED:this._input=s.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case s.TWO_FINGER:this._input=s.MULT_FINGER,this.onTriplePanStart(t)}else if("touch"!=t.pointerType&&this._input==s.NONE){let e=null;t.ctrlKey||t.metaKey?e="CTRL":t.shiftKey&&(e="SHIFT"),this._mouseOp=this.getOpFromAction(t.button,e),null!=this._mouseOp&&(window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp),this._input=s.CURSOR,this._button=t.button,this.onSinglePanStart(t,this._mouseOp))}}function v(t){if("touch"==t.pointerType&&this._input!=s.CURSOR)switch(this._input){case s.ONE_FINGER:this.updateTouchEvent(t),this.onSinglePanMove(t,i.ROTATE);break;case s.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],t)*this._devPxRatio>=this._switchSensibility){this._input=s.ONE_FINGER,this.updateTouchEvent(t),this.onSinglePanStart(t,"ROTATE");break}break;case s.TWO_FINGER:this.updateTouchEvent(t),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case s.MULT_FINGER:this.updateTouchEvent(t),this.onTriplePanMove(t)}else if("touch"!=t.pointerType&&this._input==s.CURSOR){let e=null;t.ctrlKey||t.metaKey?e="CTRL":t.shiftKey&&(e="SHIFT");const i=this.getOpStateFromAction(this._button,e);null!=i&&this.onSinglePanMove(t,i)}if(this._downValid){this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],t)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}}function f(t){if("touch"==t.pointerType&&this._input!=s.CURSOR){const e=this._touchCurrent.length;for(let i=0;i<e;i++)if(this._touchCurrent[i].pointerId==t.pointerId){this._touchCurrent.splice(i,1),this._touchStart.splice(i,1);break}switch(this._input){case s.ONE_FINGER:case s.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=s.NONE,this.onSinglePanEnd();break;case s.TWO_FINGER:this.onDoublePanEnd(t),this.onPinchEnd(t),this.onRotateEnd(t),this._input=s.ONE_FINGER_SWITCHED;break;case s.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=s.NONE,this.onTriplePanEnd())}}else"touch"!=t.pointerType&&this._input==s.CURSOR&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=s.NONE,this.onSinglePanEnd(),this._button=-1);if(t.isPrimary)if(this._downValid){if(t.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const e=t.timeStamp-this._clickStart,i=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;e<=this._maxInterval&&i<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(t)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}function M(e){if(this.enabled&&this.enableZoom){let s=null;e.ctrlKey||e.metaKey?s="CTRL":e.shiftKey&&(s="SHIFT");const n=this.getOpFromAction("WHEEL",s);if(null!=n){e.preventDefault(),this.dispatchEvent(r);const s=125;let o=e.deltaY/s,l=1;switch(o>0?l=1/this.scaleFactor:o<0&&(l=this.scaleFactor),n){case"ZOOM":if(this.updateTbState(i.SCALE,!0),o>0?l=1/Math.pow(this.scaleFactor,o):o<0&&(l=Math.pow(this.scaleFactor,-o)),this.cursorZoom&&this.enablePan){let t;this.object.isOrthographicCamera?t=this.unprojectOnTbPlane(this.object,e.clientX,e.clientY,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._gizmos.position):this.object.isPerspectiveCamera&&(t=this.unprojectOnTbPlane(this.object,e.clientX,e.clientY,this.domElement).applyQuaternion(this.object.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(l,t))}else this.applyTransformMatrix(this.scale(l,this._gizmos.position));null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(i.IDLE,!1),this.dispatchEvent(a),this.dispatchEvent(h);break;case"FOV":if(this.object.isPerspectiveCamera){this.updateTbState(i.FOV,!0),0!=e.deltaX&&(o=e.deltaX/s,l=1,o>0?l=1/Math.pow(this.scaleFactor,o):o<0&&(l=Math.pow(this.scaleFactor,-o))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const n=this._v3_1.distanceTo(this._gizmos.position);let a=n/l;a=t.MathUtils.clamp(a,this.minDistance,this.maxDistance);const r=n*Math.tan(t.MathUtils.DEG2RAD*this.object.fov*.5);let h=t.MathUtils.RAD2DEG*(2*Math.atan(r/a));h>this.maxFov?h=this.maxFov:h<this.minFov&&(h=this.minFov);l=n/(r/Math.tan(t.MathUtils.DEG2RAD*(h/2))),this.setFov(h),this.applyTransformMatrix(this.scale(l,this._gizmos.position,!1))}null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(i.IDLE,!1),this.dispatchEvent(a),this.dispatchEvent(h)}}}}var w;!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(":root{--exploder-accent:#2563eb;--exploder-bg-main:#fff;--exploder-bg-sub:#f9fafb;--exploder-border:#e5e7eb;--exploder-text-main:#1f2937;--exploder-text-sub:#6b7280;--exploder-text-muted:#9ca3af}.exploder-ui-root{color:var(--exploder-text-main);font-family:Satoshi,Inter,-apple-system,sans-serif}.exploder-viewport-grid{background-image:linear-gradient(90deg,rgba(0,0,0,.03) 1px,transparent 0),linear-gradient(180deg,rgba(0,0,0,.03) 1px,transparent 0);background-size:40px 40px}.exploder-status-dot{background-color:#10b981;border-radius:50%;display:inline-block;height:8px;width:8px}.exploder-animate-pulse{animation:exploder-pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes exploder-pulse{0%,to{opacity:1}50%{opacity:.5}}.exploder-scrollbar::-webkit-scrollbar{width:4px}.exploder-scrollbar::-webkit-scrollbar-thumb{background:var(--exploder-border);border-radius:10px}.exploder-slider{align-items:center;-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;display:flex;height:32px;width:100%}.exploder-slider::-webkit-slider-runnable-track{background:#f3f4f6;border-radius:3px;height:6px;transition:background .2s}.exploder-slider:active::-webkit-slider-runnable-track{background:#e5e7eb}.exploder-slider::-webkit-slider-thumb{-webkit-appearance:none;background:var(--exploder-accent);border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.1);height:18px;margin-top:-6px;transition:transform .2s,box-shadow .2s;width:18px}.exploder-slider:active::-webkit-slider-thumb{box-shadow:0 0 0 10px rgba(37,99,235,.1);transform:scale(1.2)}@media (max-width:768px){.exploder-slider{height:44px}.exploder-slider::-webkit-slider-thumb{box-shadow:0 4px 6px rgba(0,0,0,.15);height:28px;margin-top:-11px;width:28px}.exploder-slider::-moz-range-thumb{border:2px solid #fff;height:28px;width:28px}.exploder-slider::-webkit-slider-runnable-track{border-radius:4px;height:8px}}.exploder-mode-btn{align-items:center;background:var(--exploder-bg-sub);border:1px solid transparent;border-radius:12px;color:var(--exploder-text-sub);cursor:pointer;display:flex;flex-direction:column;font-size:12px;font-weight:600;gap:6px;padding:10px;transition:all .2s}.exploder-mode-btn:hover{border-color:var(--exploder-border)}.exploder-mode-btn.active{background:#eff6ff;border-color:#bfdbfe;color:var(--exploder-accent)}.exploder-card{background:var(--exploder-bg-main);border:1px solid var(--exploder-border);border-radius:20px;box-shadow:0 10px 15px -3px rgba(0,0,0,.05),0 4px 6px -2px rgba(0,0,0,.02)}.exploder-h-screen{height:100vh}.exploder-flex{display:flex}.exploder-flex-col{flex-direction:column}.exploder-flex-row{flex-direction:row}.exploder-flex-1{flex:1 1 0%}.exploder-relative{position:relative}.exploder-absolute{position:absolute}.exploder-inset-0{bottom:0;left:0;right:0;top:0}.exploder-overflow-hidden{overflow:hidden}.exploder-bg-white{background-color:var(--exploder-bg-main)}.exploder-z-20{z-index:20}@media (min-width:768px){.exploder-md-flex-row{flex-direction:row}}.exploder-scroll-guide{align-items:center;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);background:rgba(239,246,255,.3);border-radius:0;border-right:1px solid rgba(219,234,254,.5);bottom:0;box-shadow:4px 0 20px rgba(37,99,235,.05);display:none;flex-direction:column;gap:6px;justify-content:center;left:0;pointer-events:auto;position:absolute;top:0;transition:all .3s;width:12%;z-index:100}.exploder-scroll-texture{display:flex;flex-direction:column;gap:6px;opacity:.25;transition:opacity .2s}.exploder-scroll-guide:active .exploder-scroll-texture{opacity:.5}.exploder-scroll-dot{background:#2563eb;border-radius:50%;height:4px;width:4px}.exploder-scroll-guide-label{color:rgba(37,99,235,.4);font-size:8px;font-weight:800;letter-spacing:.3em;margin-top:16px;pointer-events:none;text-transform:uppercase;user-select:none;white-space:nowrap;writing-mode:vertical-lr}@media (max-width:768px){.exploder-scroll-guide{display:flex}}@keyframes exploder-bounce-slow{0%,to{transform:translateY(0)}50%{transform:translateY(-8px)}}"),function(t){t.RADIAL="radial",t.AXIAL="axial",t.NORMALIZED_RADIAL="normalized_radial",t.SIZE_WEIGHTED="size_weighted",t.HIERARCHICAL="hierarchical",t.FORCE_FIELD="force_field"}(w||(w={}));const E={PROGRESS:{DEFAULT:0,MIN:0,MAX:1,STEP:.01},MULTIPLIER:{DEFAULT:1,MIN:.1,MAX:5,STEP:.1},EXPOSURE:{DEFAULT:1,MIN:.1,MAX:6,STEP:.1},DEFAULT_DURATION:1e3,DEFAULT_MAX_DISTANCE:2,DEFAULT_ADAPT_SIZE:5,WEIGHTS:{BASE:.5,SCALE:1.5,FORCE_FIELD_OFFSET:.2},LIGHTS:{SCENE:{AMBIENT:.2,HEMISPHERE:.3,MAIN_DIRECTIONAL:.5,BACK_DIRECTIONAL:.3,SIDE_DIRECTIONAL:.2},INTERNAL:{AMBIENT:.4,HEMISPHERE:.4,DIRECTIONAL:.8}},INTERACTION:{HIGHLIGHT_COLOR:6600182,HOVER_OPACITY:.8,SELECT_OPACITY:1,EMISSIVE_INTENSITY:.5},DIRECTION:{MIN_LENGTH:.001,ANGLE_FACTOR:.017453292519943295,Z_FACTOR:.5,INDEX_ANGLE:.7853981633974483,XY_OFFSET:.2,Z_OFFSET:.1}};function S(e,i="#2563EB"){const s=document.createElement("canvas"),n=128;s.width=n,s.height=n;const o=s.getContext("2d");o&&(o.beginPath(),o.arc(64,64,n/2.2,0,2*Math.PI),o.fillStyle=i,o.fill(),o.font="bold 72px Inter, system-ui, -apple-system, sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#FFFFFF",o.fillText(e,64,64));const a=new t.CanvasTexture(s),r=new t.SpriteMaterial({map:a,transparent:!0}),h=new t.Sprite(r);return h.scale.set(.4,.4,1),h}function C(e,i){const s=new t.Vector3;e.getWorldPosition(s);const n=(new t.Vector3).subVectors(s,i);if(n.length()<E.DIRECTION.MIN_LENGTH){const t=function(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return Math.abs(e%360)}(e.uuid||"");if(n.set(Math.cos(t*E.DIRECTION.ANGLE_FACTOR),Math.sin(t*E.DIRECTION.ANGLE_FACTOR),Math.cos(t*E.DIRECTION.Z_FACTOR)),e.parent){const t=e.parent.children.indexOf(e);t>=0&&(n.x+=Math.cos(t*E.DIRECTION.INDEX_ANGLE)*E.DIRECTION.XY_OFFSET,n.y+=Math.sin(t*E.DIRECTION.INDEX_ANGLE)*E.DIRECTION.XY_OFFSET,n.z+=(t%3-1)*E.DIRECTION.Z_OFFSET)}}return n.normalize()}function P(t,e,i){return Math.max(e,Math.min(i,t))}function T(t){let e=0;return t.traverse(t=>{if(t.isMesh&&t.geometry){const i=t.geometry;i.index?e+=i.index.count/3:i.attributes.position&&(e+=i.attributes.position.count/3)}}),Math.floor(e)}function A(t){if(!t)return"Unknown Model";const e=t.split("/");return e[e.length-1].split("?")[0]}function z(){return"undefined"!=typeof window&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768)}class D{constructor(e,i,s,n,o={}){this.progress=E.PROGRESS.DEFAULT,this.multiplier=E.MULTIPLIER.DEFAULT,this.mode=w.RADIAL,this.originalPositions=new Map,this.originalRotations=new Map,this.originalScales=new Map,this.explodeDirections=new Map,this.axialDistances=new Map,this.sizeWeights=new Map,this.hierarchicalDepths=new Map,this.modelRadius=1,this.onProgressChangeCallback=null,this.explodableMeshes=[],this.internalLights=[],this.model=e,this.scene=i,this.camera=s,this.renderer=n,this.options={maxDistance:o.maxDistance??E.DEFAULT_MAX_DISTANCE,duration:o.duration??E.DEFAULT_DURATION,createUI:o.createUI??!0,viewport:o.viewport??document.body,uiStyle:o.uiStyle??{width:"200px",height:"30px",position:"bottom"},directionStrategy:o.directionStrategy??C,mode:o.mode??w.RADIAL,axialVector:o.axialVector??new t.Vector3(0,1,0),adaptModel:o.adaptModel??!0,model:o.model??e,modelUrl:o.modelUrl||"",showUpload:o.showUpload??!1,showHelpers:o.showHelpers??!1,showPanel:o.showPanel??!0,showProgress:o.showProgress??!0,wheelControlExplosion:o.wheelControlExplosion??!1,models:o.models??[],initialModel:o.initialModel??""},this.mode=this.options.mode,this.options.adaptModel&&this.adaptModelToScene();const a=(new t.Box3).setFromObject(this.model);this.modelCenter=a.getCenter(new t.Vector3);const r=a.getBoundingSphere(new t.Sphere);this.modelRadius=r.radius||1,this.saveOriginalTransforms(this.model),this.setupInternalLighting()}adaptModelToScene(){const e=(new t.Box3).setFromObject(this.model).getSize(new t.Vector3),i=Math.max(e.x,e.y,e.z);if(i>0){const e=E.DEFAULT_ADAPT_SIZE/i;this.model.scale.multiplyScalar(e);const s=(new t.Box3).setFromObject(this.model).getCenter(new t.Vector3);this.model.position.sub(s)}}setupInternalLighting(){const e=new t.AmbientLight(16777215,E.LIGHTS.INTERNAL.AMBIENT);this.scene.add(e),this.internalLights.push(e);const i=new t.HemisphereLight(16777215,4473924,E.LIGHTS.INTERNAL.HEMISPHERE);this.scene.add(i),this.internalLights.push(i);const s=new t.Object3D;this.camera.add(s);for(let e=0;e<3;e++){const i=e/3*Math.PI*2,n=3*Math.cos(i),o=3*Math.sin(i),a=new t.DirectionalLight(16777215,E.LIGHTS.INTERNAL.DIRECTIONAL);a.position.set(n,o,1);const r=new t.Object3D;r.position.set(0,0,-5),s.add(r),a.target=r,s.add(a),this.internalLights.push(a)}const n=.8*E.LIGHTS.INTERNAL.DIRECTIONAL,o=new t.DirectionalLight(16777215,n);o.position.set(5,5,2);const a=new t.Object3D;a.position.set(0,0,-5),s.add(a),o.target=a,s.add(o),this.internalLights.push(o)}setInternalLightingVisible(t){this.internalLights.forEach(e=>{e.visible=t}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}setInternalLightingExposure(e){this.internalLights.forEach(i=>{i instanceof t.AmbientLight?i.intensity=E.LIGHTS.INTERNAL.AMBIENT*e:i instanceof t.HemisphereLight?i.intensity=E.LIGHTS.INTERNAL.HEMISPHERE*e:i instanceof t.DirectionalLight&&(i.intensity=E.LIGHTS.INTERNAL.DIRECTIONAL*e)}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}calculateAxialDistances(){const e=this.options.axialVector.clone().normalize(),i=(new t.Box3).setFromObject(this.model),s=i.min.dot(e),n=i.max.dot(e),o=Math.abs(n-s),a=o>1e-4?1/o:1;for(const t of this.explodableMeshes){const i=this.originalPositions.get(t);if(i){const s=i.clone().sub(this.modelCenter).dot(e);this.axialDistances.set(t,s*a)}}}saveOriginalTransforms(t){this.traverseAndSave(t),this.calculateAxialDistances(),this.calculateSizeWeights(),this.calculateHierarchicalDepths()}calculateHierarchicalDepths(){let t=0;const e=new Map;for(const i of this.explodableMeshes){let s=0,n=i.parent;for(;n&&n!==this.model;)s++,n=n.parent;e.set(i,s),t=Math.max(t,s)}const i=t>0?1/t:1;for(const[t,s]of e)this.hierarchicalDepths.set(t,E.WEIGHTS.BASE+s*i*E.WEIGHTS.SCALE)}calculateSizeWeights(){let e=0;const i=new Map;for(const s of this.explodableMeshes)if(s instanceof t.Mesh){const n=s.geometry;n.boundingBox||n.computeBoundingBox();const o=n.boundingBox;if(o){const n=new t.Vector3;o.getSize(n);const a=n.x*n.y*n.z;i.set(s,a),e=Math.max(e,a)}}const s=e>0?1/e:1;for(const[t,e]of i)this.sizeWeights.set(t,E.WEIGHTS.BASE+e*s*E.WEIGHTS.SCALE)}traverseAndSave(e){if(!e.visible)return;const i=new t.Vector3;if(e.getWorldPosition(i),this.originalPositions.set(e,i.clone()),e.rotation&&this.originalRotations.set(e,e.rotation.clone()),e.scale&&this.originalScales.set(e,e.scale.clone()),"isMesh"in e&&!0===e.isMesh){this.explodableMeshes.push(e);const t=this.options.directionStrategy(e,this.modelCenter);this.explodeDirections.set(e,t)}e.children.forEach(t=>{this.traverseAndSave(t)})}setModel(e){this.reset(),this.model=e,this.options.adaptModel&&this.adaptModelToScene();const i=(new t.Box3).setFromObject(this.model);this.modelCenter=i.getCenter(new t.Vector3);const s=i.getBoundingSphere(new t.Sphere);this.modelRadius=s.radius||1,this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.saveOriginalTransforms(this.model),this.updateInternalLighting(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateInternalLighting(){const e=3*this.modelRadius,i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],s=this.internalLights.filter(e=>e instanceof t.DirectionalLight);s.length===i.length?s.forEach((t,s)=>{const[n,o,a]=i[s];t.position.set(this.modelCenter.x+n*e,this.modelCenter.y+o*e,this.modelCenter.z+a*e),t.target=this.model}):(this.internalLights.forEach(t=>{this.scene.remove(t),t.dispose&&t.dispose()}),this.internalLights=[],this.setupInternalLighting())}setProgress(t){this.progress=P(t,E.PROGRESS.MIN,E.PROGRESS.MAX),this.updateExplodedPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress),this.renderer.render(this.scene,this.camera)}updateExplodedPositions(){for(const t of this.explodableMeshes){const e=this.originalPositions.get(t),i=this.explodeDirections.get(t);if(e&&i){const s=this.modelRadius*this.options.maxDistance*this.progress*this.multiplier,n=e.clone();switch(this.mode){case w.RADIAL:n.add(i.clone().multiplyScalar(s));break;case w.AXIAL:{const e=this.axialDistances.get(t)||0,i=this.options.axialVector.clone().normalize();n.add(i.multiplyScalar(e*this.modelRadius*this.options.maxDistance*this.progress*this.multiplier));break}case w.NORMALIZED_RADIAL:{const t=e.clone().sub(this.modelCenter);n.add(t.multiplyScalar(this.options.maxDistance*this.progress*this.multiplier));break}case w.SIZE_WEIGHTED:{const e=this.sizeWeights.get(t)||1;n.add(i.clone().multiplyScalar(s*e));break}case w.HIERARCHICAL:{const e=this.hierarchicalDepths.get(t)||1;n.add(i.clone().multiplyScalar(s*e));break}case w.FORCE_FIELD:{const e=this.originalPositions.get(t);if(e){const t=1/(e.clone().sub(this.modelCenter).length()/this.modelRadius+E.WEIGHTS.FORCE_FIELD_OFFSET);n.add(i.clone().multiplyScalar(s*t))}break}}t.parent&&t.parent.worldToLocal(n),t.position.copy(n)}}}setMode(t){this.mode=t,this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMode(){return this.mode}setAxialVector(t){this.options.axialVector.copy(t),this.calculateAxialDistances(),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getAxialVector(){return this.options.axialVector}reset(){this.progress=0,this.resetToOriginalPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress)}resetToOriginalPositions(){for(const t of this.explodableMeshes){const e=this.originalPositions.get(t),i=this.originalRotations.get(t),s=this.originalScales.get(t);if(e){const i=e.clone();t.parent&&t.parent.worldToLocal(i),t.position.copy(i)}i&&t.rotation&&t.rotation.set(i.x,i.y,i.z),s&&t.scale&&t.scale.set(s.x,s.y,s.z)}}setProgressChangeCallback(t){this.onProgressChangeCallback=t}setMultiplier(t){this.multiplier=P(t,E.MULTIPLIER.MIN,E.MULTIPLIER.MAX),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMultiplier(){return this.multiplier}getProgress(){return this.progress}getModelCenter(){return this.modelCenter.clone()}getOptions(){return this.options}dispose(){this.internalLights.forEach(t=>{this.scene.remove(t),t.dispose&&t.dispose()}),this.internalLights=[],this.reset(),this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.onProgressChangeCallback=null}}class L{constructor(e,i,s){this.mouseDownPos=new t.Vector2,this.dragThreshold=2,this.gridHelper=null,this.axesHelper=null,this.axisLabels=null,this.selectedMesh=null,this.enabled=!0,this.originalMaterialState=new Map,this.onSelect=null,this.scene=e,this.camera=i,this.renderer=s,this.raycaster=new t.Raycaster,this.mouse=new t.Vector2,this.onMouseDown=this.onMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.onDoubleClick=this.onDoubleClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.initEventListeners(),this.initHelpers()}setOnSelect(t){this.onSelect=t}setEnabled(t){this.enabled=t}initHelpers(){this.gridHelper=new t.GridHelper(10,20,12303291,15658734),this.scene.add(this.gridHelper),this.axesHelper=new t.AxesHelper(5),this.scene.add(this.axesHelper);const e=S("X","#FF4444"),i=S("Y","#44FF44"),s=S("Z","#4444FF");e.position.set(5.5,0,0),i.position.set(0,5.5,0),s.position.set(0,0,5.5),this.axisLabels={x:e,y:i,z:s},this.scene.add(e,i,s)}setHelperVisibility(t){this.gridHelper&&(this.gridHelper.visible=t),this.axesHelper&&(this.axesHelper.visible=t),this.axisLabels&&(this.axisLabels.x.visible=t,this.axisLabels.y.visible=t,this.axisLabels.z.visible=t)}initEventListeners(){const t=this.renderer.domElement;t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("click",this.onClick),t.addEventListener("dblclick",this.onDoubleClick),t.addEventListener("mousemove",this.onMouseMove)}onMouseDown(t){this.mouseDownPos.set(t.clientX,t.clientY)}onDoubleClick(t){if(!this.enabled)return;const e=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(t.clientX-e.left)/e.width*2-1,this.mouse.y=-(t.clientY-e.top)/e.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const i=this.raycaster.intersectObjects(this.scene.children,!0).find(t=>t.object.isMesh);if(i){const t=i.object;this.toggleMeshVisibility(t)}}toggleMeshVisibility(t){t.visible=!t.visible,t.visible||this.selectedMesh!==t||this.deselectMesh()}showAllMeshes(){this.scene.traverse(t=>{t.isMesh&&(t.visible=!0)})}onMouseMove(t){const e=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(t.clientX-e.left)/e.width*2-1,this.mouse.y=-(t.clientY-e.top)/e.height*2+1}onClick(t){if(!this.enabled)return;if(Math.sqrt(Math.pow(t.clientX-this.mouseDownPos.x,2)+Math.pow(t.clientY-this.mouseDownPos.y,2))>this.dragThreshold)return;const e=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(t.clientX-e.left)/e.width*2-1,this.mouse.y=-(t.clientY-e.top)/e.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const i=this.raycaster.intersectObjects(this.scene.children,!0).find(t=>t.object.isMesh);if(i){const t=i.object;this.selectMesh(t)}else this.deselectMesh()}selectMesh(t){this.selectedMesh!==t?(this.deselectMesh(),this.selectedMesh=t,this.highlightMesh(t),this.onSelect&&this.onSelect(t)):this.deselectMesh()}deselectMesh(){this.selectedMesh&&(this.restoreMesh(this.selectedMesh),this.selectedMesh=null,this.onSelect&&this.onSelect(null))}highlightMesh(e){if(!e.material)return;const i=`${e.uuid}_0`;this.originalMaterialState.has(i)||(Array.isArray(e.material)?e.material=e.material.map(t=>t.clone()):e.material=e.material.clone());(Array.isArray(e.material)?e.material:[e.material]).forEach((i,s)=>{if(i instanceof t.MeshStandardMaterial){const t=`${e.uuid}_${s}`;this.originalMaterialState.has(t)||this.originalMaterialState.set(t,{emissive:i.emissive.clone(),emissiveIntensity:i.emissiveIntensity,color:i.color.clone()}),i.color.set(0),i.emissive.set(E.INTERACTION?.HIGHLIGHT_COLOR||6600182),i.emissiveIntensity=1}})}restoreMesh(e){if(!e.material)return;(Array.isArray(e.material)?e.material:[e.material]).forEach((i,s)=>{if(i instanceof t.MeshStandardMaterial){const t=`${e.uuid}_${s}`,n=this.originalMaterialState.get(t);n&&(i.emissive.copy(n.emissive),i.emissiveIntensity=n.emissiveIntensity,n.color&&i.color&&i.color.copy(n.color),this.originalMaterialState.delete(t))}})}dispose(){const t=this.renderer.domElement;if(t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("click",this.onClick),t.removeEventListener("dblclick",this.onDoubleClick),t.removeEventListener("mousemove",this.onMouseMove),this.deselectMesh(),this.originalMaterialState.clear(),this.gridHelper&&(this.scene.remove(this.gridHelper),this.gridHelper.geometry.dispose(),Array.isArray(this.gridHelper.material)?this.gridHelper.material.forEach(t=>t.dispose()):this.gridHelper.material.dispose(),this.gridHelper=null),this.axesHelper&&(this.scene.remove(this.axesHelper),this.axesHelper.geometry.dispose(),Array.isArray(this.axesHelper.material)?this.axesHelper.material.forEach(t=>t.dispose()):this.axesHelper.material.dispose(),this.axesHelper=null),this.axisLabels){const{x:t,y:e,z:i}=this.axisLabels;[t,e,i].forEach(t=>{this.scene.remove(t),t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach(t=>t.dispose()):t.material.dispose(),t.material.map&&t.material.map.dispose()}),this.axisLabels=null}}}function R(t,e,i){return(i=Math.max(0,Math.min(1,(i-t)/(e-t))))*i*(3-2*i)}function I(t,e,i,s,n){const o=Math.abs(t)-i+n,a=Math.abs(e)-s+n;return Math.min(Math.max(o,a),0)+function(t,e){return Math.sqrt(t*t+e*e)}(Math.max(o,0),Math.max(a,0))-n}class k{constructor(t,e){this.mouse={x:0,y:0},this.mouseUsed=!1,this.canvasDPI=window.devicePixelRatio||1,this.id="lg-"+Math.random().toString(36).substr(2,5),this.width=e.width,this.height=e.height,this.fragment=e.fragment||(t=>{const e=t.x-.5,i=t.y-.5,s=R(.8,0,I(e,i,.3,.2,.6)-.3),n=R(0,1,s);return{type:"t",x:e*n+.5,y:i*n+.5}}),this.init(t)}init(t){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("style","position:absolute; width:0; height:0; pointer-events:none;");const e=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id",`${this.id}_filter`),i.setAttribute("filterUnits","userSpaceOnUse"),i.setAttribute("colorInterpolationFilters","sRGB"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width",this.width.toString()),i.setAttribute("height",this.height.toString()),this.feImage=document.createElementNS("http://www.w3.org/2000/svg","feImage"),this.feImage.setAttribute("id",`${this.id}_map`),this.feImage.setAttribute("result","map"),this.feImage.setAttribute("width",this.width.toString()),this.feImage.setAttribute("height",this.height.toString()),this.feDisplacementMap=document.createElementNS("http://www.w3.org/2000/svg","feDisplacementMap"),this.feDisplacementMap.setAttribute("in","SourceGraphic"),this.feDisplacementMap.setAttribute("in2","map"),this.feDisplacementMap.setAttribute("xChannelSelector","R"),this.feDisplacementMap.setAttribute("yChannelSelector","G"),i.appendChild(this.feImage),i.appendChild(this.feDisplacementMap),e.appendChild(i),this.svg.appendChild(e),document.body.appendChild(this.svg),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.updateSize(this.width,this.height),t.style.backdropFilter=`url(#${this.id}_filter) blur(0.25px) contrast(1.2) brightness(1.05) saturate(1.1)`,t.style.webkitBackdropFilter=`url(#${this.id}_filter) blur(0.25px) contrast(1.2) brightness(1.05) saturate(1.1)`,this.render(),t.addEventListener("mousemove",e=>{const i=t.getBoundingClientRect();this.mouse.x=(e.clientX-i.left)/i.width,this.mouse.y=(e.clientY-i.top)/i.height,this.mouseUsed&&this.render()})}updateSize(t,e){this.width=t,this.height=e,this.canvas.width=t*this.canvasDPI,this.canvas.height=e*this.canvasDPI,this.render()}render(){const t=this.canvas.width,e=this.canvas.height;if(t<=0||e<=0)return;const i=new Proxy(this.mouse,{get:(t,e)=>(this.mouseUsed=!0,t[e])});this.mouseUsed=!1;const s=new Uint8ClampedArray(t*e*4);let n=0;const o=[];for(let a=0;a<s.length;a+=4){const s=a/4%t,r=Math.floor(a/4/t),h=this.fragment({x:s/t,y:r/e},i),l=h.x*t-s,c=h.y*e-r;n=Math.max(n,Math.abs(l),Math.abs(c)),o.push(l,c)}n*=.5,n<1&&(n=1);let a=0;for(let t=0;t<s.length;t+=4){const e=o[a++]/n+.5,i=o[a++]/n+.5;s[t]=255*e,s[t+1]=255*i,s[t+2]=0,s[t+3]=255}this.context.putImageData(new ImageData(s,t,e),0,0),this.feImage.setAttributeNS("http://www.w3.org/1999/xlink","href",this.canvas.toDataURL()),this.feDisplacementMap.setAttribute("scale",(n/this.canvasDPI).toString())}dispose(){this.svg.remove(),this.canvas.remove()}}class F{constructor(e,i,s,n,o,a,r,h,l=E.MULTIPLIER.DEFAULT,c=E.EXPOSURE.DEFAULT,p=w.RADIAL,d=new t.Vector3(0,1,0),u=!1,m=[],g,x={},b=!1,_=!1){this.modeButtons=new Map,this.onMultiplierChange=i,this.onExposureChange=s,this.onModeChange=n,this.onAxialChange=o,this.onModelChange=a,this.onHelperVisibilityChange=r,this.onReset=h,this.styles={container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 260px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 20px;\n      padding: 16px;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 16px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 12px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 12px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    ",zoomContainer:"\n      position: absolute;\n      top: 24px;\n      left: 50%;\n      transform: translateX(-50%);\n      display: flex;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 12px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n      z-index: 1000;\n    ",zoomButton:"\n      width: 36px;\n      height: 36px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 8px;\n      color: var(--exploder-text-main);\n      cursor: pointer;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      padding: 0;\n      outline: none;\n    ",zoomButtonHover:"\n      background: rgba(255, 255, 255, 0.4);\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      color: var(--exploder-accent);\n    ",zoomButtonActive:"\n      transform: translateY(0) scale(0.95);\n      background: rgba(255, 255, 255, 0.2);\n    "},this.element=document.createElement("aside"),this.element.className="exploder-ui-root exploder-card exploder-scrollbar",this.applyStyle(this.element,this.styles.container);const y=document.createElement("div");this.applyStyle(y,this.styles.sectionHeader),y.innerHTML=`\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.72V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.17a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>\n        <circle cx="12" cy="12" r="3"/>\n      </svg>\n      <h3 style="${this.styles.title}"></h3>\n    `,this.element.appendChild(y);const v=document.createElement("div");this.applyStyle(v,"display: flex; flex-direction: column; gap: 20px; flex: 1;"),this.element.appendChild(v);const f=m&&m.length>0;if(f||b){const t=this.createSection("",f?" 3D ":" 3D ");if(f){const e=document.createElement("select");this.modelSelect=e,e.className="exploder-select",this.applyStyle(e,this.styles.select),m.forEach(t=>{const i=document.createElement("option"),s="string"==typeof t?t:t.value;i.value=s,i.textContent="string"==typeof t?t.split("/").pop()||t:t.label,s===g&&(i.selected=!0),e.appendChild(i)}),t.appendChild(e)}if(b){const e=document.createElement("div");this.applyStyle(e,`\n          margin-top: ${f?"8px":"0"};\n          padding: 8px;\n          background: var(--exploder-bg-sub);\n          border: 1px dashed var(--exploder-border);\n          border-radius: 12px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n          cursor: pointer;\n          transition: all 0.2s;\n        `),e.innerHTML='\n          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--exploder-text-sub)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>\n          <span style="font-size: 11px; font-weight: 600; color: var(--exploder-text-sub);"> GLB</span>\n          <input type="file" accept=".glb,.gltf" style="display: none;">\n        ';const i=e.querySelector("input");e.onclick=()=>i.click(),i.onchange=t=>{const e=t.target.files?.[0];if(e){const t=URL.createObjectURL(e);this.onModelChange?.(t)}},t.appendChild(e)}v.appendChild(t)}const M=this.createSection("",""),S=this.createLabelWrapper("()");this.multiplierDisplay=document.createElement("span"),this.multiplierDisplay.className="exploder-value",this.applyStyle(this.multiplierDisplay,this.styles.value),this.multiplierDisplay.textContent=`${l.toFixed(1)}x`,S.appendChild(this.multiplierDisplay),M.insertBefore(S,M.firstChild),this.multiplierSlider=document.createElement("input"),this.multiplierSlider.type="range",this.multiplierSlider.className="exploder-slider",this.multiplierSlider.min=E.MULTIPLIER.MIN.toString(),this.multiplierSlider.max=E.MULTIPLIER.MAX.toString(),this.multiplierSlider.step=E.MULTIPLIER.STEP.toString(),this.multiplierSlider.value=l.toString(),this.applyStyle(this.multiplierSlider,this.styles.slider),M.appendChild(this.multiplierSlider),v.appendChild(M);const C=this.createSection(""," 3D "),P=this.createLabelWrapper("");this.exposureDisplay=document.createElement("span"),this.exposureDisplay.className="exploder-value",this.applyStyle(this.exposureDisplay,this.styles.value),this.exposureDisplay.textContent=c.toFixed(1),P.appendChild(this.exposureDisplay),C.insertBefore(P,C.firstChild),this.exposureSlider=document.createElement("input"),this.exposureSlider.type="range",this.exposureSlider.className="exploder-slider",this.exposureSlider.min=E.EXPOSURE.MIN.toString(),this.exposureSlider.max=E.EXPOSURE.MAX.toString(),this.exposureSlider.step=E.EXPOSURE.STEP.toString(),this.exposureSlider.value=c.toString(),this.applyStyle(this.exposureSlider,this.styles.slider),C.appendChild(this.exposureSlider),v.appendChild(C);const T=this.createSection("",""),A=document.createElement("div");this.applyStyle(A,this.styles.grid);if([{id:w.RADIAL,label:"",icon:"M12 3v3m0 12v3M3 12h3m12 0h3M5.6 5.6l2.1 2.1m8.6 8.6l2.1 2.1M5.6 18.4l2.1-2.1m8.6-8.6l2.1-2.1"},{id:w.NORMALIZED_RADIAL,label:"",icon:"M21 3h-6M3 21h6M3 3v6M21 21v-6M3 3l7.5 7.5M21 21l-7.5-7.5"},{id:w.AXIAL,label:"",icon:"M7 7h10M7 12h10M7 17h10"},{id:w.FORCE_FIELD,label:"",icon:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0 M12 12m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0"},{id:w.SIZE_WEIGHTED,label:"",icon:"M3 6h18M7 12h10M10 18h4"},{id:w.HIERARCHICAL,label:"",icon:"M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"}].forEach(t=>{const e=document.createElement("div");e.className="exploder-mode-btn "+(p===t.id?"active":""),e.innerHTML=`\n        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="${t.icon}"/></svg>\n        <span>${t.label}</span>\n      `,e.onclick=()=>this.handleModeClick(t.id),A.appendChild(e),this.modeButtons.set(t.id,e)}),T.appendChild(A),this.axialContainer=document.createElement("div"),this.applyStyle(this.axialContainer,"margin-top: 8px; display: "+(p===w.AXIAL?"block":"none")),this.axialSelect=document.createElement("select"),this.applyStyle(this.axialSelect,this.styles.select),[{v:"0,1,0",l:"Y  ()"},{v:"1,0,0",l:"X  ()"},{v:"0,0,1",l:"Z  ()"}].forEach(t=>{const e=document.createElement("option");e.value=t.v,e.textContent=t.l,t.v===`${d.x},${d.y},${d.z}`&&(e.selected=!0),this.axialSelect.appendChild(e)}),this.axialContainer.appendChild(this.axialSelect),T.appendChild(this.axialContainer),v.appendChild(T),_){const t=this.createSection("",""),e=document.createElement("label");this.applyStyle(e,"display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none;"),this.helperToggle=document.createElement("input"),this.helperToggle.type="checkbox",this.helperToggle.checked=u,this.helperToggle.style.width="16px",this.helperToggle.style.height="16px",this.helperToggle.style.accentColor="var(--exploder-accent)",e.appendChild(this.helperToggle);const i=document.createElement("span");i.textContent="",this.applyStyle(i,"font-size: 12px; font-weight: 500; color: var(--exploder-text-sub);"),e.appendChild(i),t.appendChild(e),v.appendChild(t)}const z=document.createElement("div");this.applyStyle(z,"padding-top: 8px; margin-top: auto;"),this.resetButton=document.createElement("button"),this.resetButton.className="exploder-button-reset",this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.innerHTML='\n      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>\n      <span></span>\n    ',this.resetButton.onmouseenter=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),this.resetButton.onmouseleave=()=>this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.onmousedown=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetActive),this.resetButton.onmouseup=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),z.appendChild(this.resetButton),this.element.appendChild(z),this.multiplierSlider.oninput=t=>{const e=parseFloat(t.target.value);this.updateMultiplier(e),this.onMultiplierChange(e)},this.exposureSlider.oninput=t=>{const e=parseFloat(t.target.value);this.updateExposure(e),this.onExposureChange?.(e)},this.modelSelect&&(this.modelSelect.onchange=t=>this.onModelChange?.(t.target.value)),this.axialSelect.onchange=e=>{const[i,s,n]=e.target.value.split(",").map(Number);this.onAxialChange?.(new t.Vector3(i,s,n))},this.helperToggle&&(this.helperToggle.onchange=t=>this.onHelperVisibilityChange?.(t.target.checked)),this.resetButton.onclick=()=>{this.onReset?.()};if((("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element),this.liquidGlass=new k(this.element,{width:260,height:this.element.offsetHeight||600}),window.ResizeObserver){new ResizeObserver(()=>{this.liquidGlass&&this.liquidGlass.updateSize(260,this.element.offsetHeight)}).observe(this.element)}}createSection(t,e){const i=document.createElement("section");if(this.applyStyle(i,this.styles.section),t){const e=document.createElement("label");this.applyStyle(e,this.styles.label),e.textContent=t,i.appendChild(e)}if(e){const t=document.createElement("p");this.applyStyle(t,this.styles.hint),t.textContent=e,i.appendChild(t)}return i}createLabelWrapper(t){const e=document.createElement("div");this.applyStyle(e,this.styles.labelContainer);const i=document.createElement("span");return this.applyStyle(i,this.styles.label),i.textContent=t,e.appendChild(i),e}handleModeClick(t){this.updateMode(t),this.onModeChange?.(t)}applyStyle(t,e){const i=t.getAttribute("style")||"";t.setAttribute("style",i+e)}show(){this.element.style.display="flex"}hide(){this.element.style.display="none"}update(t){}updateMultiplier(t){this.multiplierSlider.value=t.toString(),this.multiplierDisplay.textContent=`${t.toFixed(1)}x`}updateExposure(t){this.exposureSlider.value=t.toString(),this.exposureDisplay.textContent=t.toFixed(1)}updateMode(t){this.modeButtons.forEach((e,i)=>{i===t?e.classList.add("active"):e.classList.remove("active")}),this.axialContainer&&(this.axialContainer.style.display=t===w.AXIAL?"block":"none")}updateHelperVisibility(t){this.helperToggle&&(this.helperToggle.checked=t)}updateAxialVector(t){this.axialSelect&&(this.axialSelect.value=`${t.x},${t.y},${t.z}`)}dispose(){this.liquidGlass?.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class j{constructor(t,e,i=E.PROGRESS.DEFAULT,s){this.isMeasureActive=!1,this.onProgressChange=e,this.onMeasureToggle=s,this.element=document.createElement("div"),this.element.className="exploder-hud-root",this.applyStyle(this.element,"\n      position: absolute;\n      bottom: 40px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 72%;\n      max-width: 600px;\n      z-index: 100;\n      pointer-events: auto;\n    ");const n=document.createElement("div");n.className="exploder-card",this.applyStyle(n,"\n      display: flex;\n      align-items: center;\n      gap: 20px;\n      padding: 12px 24px;\n      border-radius: 16px;\n      background: rgba(255, 255, 255, 0.4);\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n    "),this.element.appendChild(n);const o=document.createElement("div");this.applyStyle(o,"\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    "),n.appendChild(o);const a=document.createElement("div");this.applyStyle(a,"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ");const r=document.createElement("span");r.textContent="",this.applyStyle(r,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),this.valueDisplay=document.createElement("span"),this.valueDisplay.textContent=`${Math.round(100*i)}%`,this.applyStyle(this.valueDisplay,"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-accent);\n    "),a.appendChild(r),a.appendChild(this.valueDisplay),o.appendChild(a),this.slider=document.createElement("input"),this.slider.type="range",this.slider.className="exploder-slider",this.slider.min=E.PROGRESS.MIN.toString(),this.slider.max=E.PROGRESS.MAX.toString(),this.slider.step=E.PROGRESS.STEP.toString(),this.slider.value=i.toString(),this.applyStyle(this.slider,"\n      width: 100%;\n      height: 4px;\n      cursor: pointer;\n    "),o.appendChild(this.slider);const h=document.createElement("div");this.applyStyle(h,"\n      height: 32px;\n      width: 1px;\n      background: rgba(229, 231, 235, 0.6);\n      display: none;\n    "),window.matchMedia("(min-width: 640px)").matches&&(h.style.display="block"),n.appendChild(h),this.measureButton=document.createElement("button"),this.measureButton.className="exploder-measure-button",this.measureButton.title="",this.applyStyle(this.measureButton,"\n      width: 36px;\n      height: 36px;\n      flex-shrink: 0;\n      background: #2563EB;\n      color: white;\n      border: none;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      border: 1px solid rgba(229, 231, 235, 0.5);\n    "),this.updateMeasureButtonStyle(),this.measureButton.innerHTML='\n      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transition: transform 0.2s;">\n        <path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"></path>\n        <path d="m14.5 12.5 2-2"></path>\n        <path d="m11.5 9.5 2-2"></path>\n        <path d="m8.5 6.5 2-2"></path>\n        <path d="m17.5 15.5 2-2"></path>\n      </svg>\n    ',this.measureButton.addEventListener("mouseenter",()=>{this.measureButton.style.transform="scale(1.08)",this.isMeasureActive||(this.measureButton.style.background="rgba(243, 244, 246, 1)",this.measureButton.style.color="#3B82F6");const t=this.measureButton.querySelector("svg");t&&(t.style.transform="rotate(12deg)")}),this.measureButton.addEventListener("mouseleave",()=>{this.measureButton.style.transform="scale(1)",this.isMeasureActive||(this.measureButton.style.background="rgba(255, 255, 255, 0.6)",this.measureButton.style.color="#6B7280");const t=this.measureButton.querySelector("svg");t&&(t.style.transform="rotate(0deg)")}),this.measureButton.addEventListener("mousedown",()=>{this.measureButton.style.transform="scale(0.95)"}),this.measureButton.addEventListener("mouseup",()=>{this.measureButton.style.transform="scale(1.05)"}),this.measureButton.addEventListener("click",()=>{this.onMeasureToggle&&this.onMeasureToggle()}),n.appendChild(this.measureButton),this.slider.oninput=t=>{const e=parseFloat(t.target.value);this.update(e),this.onProgressChange(e)};(("string"==typeof t?document.querySelector(t):t)||document.body).appendChild(this.element),this.liquidGlass=new k(n,{width:600,height:80})}setMeasureActive(t){this.isMeasureActive=t,this.updateMeasureButtonStyle()}updateMeasureButtonStyle(){this.isMeasureActive?this.applyStyle(this.measureButton,"\n        background: #2563EB;\n        color: white;\n        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);\n      "):this.applyStyle(this.measureButton,"\n        background: rgba(255, 255, 255, 0.6);\n        color: #6B7280;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n      ")}update(t){this.slider.value=t.toString(),this.valueDisplay.textContent=`${Math.round(100*t)}%`}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}dispose(){this.liquidGlass?.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(t,e){const i=t.getAttribute("style")||"";t.setAttribute("style",i+e)}}class O{constructor(t,e="...",i=0){this.element=document.createElement("div"),this.element.className="exploder-info-hud",this.applyStyle(this.element,"\n      position: absolute;\n      top: 24px;\n      left: 24px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      pointer-events: none;\n      z-index: 100;\n    ");const s=document.createElement("div");s.className="exploder-card",this.applyStyle(s,"\n      padding: 12px 16px;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      pointer-events: auto;\n      background: rgba(255, 255, 255, 0.4);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 16px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    ");const n=document.createElement("div");this.applyStyle(n,"\n      width: 40px;\n      height: 40px;\n      background: var(--exploder-accent);\n      color: white;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    "),n.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>';const o=document.createElement("div");this.applyStyle(o,"\n      display: flex;\n      flex-direction: column;\n    "),this.modelNameDisplay=document.createElement("span"),this.modelNameDisplay.textContent=e,this.applyStyle(this.modelNameDisplay,"\n      font-size: 13px;\n      font-weight: 700;\n      color: var(--exploder-text-main);\n      line-height: 1.2;\n      max-width: 200px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    "),this.faceCountDisplay=document.createElement("span"),this.faceCountDisplay.textContent=`: ${i.toLocaleString()}`,this.applyStyle(this.faceCountDisplay,"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      font-weight: 700;\n      margin-top: 4px;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),o.appendChild(this.modelNameDisplay),o.appendChild(this.faceCountDisplay),s.appendChild(n),s.appendChild(o),this.element.appendChild(s);const a=document.createElement("div");this.applyStyle(a,"\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.4);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 12px;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n      width: fit-content;\n      pointer-events: auto;\n    ");const r=document.createElement("span");r.className="exploder-status-dot exploder-animate-pulse";const h=document.createElement("span");h.textContent="WebGL 2.0 ",this.applyStyle(h,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.02em;\n    "),a.appendChild(r),a.appendChild(h),this.element.appendChild(a);(("string"==typeof t?document.querySelector(t):t)||document.body).appendChild(this.element),this.liquidGlass1=new k(s,{width:300,height:80}),this.liquidGlass2=new k(a,{width:300,height:40})}update(t,e){this.modelNameDisplay.textContent=t,this.faceCountDisplay.textContent=`: ${e.toLocaleString()}`}setModelName(t){this.modelNameDisplay.textContent=t}setFaceCount(t){this.faceCountDisplay.textContent=`: ${t.toLocaleString()}`}show(){this.element.style.display="flex"}hide(){this.element.style.display="none"}dispose(){this.liquidGlass1?.dispose(),this.liquidGlass2?.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(t,e){const i=t.getAttribute("style")||"";t.setAttribute("style",i+e)}}class N{constructor(t,e){this.children=null,this.points=[],this.bounds=t,this.depth=e}isLeaf(){return null===this.children}subdivide(){const e=new t.Vector3;this.bounds.getCenter(e);const i=this.bounds.min,s=this.bounds.max;this.children=[new N(new t.Box3(new t.Vector3(i.x,i.y,i.z),new t.Vector3(e.x,e.y,e.z)),this.depth+1),new N(new t.Box3(new t.Vector3(e.x,i.y,i.z),new t.Vector3(s.x,e.y,e.z)),this.depth+1),new N(new t.Box3(new t.Vector3(i.x,e.y,i.z),new t.Vector3(e.x,s.y,e.z)),this.depth+1),new N(new t.Box3(new t.Vector3(e.x,e.y,i.z),new t.Vector3(s.x,s.y,e.z)),this.depth+1),new N(new t.Box3(new t.Vector3(i.x,i.y,e.z),new t.Vector3(e.x,e.y,s.z)),this.depth+1),new N(new t.Box3(new t.Vector3(e.x,i.y,e.z),new t.Vector3(s.x,e.y,s.z)),this.depth+1),new N(new t.Box3(new t.Vector3(i.x,e.y,e.z),new t.Vector3(e.x,s.y,s.z)),this.depth+1),new N(new t.Box3(new t.Vector3(e.x,e.y,e.z),new t.Vector3(s.x,s.y,s.z)),this.depth+1)]}}class G{constructor(t,e=8,i=8){this.root=new N(t,0),this.maxDepth=e,this.maxPointsPerNode=i}insert(t,e){this.insertIntoNode(this.root,{position:t,data:e})}insertIntoNode(t,e){if(t.bounds.containsPoint(e.position))if(t.isLeaf()){if(t.points.push(e),t.points.length>this.maxPointsPerNode&&t.depth<this.maxDepth){t.subdivide();const e=t.points;t.points=[];for(const i of e)for(const e of t.children)this.insertIntoNode(e,i)}}else for(const i of t.children)this.insertIntoNode(i,e)}findNearest(t,e){const i=[],s=e*e;return this.searchNode(this.root,t,s,i),i.sort((e,i)=>e.position.distanceToSquared(t)-i.position.distanceToSquared(t)),i}searchNode(e,i,s,n){const o=new t.Vector3;e.bounds.clampPoint(i,o);if(!(o.distanceToSquared(i)>s))if(e.isLeaf())for(const t of e.points){t.position.distanceToSquared(i)<=s&&n.push(t)}else for(const t of e.children)this.searchNode(t,i,s,n)}clear(){this.root=new N(this.root.bounds,0)}static fromPositions(e){const i=new t.Box3;for(let s=0;s<e.length;s+=3){const n=new t.Vector3(e[s],e[s+1],e[s+2]);i.expandByPoint(n)}const s=new t.Vector3;i.getSize(s);const n=.01*Math.max(s.x,s.y,s.z);i.expandByScalar(n);const o=new G(i);for(let i=0;i<e.length;i+=3){const s=new t.Vector3(e[i],e[i+1],e[i+2]);o.insert(s,i/3)}return o}getStats(){const t={totalNodes:0,leafNodes:0,maxDepth:0,totalPoints:0},e=i=>{if(t.totalNodes++,t.maxDepth=Math.max(t.maxDepth,i.depth),i.isLeaf())t.leafNodes++,t.totalPoints+=i.points.length;else for(const t of i.children)e(t)};return e(this.root),t}}var H;!function(t){t.VERTEX="vertex",t.EDGE="edge",t.FACE="face",t.HOLE_EDGE="hole_edge"}(H||(H={}));const B={snapRadius:15,edgeThreshold:8,unit:"mm",snapModes:[H.VERTEX,H.EDGE,H.FACE],pinColor:"#2563EB",lineWidth:2,lineColor:"rgba(37, 99, 235, 0.4)",labelBgColor:"rgba(255, 255, 255, 0.7)"};class V{constructor(e){this.camera=e,this.raycaster=new t.Raycaster}snapToVertex(t,e,i,s=10){this.raycaster.setFromCamera(t,this.camera);const n=this.raycaster.ray.origin.clone(),o=e.findNearest(n,i);if(0===o.length)return null;let a=null,r=s;for(const e of o){const i=this.getScreenDistance(e.position,t);i<r&&(r=i,a=e)}return a?{position:a.position.clone(),type:H.VERTEX,target:a.data,distance:a.position.distanceTo(n)}:null}snapToEdge(e,i,s=5){this.raycaster.setFromCamera(e,this.camera);const n=this.raycaster.ray;let o=null,a=1/0,r=null;for(const h of i){const i=new t.Line3(h.start,h.end),l=new t.Vector3;i.closestPointToPoint(n.origin,!0,l);const c=l.distanceTo(n.origin);this.getScreenDistance(l,e)<s&&c<a&&(a=c,o=l,r=h)}return o&&r?{position:o,type:H.EDGE,target:r,distance:a}:null}snapToFace(t){const e=this.raycaster.intersectObjects(t,!0);if(e.length>0){const t=e[0];return{position:t.point,type:H.FACE,target:{object:t.object,faceIndex:t.faceIndex},distance:t.distance}}return null}detectHoles(e){const i=[];if(!e.index)return i;const s=e.attributes.position,n=e.index.array,o=new Map;for(let t=0;t<n.length;t+=3){const e=n[t],i=n[t+1],s=n[t+2],a=[[e,i],[i,s],[s,e]];for(const[t,e]of a){const i=t<e?`${t}-${e}`:`${e}-${t}`;o.set(i,(o.get(i)||0)+1)}}for(const[e,n]of o.entries())if(1===n){const[n,o]=e.split("-").map(Number),a=new t.Vector3(s.getX(n),s.getY(n),s.getZ(n)),r=new t.Vector3(s.getX(o),s.getY(o),s.getZ(o));i.push({start:a,end:r,index:i.length})}return i}extractEdges(e){const i=[];if(!e.index)return i;const s=e.attributes.position,n=e.index.array,o=new Set;for(let e=0;e<n.length;e+=3){const a=n[e],r=n[e+1],h=n[e+2],l=[[a,r],[r,h],[h,a]];for(const[e,n]of l){const a=e<n?`${e}-${n}`:`${n}-${e}`;if(!o.has(a)){o.add(a);const r=new t.Vector3(s.getX(e),s.getY(e),s.getZ(e)),h=new t.Vector3(s.getX(n),s.getY(n),s.getZ(n));i.push({start:r,end:h,index:i.length})}}}return i}getScreenDistance(t,e){const i=t.clone().project(this.camera),s=i.x-e.x,n=i.y-e.y;return Math.sqrt(s*s+n*n)*(window.innerWidth/2)}setCamera(t){this.camera=t}}class U{constructor(e,i,s={}){this.enabled=!1,this.octree=null,this.edges=[],this.holeEdges=[],this.targetMeshes=[],this.point1=null,this.point2=null,this.camera=e,this.config={...B,...s},this.raycaster=new t.Raycaster,this.snapDetector=new V(e)}enableMeasurement(){this.enabled=!0,this.reset(),this.onMeasureStartCallback&&this.onMeasureStartCallback()}disableMeasurement(){this.enabled=!1,this.reset()}isEnabled(){return this.enabled}setSnapMode(t){this.config.snapModes=t}setUnit(t){this.config.unit=t}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t}}getDistance(t,e){return t.distanceTo(e)}formatDistance(t,e){const i=e||this.config.unit;let s;switch(i){case"m":default:s=t;break;case"cm":s=100*t;break;case"mm":s=1e3*t}return`${s.toFixed(2)} ${i}`}setPoint1(t){this.point1=t.clone()}setPoint2(t){if(this.point2=t.clone(),this.point1&&this.point2){const t=this.getDistance(this.point1,this.point2),e={point1:this.point1,point2:this.point2,distance:t,formattedDistance:this.formatDistance(t),unit:this.config.unit};this.onMeasureCompleteCallback&&this.onMeasureCompleteCallback(e)}}getPoints(){return{point1:this.point1?this.point1.clone():null,point2:this.point2?this.point2.clone():null}}reset(){this.point1=null,this.point2=null}detectSnap(t){this.raycaster.setFromCamera(t,this.camera);for(const e of this.config.snapModes){let i=null;switch(e){case H.VERTEX:i=this.snapToVertex(t);break;case H.EDGE:i=this.snapToEdge(t);break;case H.FACE:i=this.snapToFace();break;case H.HOLE_EDGE:i=this.snapToHoleEdge(t)}if(i)return this.onSnapDetectedCallback&&this.onSnapDetectedCallback(i),i}return null}snapToVertex(t){if(!this.octree)return null;const e=.1*this.camera.position.length();return this.snapDetector.snapToVertex(t,this.octree,e,this.config.snapRadius)}snapToEdge(t){return 0===this.edges.length?null:this.snapDetector.snapToEdge(t,this.edges,this.config.edgeThreshold)}snapToFace(){if(0===this.targetMeshes.length)return null;const t=this.raycaster.intersectObjects(this.targetMeshes,!1);if(t.length>0){const e=t[0];return{position:e.point,type:H.FACE,target:e.object,distance:e.distance}}return null}snapToHoleEdge(t){return 0===this.holeEdges.length?null:this.snapDetector.snapToEdge(t,this.holeEdges,this.config.edgeThreshold)}onMeasureStart(t){this.onMeasureStartCallback=t}onMeasureComplete(t){this.onMeasureCompleteCallback=t}onSnapDetected(t){this.onSnapDetectedCallback=t}buildSnapStructures(e){this.targetMeshes=[],this.edges=[],this.holeEdges=[];const i=[];if(e.updateMatrixWorld(!0),e.traverse(e=>{if(e.isMesh){const s=e;if(this.targetMeshes.push(s),s.geometry instanceof t.BufferGeometry){const e=s.geometry,n=e.attributes.position;if(n){for(let e=0;e<n.count;e++){const o=new t.Vector3(n.getX(e),n.getY(e),n.getZ(e));o.applyMatrix4(s.matrixWorld),i.push(o)}const o=this.snapDetector.extractEdges(e);for(const t of o){const e=t.start.clone().applyMatrix4(s.matrixWorld),i=t.end.clone().applyMatrix4(s.matrixWorld);this.edges.push({start:e,end:i,index:this.edges.length})}const a=this.snapDetector.detectHoles(e);for(const t of a){const e=t.start.clone().applyMatrix4(s.matrixWorld),i=t.end.clone().applyMatrix4(s.matrixWorld);this.holeEdges.push({start:e,end:i,index:this.holeEdges.length})}}}}}),0!==i.length){this.octree=new G(this.calculateBoundingBox(i));for(const t of i)this.octree.insert(t,null);console.log("[MeasurementTool] Built snap structures:"),console.log(`  - Target meshes: ${this.targetMeshes.length}`),console.log(`  - Total vertices: ${i.length}`),console.log(`  - Octree nodes: ${this.octree?.getStats().totalNodes||0}`),console.log(`  - Edges: ${this.edges.length}`),console.log(`  - Hole edges: ${this.holeEdges.length}`)}else this.octree=null}calculateBoundingBox(e){const i=new t.Box3;if(0===e.length)return i;for(const t of e)i.expandByPoint(t);return i.expandByScalar(.1),i}renderMeasurement(t){}dispose(){this.reset(),this.enabled=!1,this.onMeasureStartCallback=void 0,this.onMeasureCompleteCallback=void 0,this.onSnapDetectedCallback=void 0}}class X{constructor(e,i,s,n){this.visible=!1,this.measurements=[],this.currentPinA=null,this.currentPoint1=null,this.isActive=!1,this.clickCount=0,this.currentSnap=null,this.mouseDownPos=new t.Vector2,this.dragThreshold=3,this.camera=i,this.onActiveChange=n,this.measurementTool=new U(i,s),this.element=document.createElement("div"),this.element.className="exploder-measurement-root",this.applyStyle(this.element,"\n      position: absolute;\n      inset: 0;\n      pointer-events: none;\n      z-index: 50;\n      display: none;\n    "),this.previewDot=this.createPreviewDot(),this.element.appendChild(this.previewDot),this.previewLine=document.createElement("div"),this.applyStyle(this.previewLine,"\n      position: absolute;\n      height: 2px;\n      border-top: 2px dashed rgba(37, 99, 235, 0.5);\n      pointer-events: none;\n      display: none;\n    "),this.element.appendChild(this.previewLine);const o="string"==typeof e?document.querySelector(e):e;this.container=o||document.body,this.container.appendChild(this.element),this.boundMouseMove=this.handleMouseMove.bind(this),this.boundMouseDown=this.handleMouseDown.bind(this),this.boundMouseClick=this.handleMouseClick.bind(this),this.setupMeasurementCallbacks()}setupMeasurementCallbacks(){this.measurementTool.onMeasureStart(()=>{console.log("[ExploderMeasurement] Measurement started")}),this.measurementTool.onMeasureComplete(t=>{console.log("[ExploderMeasurement] Measurement complete:",t)}),this.measurementTool.onSnapDetected(t=>{this.currentSnap=t})}handleMouseMove(e){if(!this.isActive)return;const i=this.container.getBoundingClientRect(),s=(e.clientX-i.left)/i.width*2-1,n=-(e.clientY-i.top)/i.height*2+1,o=new t.Vector2(s,n),a=this.measurementTool.detectSnap(o);a?(this.currentSnap=a,this.updatePreviewDotPosition(a.position),this.previewDot.style.display="block",1===this.clickCount&&this.currentPoint1&&(this.updateLineElement(this.previewLine,this.currentPoint1,a.position),this.previewLine.style.display="block")):(this.previewDot.style.display="none",this.currentSnap=null,1===this.clickCount&&(this.previewLine.style.display="none"))}handleMouseDown(t){this.mouseDownPos.set(t.clientX,t.clientY)}handleMouseClick(t){if(!this.isActive)return;if(Math.sqrt(Math.pow(t.clientX-this.mouseDownPos.x,2)+Math.pow(t.clientY-this.mouseDownPos.y,2))>this.dragThreshold)return;if(!this.currentSnap)return;const e=this.currentSnap;if(0===this.clickCount)this.currentPoint1=e.position.clone(),this.currentPinA=this.createPin(),this.updatePinPosition3D(this.currentPinA,e.position),this.currentPinA.style.display="flex",this.element.appendChild(this.currentPinA),this.previewDot.style.display="none",this.clickCount=1;else if(1===this.clickCount&&this.currentPoint1&&this.currentPinA){const t=e.position.clone(),i=this.currentPoint1.distanceTo(t),s=this.createPin();this.updatePinPosition3D(s,t),s.style.display="flex",this.element.appendChild(s);const n=document.createElement("div");this.applyStyle(n,"\n        position: absolute;\n        height: 2px;\n        border-top: 2px dashed rgba(37, 99, 235, 0.8);\n        pointer-events: none;\n      "),this.updateLineElement(n,this.currentPoint1,t),this.element.appendChild(n);const o=this.createCompactLabel(i,this.measurements.length);this.updateLabelPosition(o,this.currentPoint1,t),this.element.appendChild(o);const a={pinA:this.currentPinA,pinB:s,line:n,label:o,point1:this.currentPoint1,point2:t,distance:i};this.measurements.push(a),this.previewDot.style.display="none",this.previewLine.style.display="none",this.currentPinA=null,this.currentPoint1=null,this.clickCount=0,console.log(`[ExploderMeasurement] Measurement #${this.measurements.length} complete: ${i.toFixed(2)} mm`)}}createPreviewDot(){const t=document.createElement("div");return t.className="exploder-preview-pin",this.applyStyle(t,"\n      position: absolute;\n      transform: translate(-50%, -100%);\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      pointer-events: none;\n      display: none;\n      z-index: 100;\n      opacity: 0.6;\n    "),t.innerHTML='\n      <svg width="21" height="27" viewBox="0 0 28 36" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3)); display: block;">\n        <path d="M14 36L8 22H20L14 36Z" fill="#2563EB"/>\n        <circle cx="14" cy="14" r="10" fill="#2563EB" stroke="white" stroke-width="2.5"/>\n        <circle cx="14" cy="14" r="3.5" fill="white" opacity="0.9"/>\n      </svg>\n    ',t}createPin(){const t=document.createElement("div");return t.className="exploder-measure-pin",this.applyStyle(t,"\n      position: absolute;\n      transform: translate(-50%, -100%);\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      pointer-events: none;\n      z-index: 1;\n    "),t.innerHTML='\n      <svg width="21" height="27" viewBox="0 0 28 36" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(37, 99, 235, 0.3)); display: block;">\n        <path d="M14 36L8 22H20L14 36Z" fill="#2563EB"/>\n        <circle cx="14" cy="14" r="10" fill="#2563EB" stroke="white" stroke-width="2.5"/>\n        <circle cx="14" cy="14" r="3.5" fill="white" opacity="0.9"/>\n      </svg>\n    ',t}createCompactLabel(t,e){const i=document.createElement("div");i.className="exploder-measure-label",this.applyStyle(i,"\n      position: absolute;\n      z-index: 2;\n      pointer-events: auto;\n      background: rgba(255, 255, 255, 0.85);\n      backdrop-filter: blur(12px);\n      -webkit-backdrop-filter: blur(12px);\n      border: 1px solid rgba(255, 255, 255, 0.9);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      padding: 4px 10px;\n      border-radius: 8px;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      font-size: 12px;\n      transition: all 0.2s;\n    ");const s=document.createElement("span");s.textContent=`${(1e3*t).toFixed(2)}`,this.applyStyle(s,"\n      font-weight: 700;\n      color: #1F2937;\n      font-family: 'Courier New', monospace;\n    ");const n=document.createElement("span");n.textContent="mm",this.applyStyle(n,"\n      font-weight: 600;\n      color: #2563EB;\n      font-size: 10px;\n    ");const o=document.createElement("button");return o.title="",this.applyStyle(o,"\n      width: 16px;\n      height: 16px;\n      border: none;\n      background: transparent;\n      color: #9CA3AF;\n      cursor: pointer;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      margin-left: 2px;\n      border-radius: 4px;\n      transition: all 0.15s;\n    "),o.innerHTML='\n      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M18 6L6 18"></path>\n        <path d="M6 6l12 12"></path>\n      </svg>\n    ',i.addEventListener("mouseenter",()=>{o.style.display="flex",i.style.paddingRight="6px"}),i.addEventListener("mouseleave",()=>{o.style.display="none",i.style.paddingRight="10px"}),o.addEventListener("mouseenter",()=>{o.style.color="#EF4444",o.style.background="rgba(239, 68, 68, 0.1)"}),o.addEventListener("mouseleave",()=>{o.style.color="#9CA3AF",o.style.background="transparent"}),o.addEventListener("click",t=>{t.stopPropagation(),this.deleteMeasurement(e)}),i.appendChild(s),i.appendChild(n),i.appendChild(o),i}deleteMeasurement(t){const e=this.measurements[t];e&&(e.pinA.remove(),e.pinB.remove(),e.line.remove(),e.label.remove(),this.measurements.splice(t,1),this.measurements.forEach((t,e)=>{const i=t.label.querySelector("button");i&&(i.onclick=t=>{t.stopPropagation(),this.deleteMeasurement(e)})}),console.log(`[ExploderMeasurement] Deleted measurement, ${this.measurements.length} remaining`))}updatePreviewDotPosition(t){const e=t.clone().project(this.camera),i=this.container.getBoundingClientRect(),s=(.5*e.x+.5)*i.width,n=(.5*-e.y+.5)*i.height;this.previewDot.style.left=`${s}px`,this.previewDot.style.top=`${n}px`}updatePinPosition3D(t,e){const i=e.clone().project(this.camera),s=this.container.getBoundingClientRect(),n=(.5*i.x+.5)*s.width,o=(.5*-i.y+.5)*s.height;t.style.left=`${n}px`,t.style.top=`${o}px`}updateLineElement(t,e,i){const s=e.clone().project(this.camera),n=i.clone().project(this.camera),o=this.container.getBoundingClientRect(),a=(.5*s.x+.5)*o.width,r=(.5*-s.y+.5)*o.height,h=(.5*n.x+.5)*o.width,l=(.5*-n.y+.5)*o.height,c=Math.sqrt((h-a)**2+(l-r)**2),p=Math.atan2(l-r,h-a)*(180/Math.PI);t.style.left=`${a}px`,t.style.top=`${r}px`,t.style.width=`${c}px`,t.style.transform=`rotate(${p}deg)`,t.style.transformOrigin="left"}update(){this.isActive&&1===this.clickCount&&this.currentPoint1?(this.updatePinPosition3D(this.currentPinA,this.currentPoint1),this.currentSnap&&(this.updatePreviewDotPosition(this.currentSnap.position),this.updateLineElement(this.previewLine,this.currentPoint1,this.currentSnap.position))):this.isActive&&this.currentSnap&&this.updatePreviewDotPosition(this.currentSnap.position);for(const t of this.measurements)this.updatePinPosition3D(t.pinA,t.point1),this.updatePinPosition3D(t.pinB,t.point2),this.updateLineElement(t.line,t.point1,t.point2),this.updateLabelPosition(t.label,t.point1,t.point2)}updateLabelPosition(t,e,i){const s=e.clone().project(this.camera),n=i.clone().project(this.camera),o=this.container.getBoundingClientRect(),a=(.5*s.x+.5)*o.width,r=(.5*-s.y+.5)*o.height,h=(.5*n.x+.5)*o.width,l=(.5*-n.y+.5)*o.height,c=(a+h)/2,p=(r+l)/2;let d=0;Math.sqrt((h-a)**2+(l-r)**2)<80&&(d=-40),t.style.left=`${c}px`,t.style.top=`${p+d}px`,t.style.transform="translate(-50%, -50%)"}buildSnapStructures(t){this.measurementTool.buildSnapStructures(t)}show(){this.visible=!0,this.isActive=!0,this.element.style.display="block",this.measurementTool.enableMeasurement(),this.container.addEventListener("mousemove",this.boundMouseMove),this.container.addEventListener("mousedown",this.boundMouseDown),this.container.addEventListener("click",this.boundMouseClick),this.onActiveChange&&this.onActiveChange(!0),console.log("[ExploderMeasurement] Measurement mode activated")}hide(){this.visible=!1,this.isActive=!1,this.element.style.display="none",this.measurementTool.disableMeasurement(),this.container.removeEventListener("mousemove",this.boundMouseMove),this.container.removeEventListener("mousedown",this.boundMouseDown),this.container.removeEventListener("click",this.boundMouseClick),this.resetCurrentMeasurement(),this.onActiveChange&&this.onActiveChange(!1),console.log("[ExploderMeasurement] Measurement mode deactivated")}toggle(){this.visible?this.hide():this.show()}resetCurrentMeasurement(){this.currentPinA&&(this.currentPinA.remove(),this.currentPinA=null),this.currentPoint1=null,this.clickCount=0,this.currentSnap=null,this.previewDot.style.display="none",this.previewLine.style.display="none"}clearAll(){for(const t of this.measurements)t.pinA.remove(),t.pinB.remove(),t.line.remove(),t.label.remove();this.measurements=[],this.resetCurrentMeasurement(),console.log("[ExploderMeasurement] All measurements cleared")}dispose(){this.hide(),this.clearAll(),this.measurementTool.dispose(),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(t,e){const i=t.getAttribute("style")||"";t.setAttribute("style",i+e)}}class q{constructor(e,i,s,n,o,a,r,h,l,c,p,d,u,m=E.PROGRESS.DEFAULT,g=E.MULTIPLIER.DEFAULT,x=E.EXPOSURE.DEFAULT,b=w.RADIAL,_=new t.Vector3(0,1,0),y=!1,v,f,M,S=!1,C=!1,P="",T=0,A=!0,z=!0){this.element=e,A&&(this.panel=new F(e,a,r,h,l,c,p,u,g,x,b,_,y,v,f,M,S,C)),z&&(this.hud=new j(e,o,m,()=>this.toggleMeasurement())),this.measurement=new X(e,i,s,t=>{this.hud&&this.hud.setMeasureActive(t),d&&d(t)}),this.measurement&&n&&this.measurement.buildSnapStructures(n),A&&(this.infoHUD=new O(e,P,T)),this.createScrollGuide(e),this.updateResponsiveState(),this.resizeHandler=this.updateResponsiveState.bind(this),window.addEventListener("resize",this.resizeHandler)}createScrollGuide(t){this.scrollGuide=document.createElement("div"),this.scrollGuide.className="exploder-scroll-guide";const e=document.createElement("div");e.className="exploder-scroll-texture";for(let t=0;t<10;t++){const t=document.createElement("div");t.className="exploder-scroll-dot",e.appendChild(t)}const i=document.createElement("div");i.className="exploder-scroll-guide-label",i.innerText="",this.scrollGuide.appendChild(e),this.scrollGuide.appendChild(i),t.appendChild(this.scrollGuide),this.scrollGuide.addEventListener("touchstart",t=>{t.stopPropagation()},{passive:!0}),this.scrollGuide.addEventListener("touchmove",t=>{t.stopPropagation()},{passive:!0})}updateResponsiveState(){z()?(this.panel?.hide(),this.infoHUD?.hide()):(this.panel?.show(),this.infoHUD?.show())}show(){z()||(this.panel?.show(),this.infoHUD?.show()),this.hud?.show()}hide(){this.panel?.hide(),this.hud?.hide(),this.infoHUD?.hide()}update(t){this.panel?.update(t),this.hud?.update(t)}updateMultiplier(t){this.panel?.updateMultiplier(t)}updateExposure(t){this.panel?.updateExposure(t)}updateMode(t){this.panel?.updateMode(t)}updateAxialVector(t){this.panel?.updateAxialVector(t)}updateHelperVisibility(t){this.panel?.updateHelperVisibility(t)}updateModel(t){this.panel&&this.panel.updateModel&&this.panel.updateModel(t)}updateInfo(t,e){this.infoHUD?.update(t,e)}reset(){this.panel?.updateMultiplier(E.MULTIPLIER.DEFAULT),this.panel?.updateExposure(E.EXPOSURE.DEFAULT),this.panel?.updateMode(w.RADIAL),this.panel?.updateAxialVector(new t.Vector3(0,1,0)),this.panel?.updateHelperVisibility(!0),this.hud?.update(E.PROGRESS.DEFAULT)}render(){this.measurement&&this.measurement.update()}toggleMeasurement(){this.measurement?.toggle()}dispose(){window.removeEventListener("resize",this.resizeHandler),this.panel?.dispose(),this.hud?.dispose(),this.infoHUD?.dispose(),this.measurement?.dispose()}}function Z(e,i,s,n,o,a,r,h,l,c,p,d,u,m=E.PROGRESS.DEFAULT,g=E.MULTIPLIER.DEFAULT,x=E.EXPOSURE.DEFAULT,b=w.RADIAL,_=new t.Vector3(0,1,0),y=!1,v="",f=0){if(!1===e.createUI)return null;const M=e.viewport?function(t){if("string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error(`: ${t}`);return e}return t}(e.viewport):null,S=M||document.body;if(S instanceof HTMLElement){"static"===window.getComputedStyle(S).position&&(S.style.position="relative")}return new q(S,i,s,n,o,a,r,h,l,c,p,d,u,m,g,x,b,_,y,e.models,e.initialModel||("string"==typeof e.model?e.model:""),e.uiStyle,e.showUpload,e.showHelpers,v,f,e.showPanel??!0,e.showProgress??!0)}class W{constructor(t,e,i){this.liquidGlass=null,this.zoomStep=.9,this.controls=e,this.container=document.createElement("div"),this.container.className="exploder-zoom-controls",this.container.setAttribute("style",i.zoomContainer);const s=document.createElement("button");s.className="exploder-zoom-button",s.setAttribute("style",i.zoomButton),s.innerHTML='\n      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="12" y1="5" x2="12" y2="19"></line>\n        <line x1="5" y1="12" x2="19" y2="12"></line>\n      </svg>\n    ',s.onclick=()=>this.zoom(this.zoomStep);const n=document.createElement("button");n.className="exploder-zoom-button",n.setAttribute("style",i.zoomButton),n.innerHTML='\n      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="5" y1="12" x2="19" y2="12"></line>\n      </svg>\n    ',n.onclick=()=>this.zoom(1/this.zoomStep),this.container.appendChild(s),this.container.appendChild(n),t.appendChild(this.container),this.applyLiquidGlass(),this.addHoverEffects(s,i),this.addHoverEffects(n,i)}zoom(t){const e=this.controls.object,i=this.controls.target,s=e.position.distanceTo(i)*t;if(s<.1)return;const n=e.position.clone().sub(i).normalize();e.position.copy(i).add(n.multiplyScalar(s)),this.controls.update()}addHoverEffects(t,e){t.onmouseenter=()=>{const i=t.getAttribute("style")||"";t.setAttribute("style",i+e.zoomButtonHover)},t.onmouseleave=()=>{t.setAttribute("style",e.zoomButton)},t.onmousedown=()=>{const i=t.getAttribute("style")||"";t.setAttribute("style",i+e.zoomButtonActive)},t.onmouseup=()=>{const i=t.getAttribute("style")||"";t.setAttribute("style",i.replace(e.zoomButtonActive,""))}}applyLiquidGlass(){this.liquidGlass=new k(this.container,{width:100,height:52})}dispose(){this.liquidGlass&&this.liquidGlass.dispose(),this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}exports.GLTFExploder=class{constructor(e,i,s,n,o={}){this.core=null,this.ui=null,this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.container=null,this.zoomControls=null,this.interactionManager=null,this.boundOnWheel=null,e instanceof t.Object3D&&i&&s&&n?(this.options=o,this.renderer=n,this.scene=i,this.camera=s,this.initCore(e,i,s,n,o)):(this.options=e,this.initializeAutoMode())}async initializeAutoMode(){const{viewport:i,model:s,modelUrl:n}=this.options,o="string"==typeof i?document.querySelector(i):i;this.container=o,this.container||(console.warn("GLTFExploder:  (viewport) body "),this.container=document.body),this.scene=new t.Scene,this.scene.background=new t.Color(16777215),this.camera=new t.PerspectiveCamera(45,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.renderer=new t.WebGLRenderer({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.toneMapping=t.ACESFilmicToneMapping,this.renderer.toneMappingExposure=E.EXPOSURE.DEFAULT,this.renderer.shadowMap.enabled=!1,this.container.appendChild(this.renderer.domElement),this.controls=new g(this.camera,this.renderer.domElement,this.scene),this.controls.enableRotate=!0,this.controls.enableZoom=!0,this.controls.enablePan=!0,this.controls.setGizmosVisible(!1),this.controls.cursorZoom=!0,this.options.wheelControlExplosion&&(this.controls.enableZoom=!1),this.scene.add(new t.AmbientLight(16777215,.4));const a=new t.Object3D;this.camera.add(a),this.scene.add(this.camera);const r=new t.DirectionalLight(16777215,.8);r.position.set(2,5,5),r.castShadow=!1;const h=new t.Object3D;h.position.set(0,0,-5),a.add(h),r.target=h,a.add(r);for(let e=0;e<3;e++){const i=e/3*Math.PI*2,s=new t.DirectionalLight(16777215,.4);s.position.set(5*Math.cos(i),5*Math.sin(i),2);const n=new t.Object3D;n.position.set(0,0,-5),a.add(n),s.target=n,a.add(s)}const l=new t.DirectionalLight(16777215,.64);l.position.set(5,5,2);const c=new t.Object3D;c.position.set(0,0,-5),a.add(c),l.target=c,a.add(l);const p=n||("string"==typeof s?s:null);if(p){(new e.GLTFLoader).load(p,t=>{const e=t.scene;e.traverse(t=>{t.isMesh&&(t.castShadow=!0,t.receiveShadow=!0)}),this.scene?.add(e),this.initCore(e,this.scene,this.camera,this.renderer,this.options)})}else s instanceof t.Object3D&&(s.traverse(t=>{t.isMesh&&(t.castShadow=!0,t.receiveShadow=!0)}),this.scene.add(s),this.initCore(s,this.scene,this.camera,this.renderer,this.options));this.animate(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){if(!this.container||!this.camera||!this.renderer)return;const e=this.container.clientWidth,i=this.container.clientHeight;this.camera instanceof t.PerspectiveCamera&&(this.camera.aspect=e/i,this.camera.updateProjectionMatrix()),this.renderer.setSize(e,i)}animate(){requestAnimationFrame(this.animate.bind(this)),this.controls&&this.controls.update(),this.ui&&this.ui.render&&this.ui.render(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}initCore(t,e,i,s,n){this.core&&this.core.dispose(),this.core=new D(t,e,i,s,n);const o=T(t);let a="Unknown Model";if(this.options.modelUrl?a=A(this.options.modelUrl):"string"==typeof n.model?a=A(n.model):t.name&&(a=t.name),!this.interactionManager){this.interactionManager=new L(e,i,s);const t=n.showHelpers??!0;this.handleHelperVisibilityChange(t),this.interactionManager.setOnSelect(t=>{if(t){const e=t.name||"";this.ui?.updateInfo?.(e,T(t))}else this.ui?.updateInfo?.(a,o)})}if(!1===n.createUI||this.ui?this.ui&&(this.ui.update(E.PROGRESS.DEFAULT),this.ui.updateInfo&&this.ui.updateInfo(a,o)):this.ui=Z(n,i,e,t,this.setProgress.bind(this),this.setMultiplier.bind(this),this.setExposure.bind(this),this.setMode.bind(this),this.setAxialVector.bind(this),this.handleModelChange.bind(this),this.handleHelperVisibilityChange.bind(this),t=>{this.interactionManager&&this.interactionManager.setEnabled(!t)},this.reset.bind(this),E.PROGRESS.DEFAULT,E.MULTIPLIER.DEFAULT,s.toneMappingExposure,this.core.getMode(),this.core.getAxialVector(),n.showHelpers??!0,a,o),this.container&&this.controls&&!this.zoomControls){const t=(n.uiStyle,{container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 260px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 20px;\n      padding: 16px;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 16px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 12px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 12px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    ",zoomContainer:"\n      position: absolute;\n      top: 24px;\n      left: 50%;\n      transform: translateX(-50%);\n      display: flex;\n      background: rgba(255, 255, 255, 0.3);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 12px;\n      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);\n      z-index: 1000;\n    ",zoomButton:"\n      width: 36px;\n      height: 36px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 8px;\n      color: var(--exploder-text-main);\n      cursor: pointer;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      padding: 0;\n      outline: none;\n    ",zoomButtonHover:"\n      background: rgba(255, 255, 255, 0.4);\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      color: var(--exploder-accent);\n    ",zoomButtonActive:"\n      transform: translateY(0) scale(0.95);\n      background: rgba(255, 255, 255, 0.2);\n    "});this.zoomControls=new W(this.container,this.controls,t)}this.options.wheelControlExplosion&&this.renderer&&(this.boundOnWheel||(this.boundOnWheel=this.onWheel.bind(this)),this.renderer.domElement.removeEventListener("wheel",this.boundOnWheel),this.renderer.domElement.addEventListener("wheel",this.boundOnWheel,{passive:!1}))}onWheel(t){if(!this.core)return;t.preventDefault();const e=t.deltaY>0?.05:-.05,i=this.core.getProgress(),s=Math.min(1,Math.max(0,i+e));this.setProgress(s)}handleModelChange(t){this.onModelChangeCallback?this.onModelChangeCallback(t):this.container&&this.scene&&this.loadModelAuto(t)}loadModelAuto(t){if(!this.scene)return;(new e.GLTFLoader).load(t,e=>{if(this.core){const t=this.core.model;t&&this.scene?.remove(t),this.core.dispose()}const i=e.scene;this.scene?.add(i),this.initCore(i,this.scene,this.camera,this.renderer,this.options),this.ui&&this.ui.updateModel&&this.ui.updateModel(t),t.startsWith("blob:")&&setTimeout(()=>URL.revokeObjectURL(t),1e3)})}handleHelperVisibilityChange(t){this.onHelperVisibilityChangeCallback&&this.onHelperVisibilityChangeCallback(t),this.interactionManager&&this.interactionManager.setHelperVisibility(t)}setModelChangeCallback(t){this.onModelChangeCallback=t}setHelperVisibilityChangeCallback(t){this.onHelperVisibilityChangeCallback=t}setModel(t){this.core?.setModel(t)}setHelperVisibility(t){this.handleHelperVisibilityChange(t),this.ui&&this.ui.updateHelperVisibility&&this.ui.updateHelperVisibility(t)}setInternalLightingVisible(t){this.core?.setInternalLightingVisible(t),this.ui&&this.ui.updateHelperVisibility&&this.ui.updateHelperVisibility(t)}setProgress(t){this.core?.setProgress(t),this.ui&&this.ui.update(t)}setMultiplier(t){this.core?.setMultiplier(t),this.ui&&this.ui.updateMultiplier&&this.ui.updateMultiplier(t)}setExposure(t){this.renderer&&(0===this.renderer.toneMapping&&(this.renderer.toneMapping=3),this.renderer.toneMappingExposure=t,this.core?.setInternalLightingExposure(t),this.ui&&this.ui.updateExposure&&this.ui.updateExposure(t))}setMode(t){this.core?.setMode(t),this.ui&&this.ui.updateMode&&this.ui.updateMode(t)}setAxialVector(t){this.core?.setAxialVector(t),this.ui&&this.ui.updateAxialVector&&this.ui.updateAxialVector(t)}reset(){if(this.core?.reset(),this.controls&&this.camera&&this.options.adaptModel&&(this.controls.reset(),this.core)){this.core.model&&(this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.controls.target.set(0,0,0),this.controls.update())}if(this.setExposure(E.EXPOSURE.DEFAULT),this.ui){this.ui.reset?.(),this.ui.update(E.PROGRESS.DEFAULT),this.ui.updateMultiplier?.(E.MULTIPLIER.DEFAULT),this.ui.updateExposure?.(E.EXPOSURE.DEFAULT),this.ui.updateMode?.(w.RADIAL),this.ui.updateAxialVector?.(new t.Vector3(0,1,0));const e=this.options.showHelpers??!0;this.ui.updateHelperVisibility?.(e),this.handleHelperVisibilityChange(e)}this.interactionManager&&(this.interactionManager.showAllMeshes(),this.interactionManager.deselectMesh())}getInteractionManager(){return this.interactionManager}setProgressChangeCallback(t){this.core?.setProgressChangeCallback(t)}getProgress(){return this.core?.getProgress()||0}showUI(){this.ui&&this.ui.show()}hideUI(){this.ui&&this.ui.hide()}dispose(){this.ui&&(this.ui.dispose(),this.ui=null),this.zoomControls&&(this.zoomControls.dispose(),this.zoomControls=null),this.interactionManager&&(this.interactionManager.dispose(),this.interactionManager=null),this.core?.dispose()}};
//# sourceMappingURL=gltf-exploder.cjs.js.map
