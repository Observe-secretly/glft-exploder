/*!
 * gltf-exploder v0.1.1
 * (c) 2026 limin
 * Released under the MIT License.
 */
import{Vector3 as e,Box3 as t,Sphere as i,AmbientLight as n,HemisphereLight as s,DirectionalLight as o,Mesh as l,Object3D as r,Scene as a,Color as h,PerspectiveCamera as d,WebGLRenderer as p,ACESFilmicToneMapping as c}from"three";import{GLTFLoader as u}from"three/examples/jsm/loaders/GLTFLoader.js";import{OrbitControls as m}from"three/examples/jsm/controls/OrbitControls.js";var x;!function(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===i&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(":root{--exploder-accent:#2563eb;--exploder-bg-main:#fff;--exploder-bg-sub:#f9fafb;--exploder-border:#e5e7eb;--exploder-text-main:#1f2937;--exploder-text-sub:#6b7280;--exploder-text-muted:#9ca3af}.exploder-ui-root{color:var(--exploder-text-main);font-family:Satoshi,Inter,-apple-system,sans-serif}.exploder-viewport-grid{background-image:linear-gradient(90deg,rgba(0,0,0,.03) 1px,transparent 0),linear-gradient(180deg,rgba(0,0,0,.03) 1px,transparent 0);background-size:40px 40px}.exploder-status-dot{background-color:#10b981;border-radius:50%;display:inline-block;height:8px;width:8px}.exploder-animate-pulse{animation:exploder-pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes exploder-pulse{0%,to{opacity:1}50%{opacity:.5}}.exploder-scrollbar::-webkit-scrollbar{width:4px}.exploder-scrollbar::-webkit-scrollbar-thumb{background:var(--exploder-border);border-radius:10px}.exploder-slider{-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;width:100%}.exploder-slider::-webkit-slider-runnable-track{background:#f3f4f6;border-radius:2px;height:4px}.exploder-slider::-webkit-slider-thumb{-webkit-appearance:none;background:var(--exploder-accent);border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.1);height:16px;margin-top:-6px;width:16px}.exploder-mode-btn{align-items:center;background:var(--exploder-bg-sub);border:1px solid transparent;border-radius:12px;color:var(--exploder-text-sub);cursor:pointer;display:flex;flex-direction:column;font-size:12px;font-weight:600;gap:6px;padding:10px;transition:all .2s}.exploder-mode-btn:hover{border-color:var(--exploder-border)}.exploder-mode-btn.active{background:#eff6ff;border-color:#bfdbfe;color:var(--exploder-accent)}.exploder-card{backdrop-filter:blur(12px);background:hsla(0,0%,100%,.9);border:1px solid rgba(229,231,235,.5);border-radius:16px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}"),function(e){e.RADIAL="radial",e.AXIAL="axial",e.NORMALIZED_RADIAL="normalized_radial",e.SIZE_WEIGHTED="size_weighted",e.HIERARCHICAL="hierarchical",e.FORCE_FIELD="force_field"}(x||(x={}));const g={PROGRESS:{DEFAULT:0,MIN:0,MAX:1,STEP:.01},MULTIPLIER:{DEFAULT:1,MIN:.1,MAX:5,STEP:.1},EXPOSURE:{DEFAULT:1,MIN:.1,MAX:6,STEP:.1},DEFAULT_DURATION:1e3,DEFAULT_MAX_DISTANCE:2,DEFAULT_ADAPT_SIZE:5,WEIGHTS:{BASE:.5,SCALE:1.5,FORCE_FIELD_OFFSET:.2},LIGHTS:{SCENE:{AMBIENT:.2,HEMISPHERE:.3,MAIN_DIRECTIONAL:.5,BACK_DIRECTIONAL:.3,SIDE_DIRECTIONAL:.2},INTERNAL:{AMBIENT:.4,HEMISPHERE:.4,DIRECTIONAL:.8}},DIRECTION:{MIN_LENGTH:.001,ANGLE_FACTOR:.017453292519943295,Z_FACTOR:.5,INDEX_ANGLE:.7853981633974483,XY_OFFSET:.2,Z_OFFSET:.1}};function y(t,i){const n=new e;t.getWorldPosition(n);const s=(new e).subVectors(n,i);if(s.length()<g.DIRECTION.MIN_LENGTH){const e=function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t%360)}(t.uuid||"");if(s.set(Math.cos(e*g.DIRECTION.ANGLE_FACTOR),Math.sin(e*g.DIRECTION.ANGLE_FACTOR),Math.cos(e*g.DIRECTION.Z_FACTOR)),t.parent){const e=t.parent.children.indexOf(t);e>=0&&(s.x+=Math.cos(e*g.DIRECTION.INDEX_ANGLE)*g.DIRECTION.XY_OFFSET,s.y+=Math.sin(e*g.DIRECTION.INDEX_ANGLE)*g.DIRECTION.XY_OFFSET,s.z+=(e%3-1)*g.DIRECTION.Z_OFFSET)}}return s.normalize()}function b(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error(`找不到容器元素: ${e}`);return t}return e}function E(e,t,i){return Math.max(t,Math.min(i,e))}class f{constructor(n,s,o,l,r={}){this.progress=g.PROGRESS.DEFAULT,this.multiplier=g.MULTIPLIER.DEFAULT,this.mode=x.RADIAL,this.originalPositions=new Map,this.originalRotations=new Map,this.originalScales=new Map,this.explodeDirections=new Map,this.axialDistances=new Map,this.sizeWeights=new Map,this.hierarchicalDepths=new Map,this.modelRadius=1,this.onProgressChangeCallback=null,this.explodableMeshes=[],this.internalLights=[],this.model=n,this.scene=s,this.camera=o,this.renderer=l,this.options={maxDistance:r.maxDistance??g.DEFAULT_MAX_DISTANCE,duration:r.duration??g.DEFAULT_DURATION,createUI:r.createUI??!0,viewport:r.viewport??document.body,container:r.container??document.body,uiType:r.uiType??"slider",hudContainer:r.hudContainer??document.body,uiStyle:r.uiStyle??{width:"200px",height:"30px",position:"bottom"},directionStrategy:r.directionStrategy??y,mode:r.mode??x.RADIAL,axialVector:r.axialVector??new e(0,1,0),adaptModel:r.adaptModel??!0,model:r.model??n,models:r.models??[],initialModel:r.initialModel??""},this.mode=this.options.mode,this.options.adaptModel&&this.adaptModelToScene();const a=(new t).setFromObject(this.model);this.modelCenter=a.getCenter(new e);const h=a.getBoundingSphere(new i);this.modelRadius=h.radius||1,this.saveOriginalTransforms(this.model),this.setupInternalLighting()}adaptModelToScene(){const i=(new t).setFromObject(this.model).getSize(new e),n=Math.max(i.x,i.y,i.z);if(n>0){const i=g.DEFAULT_ADAPT_SIZE/n;this.model.scale.multiplyScalar(i);const s=(new t).setFromObject(this.model).getCenter(new e);this.model.position.sub(s)}}setupInternalLighting(){const e=new n(16777215,g.LIGHTS.INTERNAL.AMBIENT);this.scene.add(e),this.internalLights.push(e);const t=new s(16777215,4473924,g.LIGHTS.INTERNAL.HEMISPHERE);this.scene.add(t),this.internalLights.push(t);const i=3*this.modelRadius;[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]].forEach(([e,t,n])=>{const s=new o(16777215,g.LIGHTS.INTERNAL.DIRECTIONAL);s.position.set(this.modelCenter.x+e*i,this.modelCenter.y+t*i,this.modelCenter.z+n*i),s.target=this.model,this.scene.add(s),this.internalLights.push(s)})}setInternalLightingVisible(e){this.internalLights.forEach(t=>{t.visible=e}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}setInternalLightingExposure(e){this.internalLights.forEach(t=>{t instanceof n?t.intensity=g.LIGHTS.INTERNAL.AMBIENT*e:t instanceof s?t.intensity=g.LIGHTS.INTERNAL.HEMISPHERE*e:t instanceof o&&(t.intensity=g.LIGHTS.INTERNAL.DIRECTIONAL*e)}),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}calculateAxialDistances(){const e=this.options.axialVector.clone().normalize(),i=(new t).setFromObject(this.model),n=i.min.dot(e),s=i.max.dot(e),o=Math.abs(s-n),l=o>1e-4?1/o:1;for(const t of this.explodableMeshes){const i=this.originalPositions.get(t);if(i){const n=i.clone().sub(this.modelCenter).dot(e);this.axialDistances.set(t,n*l)}}}saveOriginalTransforms(e){this.traverseAndSave(e),this.calculateAxialDistances(),this.calculateSizeWeights(),this.calculateHierarchicalDepths()}calculateHierarchicalDepths(){let e=0;const t=new Map;for(const i of this.explodableMeshes){let n=0,s=i.parent;for(;s&&s!==this.model;)n++,s=s.parent;t.set(i,n),e=Math.max(e,n)}const i=e>0?1/e:1;for(const[e,n]of t)this.hierarchicalDepths.set(e,g.WEIGHTS.BASE+n*i*g.WEIGHTS.SCALE)}calculateSizeWeights(){let t=0;const i=new Map;for(const n of this.explodableMeshes)if(n instanceof l){const s=n.geometry;s.boundingBox||s.computeBoundingBox();const o=s.boundingBox;if(o){const s=new e;o.getSize(s);const l=s.x*s.y*s.z;i.set(n,l),t=Math.max(t,l)}}const n=t>0?1/t:1;for(const[e,t]of i)this.sizeWeights.set(e,g.WEIGHTS.BASE+t*n*g.WEIGHTS.SCALE)}traverseAndSave(t){if(!t.visible)return;const i=new e;if(t.getWorldPosition(i),this.originalPositions.set(t,i.clone()),t.rotation&&this.originalRotations.set(t,t.rotation.clone()),t.scale&&this.originalScales.set(t,t.scale.clone()),"isMesh"in t&&!0===t.isMesh){this.explodableMeshes.push(t);const e=this.options.directionStrategy(t,this.modelCenter);this.explodeDirections.set(t,e)}t.children.forEach(e=>{this.traverseAndSave(e)})}setModel(n){this.reset(),this.model=n,this.options.adaptModel&&this.adaptModelToScene();const s=(new t).setFromObject(this.model);this.modelCenter=s.getCenter(new e);const o=s.getBoundingSphere(new i);this.modelRadius=o.radius||1,this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.saveOriginalTransforms(this.model),this.updateInternalLighting(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateInternalLighting(){const e=3*this.modelRadius,t=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=this.internalLights.filter(e=>e instanceof o);i.length===t.length?i.forEach((i,n)=>{const[s,o,l]=t[n];i.position.set(this.modelCenter.x+s*e,this.modelCenter.y+o*e,this.modelCenter.z+l*e),i.target=this.model}):(this.internalLights.forEach(e=>{this.scene.remove(e),e.dispose&&e.dispose()}),this.internalLights=[],this.setupInternalLighting())}setProgress(e){this.progress=E(e,g.PROGRESS.MIN,g.PROGRESS.MAX),this.updateExplodedPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress),this.renderer.render(this.scene,this.camera)}updateExplodedPositions(){for(const e of this.explodableMeshes){const t=this.originalPositions.get(e),i=this.explodeDirections.get(e);if(t&&i){const n=this.modelRadius*this.options.maxDistance*this.progress*this.multiplier,s=t.clone();switch(this.mode){case x.RADIAL:s.add(i.clone().multiplyScalar(n));break;case x.AXIAL:{const t=this.axialDistances.get(e)||0,i=this.options.axialVector.clone().normalize();s.add(i.multiplyScalar(t*this.modelRadius*this.options.maxDistance*this.progress*this.multiplier));break}case x.NORMALIZED_RADIAL:{const e=t.clone().sub(this.modelCenter);s.add(e.multiplyScalar(this.options.maxDistance*this.progress*this.multiplier));break}case x.SIZE_WEIGHTED:{const t=this.sizeWeights.get(e)||1;s.add(i.clone().multiplyScalar(n*t));break}case x.HIERARCHICAL:{const t=this.hierarchicalDepths.get(e)||1;s.add(i.clone().multiplyScalar(n*t));break}case x.FORCE_FIELD:{const t=this.originalPositions.get(e);if(t){const e=1/(t.clone().sub(this.modelCenter).length()/this.modelRadius+g.WEIGHTS.FORCE_FIELD_OFFSET);s.add(i.clone().multiplyScalar(n*e))}break}}e.parent&&e.parent.worldToLocal(s),e.position.copy(s)}}}setMode(e){this.mode=e,this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMode(){return this.mode}setAxialVector(e){this.options.axialVector.copy(e),this.calculateAxialDistances(),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getAxialVector(){return this.options.axialVector}reset(){this.progress=0,this.resetToOriginalPositions(),this.onProgressChangeCallback&&this.onProgressChangeCallback(this.progress)}resetToOriginalPositions(){for(const e of this.explodableMeshes){const t=this.originalPositions.get(e),i=this.originalRotations.get(e),n=this.originalScales.get(e);if(t){const i=t.clone();e.parent&&e.parent.worldToLocal(i),e.position.copy(i)}i&&e.rotation&&e.rotation.set(i.x,i.y,i.z),n&&e.scale&&e.scale.set(n.x,n.y,n.z)}}setProgressChangeCallback(e){this.onProgressChangeCallback=e}setMultiplier(e){this.multiplier=E(e,g.MULTIPLIER.MIN,g.MULTIPLIER.MAX),this.updateExplodedPositions(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}getMultiplier(){return this.multiplier}getProgress(){return this.progress}getModelCenter(){return this.modelCenter.clone()}getOptions(){return this.options}dispose(){this.internalLights.forEach(e=>{this.scene.remove(e),e.dispose&&e.dispose()}),this.internalLights=[],this.reset(),this.originalPositions.clear(),this.originalRotations.clear(),this.originalScales.clear(),this.explodeDirections.clear(),this.sizeWeights.clear(),this.axialDistances.clear(),this.hierarchicalDepths.clear(),this.explodableMeshes=[],this.onProgressChangeCallback=null}}class S{constructor(e,t,i=g.PROGRESS.DEFAULT,n={}){this.handleSliderChange=e=>{const t=parseFloat(e.target.value);this.onProgressChange(t)},this.handleReset=()=>{this.update(0),this.onProgressChange(0)},this.onProgressChange=t,this.styles={container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 320px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 32px;\n      padding: 24px;\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 20px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 16px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    "},this.element=document.createElement("div");!e||e===document.body||"body"===e?this.applyStyle(this.element,this.styles.container):this.applyStyle(this.element,"\n        width: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        border-radius: 4px;\n        padding: 12px 16px;\n        color: #ffffff;\n        font-family: -apple-system, sans-serif;\n        box-sizing: border-box;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      "),this.label=document.createElement("label"),this.label.textContent="爆炸视图",this.applyStyle(this.label,this.styles.label),this.element.appendChild(this.label),this.slider=document.createElement("input"),this.slider.type="range",this.slider.min=g.PROGRESS.MIN.toString(),this.slider.max=g.PROGRESS.MAX.toString(),this.slider.step=g.PROGRESS.STEP.toString(),this.slider.value=i.toString(),this.applyStyle(this.slider,this.styles.slider),this.element.appendChild(this.slider),this.resetButton=document.createElement("button"),this.resetButton.textContent="重置",this.applyStyle(this.resetButton,this.styles.button),this.element.appendChild(this.resetButton),this.slider.addEventListener("input",this.handleSliderChange),this.resetButton.addEventListener("click",this.handleReset);const s="string"==typeof e?document.querySelector(e):e;s?s.appendChild(this.element):document.body.appendChild(this.element)}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}updateHelperVisibility(e){}update(e){this.slider.value=e.toString()}dispose(){this.slider.removeEventListener("input",this.handleSliderChange),this.resetButton.removeEventListener("click",this.handleReset),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=t.replace(/\s+/g," ").trim();e.style.cssText=i}}class C{constructor(t,i,n,s,o,l,r,a=g.MULTIPLIER.DEFAULT,h=g.EXPOSURE.DEFAULT,d=x.RADIAL,p=new e(0,1,0),c=!0,u=[],m,y={}){this.modeButtons=new Map,this.onMultiplierChange=i,this.onExposureChange=n,this.onModeChange=s,this.onAxialChange=o,this.onModelChange=l,this.onHelperVisibilityChange=r,this.styles={container:"\n      position: absolute;\n      top: 24px;\n      right: 24px;\n      width: 320px;\n      max-height: calc(100vh - 48px);\n      overflow-y: auto;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 32px;\n      padding: 24px;\n    ",section:"\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    ",sectionHeader:"\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 20px;\n    ",title:"\n      font-family: 'General Sans', sans-serif;\n      font-weight: 700;\n      font-size: 14px;\n      letter-spacing: -0.01em;\n      margin: 0;\n      color: var(--exploder-text-main);\n    ",labelContainer:"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ",label:"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    ",value:"\n      font-size: 12px;\n      font-family: 'JetBrains Mono', monospace;\n      font-weight: 600;\n      color: var(--exploder-accent);\n    ",slider:"\n      width: 100%;\n    ",hint:"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      margin-top: 4px;\n    ",grid:"\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n    ",select:"\n      width: 100%;\n      padding: 10px 12px;\n      background: var(--exploder-bg-sub);\n      border: 1px solid var(--exploder-border);\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 500;\n      color: var(--exploder-text-main);\n      outline: none;\n      cursor: pointer;\n      appearance: none;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 12px center;\n    ",buttonReset:"\n      width: 100%;\n      padding: 16px;\n      background: #111827;\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 8px;\n      cursor: pointer;\n      transition: all 0.2s;\n      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n    ",buttonResetHover:"\n      background: #000000;\n      transform: translateY(-1px);\n    ",buttonResetActive:"\n      transform: scale(0.98);\n    "},this.element=document.createElement("aside"),this.element.className="exploder-ui-root exploder-card exploder-scrollbar",this.applyStyle(this.element,this.styles.container);const b=document.createElement("div");this.applyStyle(b,this.styles.sectionHeader),b.innerHTML=`\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M2 12h20M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10 10 10 0 0 1-10-10 10 10 0 0 1 10-10z"/></svg>\n      <h3 style="${this.styles.title}">参数控制面板</h3>\n    `,this.element.appendChild(b);const E=document.createElement("div");if(this.applyStyle(E,"display: flex; flex-direction: column; gap: 32px; flex: 1;"),this.element.appendChild(E),u&&u.length>0){const e=this.createSection("模型资源","选择需要展示的 3D 资产"),t=document.createElement("select");this.modelSelect=t,t.className="exploder-select",this.applyStyle(t,this.styles.select),u.forEach(e=>{const i=document.createElement("option"),n="string"==typeof e?e:e.value;i.value=n,i.textContent="string"==typeof e?e.split("/").pop()||e:e.label,n===m&&(i.selected=!0),t.appendChild(i)}),e.appendChild(t),E.appendChild(e)}const f=this.createSection("爆炸系数","调整组件之间分离的距离倍数"),S=this.createLabelWrapper("分离倍数");this.multiplierDisplay=document.createElement("span"),this.multiplierDisplay.className="exploder-value",this.applyStyle(this.multiplierDisplay,this.styles.value),this.multiplierDisplay.textContent=`${a.toFixed(1)}x`,S.appendChild(this.multiplierDisplay),f.insertBefore(S,f.firstChild),this.multiplierSlider=document.createElement("input"),this.multiplierSlider.type="range",this.multiplierSlider.className="exploder-slider",this.multiplierSlider.min=g.MULTIPLIER.MIN.toString(),this.multiplierSlider.max=g.MULTIPLIER.MAX.toString(),this.multiplierSlider.step=g.MULTIPLIER.STEP.toString(),this.multiplierSlider.value=a.toString(),this.applyStyle(this.multiplierSlider,this.styles.slider),f.appendChild(this.multiplierSlider),E.appendChild(f);const C=this.createSection("环境亮度","调整 3D 场景的光照表现"),M=this.createLabelWrapper("渲染亮度");this.exposureDisplay=document.createElement("span"),this.exposureDisplay.className="exploder-value",this.applyStyle(this.exposureDisplay,this.styles.value),this.exposureDisplay.textContent=h.toFixed(1),M.appendChild(this.exposureDisplay),C.insertBefore(M,C.firstChild),this.exposureSlider=document.createElement("input"),this.exposureSlider.type="range",this.exposureSlider.className="exploder-slider",this.exposureSlider.min=g.EXPOSURE.MIN.toString(),this.exposureSlider.max=g.EXPOSURE.MAX.toString(),this.exposureSlider.step=g.EXPOSURE.STEP.toString(),this.exposureSlider.value=h.toString(),this.applyStyle(this.exposureSlider,this.styles.slider),C.appendChild(this.exposureSlider),E.appendChild(C);const v=this.createSection("爆炸模式","选择不同的组件分离算法"),A=document.createElement("div");this.applyStyle(A,this.styles.grid);[{id:x.RADIAL,label:"径向模式",icon:"M12 3v3m0 12v3M3 12h3m12 0h3M5.6 5.6l2.1 2.1m8.6 8.6l2.1 2.1M5.6 18.4l2.1-2.1m8.6-8.6l2.1-2.1"},{id:x.NORMALIZED_RADIAL,label:"归一化径向",icon:"M21 3h-6M3 21h6M3 3v6M21 21v-6M3 3l7.5 7.5M21 21l-7.5-7.5"},{id:x.AXIAL,label:"轴向模式",icon:"M7 7h10M7 12h10M7 17h10"},{id:x.FORCE_FIELD,label:"力场式",icon:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0 M12 12m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0"},{id:x.SIZE_WEIGHTED,label:"尺寸加权",icon:"M3 6h18M7 12h10M10 18h4"},{id:x.HIERARCHICAL,label:"装配树级",icon:"M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"}].forEach(e=>{const t=document.createElement("div");t.className="exploder-mode-btn "+(d===e.id?"active":""),t.innerHTML=`\n        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="${e.icon}"/></svg>\n        <span>${e.label}</span>\n      `,t.onclick=()=>this.handleModeClick(e.id),A.appendChild(t),this.modeButtons.set(e.id,t)}),v.appendChild(A),this.axialContainer=document.createElement("div"),this.applyStyle(this.axialContainer,"margin-top: 12px; display: "+(d===x.AXIAL?"block":"none")),this.axialSelect=document.createElement("select"),this.applyStyle(this.axialSelect,this.styles.select),[{v:"0,1,0",l:"Y 轴 (垂直)"},{v:"1,0,0",l:"X 轴 (横向)"},{v:"0,0,1",l:"Z 轴 (纵向)"}].forEach(e=>{const t=document.createElement("option");t.value=e.v,t.textContent=e.l,e.v===`${p.x},${p.y},${p.z}`&&(t.selected=!0),this.axialSelect.appendChild(t)}),this.axialContainer.appendChild(this.axialSelect),v.appendChild(this.axialContainer),E.appendChild(v);const I=this.createSection("辅助视图","控制场景辅助元素的显示"),L=document.createElement("label");this.applyStyle(L,"display: flex; align-items: center; gap: 10px; cursor: pointer; user-select: none;"),this.helperToggle=document.createElement("input"),this.helperToggle.type="checkbox",this.helperToggle.checked=c,this.helperToggle.style.width="16px",this.helperToggle.style.height="16px",this.helperToggle.style.accentColor="var(--exploder-accent)",L.appendChild(this.helperToggle);const w=document.createElement("span");w.textContent="显示网格与坐标轴标签",this.applyStyle(w,"font-size: 12px; font-weight: 500; color: var(--exploder-text-sub);"),L.appendChild(w),I.appendChild(L),E.appendChild(I);const R=document.createElement("div");this.applyStyle(R,"padding-top: 12px; margin-top: auto;"),this.resetButton=document.createElement("button"),this.resetButton.className="exploder-button-reset",this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.innerHTML='\n      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>\n      <span>重置视图与参数</span>\n    ',this.resetButton.onmouseenter=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),this.resetButton.onmouseleave=()=>this.applyStyle(this.resetButton,this.styles.buttonReset),this.resetButton.onmousedown=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetActive),this.resetButton.onmouseup=()=>this.applyStyle(this.resetButton,this.styles.buttonReset+this.styles.buttonResetHover),R.appendChild(this.resetButton),this.element.appendChild(R),this.multiplierSlider.oninput=e=>{const t=parseFloat(e.target.value);this.updateMultiplier(t),this.onMultiplierChange(t)},this.exposureSlider.oninput=e=>{const t=parseFloat(e.target.value);this.updateExposure(t),this.onExposureChange?.(t)},this.modelSelect&&(this.modelSelect.onchange=e=>this.onModelChange?.(e.target.value)),this.axialSelect.onchange=t=>{const[i,n,s]=t.target.value.split(",").map(Number);this.onAxialChange?.(new e(i,n,s))},this.helperToggle.onchange=e=>this.onHelperVisibilityChange?.(e.target.checked),this.resetButton.onclick=()=>{};(("string"==typeof t?document.querySelector(t):t)||document.body).appendChild(this.element)}createSection(e,t){const i=document.createElement("section");this.applyStyle(i,this.styles.section);const n=document.createElement("label");this.applyStyle(n,this.styles.label),n.textContent=e,i.appendChild(n);const s=document.createElement("p");return this.applyStyle(s,this.styles.hint),s.textContent=t,i.appendChild(s),i}createLabelWrapper(e){const t=document.createElement("div");this.applyStyle(t,this.styles.labelContainer);const i=document.createElement("span");return this.applyStyle(i,this.styles.label),i.textContent=e,t.appendChild(i),t}handleModeClick(e){this.updateMode(e),this.onModeChange?.(e)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}show(){this.element.style.display="flex"}hide(){this.element.style.display="none"}update(e){}updateMultiplier(e){this.multiplierSlider.value=e.toString(),this.multiplierDisplay.textContent=`${e.toFixed(1)}x`}updateExposure(e){this.exposureSlider.value=e.toString(),this.exposureDisplay.textContent=e.toFixed(1)}updateMode(e){this.modeButtons.forEach((t,i)=>{i===e?t.classList.add("active"):t.classList.remove("active")}),this.axialContainer&&(this.axialContainer.style.display=e===x.AXIAL?"block":"none")}updateHelperVisibility(e){this.helperToggle&&(this.helperToggle.checked=e)}updateAxialVector(e){this.axialSelect&&(this.axialSelect.value=`${e.x},${e.y},${e.z}`)}dispose(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class M{constructor(e,t,i=g.PROGRESS.DEFAULT){this.onProgressChange=t,this.element=document.createElement("div"),this.element.className="exploder-hud-root",this.applyStyle(this.element,"\n      position: absolute;\n      bottom: 40px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 80%;\n      max-width: 600px;\n      z-index: 100;\n      pointer-events: auto;\n    ");const n=document.createElement("div");n.className="exploder-card",this.applyStyle(n,"\n      display: flex;\n      align-items: center;\n      gap: 20px;\n      padding: 12px 24px;\n      border-radius: 16px;\n      background: rgba(255, 255, 255, 0.9);\n      backdrop-filter: blur(12px);\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n      border: 1px solid rgba(229, 231, 235, 0.5);\n    "),this.element.appendChild(n);const s=document.createElement("div");this.applyStyle(s,"\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    "),n.appendChild(s);const o=document.createElement("div");this.applyStyle(o,"\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    ");const l=document.createElement("span");l.textContent="当前播放进度",this.applyStyle(l,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),this.valueDisplay=document.createElement("span"),this.valueDisplay.textContent=`${Math.round(100*i)}%`,this.applyStyle(this.valueDisplay,"\n      font-size: 11px;\n      font-weight: 700;\n      color: var(--exploder-accent);\n    "),o.appendChild(l),o.appendChild(this.valueDisplay),s.appendChild(o),this.slider=document.createElement("input"),this.slider.type="range",this.slider.className="exploder-slider",this.slider.min=g.PROGRESS.MIN.toString(),this.slider.max=g.PROGRESS.MAX.toString(),this.slider.step=g.PROGRESS.STEP.toString(),this.slider.value=i.toString(),this.applyStyle(this.slider,"\n      width: 100%;\n      height: 4px;\n      cursor: pointer;\n    "),s.appendChild(this.slider),this.slider.oninput=e=>{const t=parseFloat(e.target.value);this.update(t),this.onProgressChange(t)};(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element)}update(e){this.slider.value=e.toString(),this.valueDisplay.textContent=`${Math.round(100*e)}%`}show(){this.element.style.display="block"}hide(){this.element.style.display="none"}dispose(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}}class v{constructor(e,t="加载中..."){this.element=document.createElement("div"),this.element.className="exploder-info-hud",this.applyStyle(this.element,"\n      position: absolute;\n      top: 24px;\n      left: 24px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      pointer-events: none;\n      z-index: 100;\n    ");const i=document.createElement("div");i.className="exploder-card",this.applyStyle(i,"\n      padding: 12px 16px;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      pointer-events: auto;\n    ");const n=document.createElement("div");this.applyStyle(n,"\n      width: 40px;\n      height: 40px;\n      background: var(--exploder-accent);\n      color: white;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    "),n.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>';const s=document.createElement("div");this.applyStyle(s,"\n      display: flex;\n      flex-direction: column;\n    "),this.modelNameDisplay=document.createElement("span"),this.modelNameDisplay.textContent=t,this.applyStyle(this.modelNameDisplay,"\n      font-size: 12px;\n      font-weight: 700;\n      color: var(--exploder-text-main);\n      line-height: 1;\n    ");const o=document.createElement("span");o.textContent="GLB 3D 资产已就绪",this.applyStyle(o,"\n      font-size: 10px;\n      color: var(--exploder-text-muted);\n      font-weight: 700;\n      margin-top: 6px;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    "),s.appendChild(this.modelNameDisplay),s.appendChild(o),i.appendChild(n),i.appendChild(s),this.element.appendChild(i);const l=document.createElement("div");this.applyStyle(l,"\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.8);\n      backdrop-filter: blur(8px);\n      border: 1px solid rgba(229, 231, 235, 0.5);\n      border-radius: 12px;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n      width: fit-content;\n      pointer-events: auto;\n    ");const r=document.createElement("span");r.className="exploder-status-dot exploder-animate-pulse";const a=document.createElement("span");a.textContent="WebGL 2.0 渲染引擎已启动",this.applyStyle(a,"\n      font-size: 10px;\n      font-weight: 700;\n      color: var(--exploder-text-sub);\n      text-transform: uppercase;\n      letter-spacing: 0.02em;\n    "),l.appendChild(r),l.appendChild(a),this.element.appendChild(l);(("string"==typeof e?document.querySelector(e):e)||document.body).appendChild(this.element)}setModelName(e){this.modelNameDisplay.textContent=e}dispose(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}applyStyle(e,t){const i=e.getAttribute("style")||"";e.setAttribute("style",i+t)}}var A;!function(e){e.SLIDER="slider",e.PANEL="panel"}(A||(A={}));class I{constructor(t,i,n,s,o,l,r,a,h,d=g.PROGRESS.DEFAULT,p=g.MULTIPLIER.DEFAULT,c=g.EXPOSURE.DEFAULT,u=x.RADIAL,m=new e(0,1,0),y=!0,b,E,f){if(this.element=t,this.panel=new C(t,s,o,l,r,a,h,p,c,u,m,y,b,E,f),this.hud=new M(i,n,d),i){const e=E?E.split("/").pop()||E:"示例模型";this.infoHUD=new v(i,e)}}show(){this.panel.show(),this.hud.show(),this.infoHUD?.element&&(this.infoHUD.element.style.display="flex")}hide(){this.panel.hide(),this.hud.hide(),this.infoHUD?.element&&(this.infoHUD.element.style.display="none")}update(e){this.panel.update(e),this.hud.update(e)}updateMultiplier(e){this.panel.updateMultiplier(e)}updateExposure(e){this.panel.updateExposure(e)}updateMode(e){this.panel.updateMode(e)}updateAxialVector(e){this.panel.updateAxialVector(e)}updateHelperVisibility(e){this.panel.updateHelperVisibility(e)}updateModel(e){if(this.infoHUD){const t=e.split("/").pop()||e;this.infoHUD.setModelName(t)}this.panel.updateModel&&this.panel.updateModel(e)}dispose(){this.panel.dispose(),this.hud.dispose(),this.infoHUD?.dispose()}}class L{constructor(e,t,i,n,s={}){this.core=null,this.ui=null,this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.container=null,e instanceof r&&t&&i&&n?(this.options=s,this.renderer=n,this.scene=t,this.camera=i,this.initCore(e,t,i,n,s)):(this.options=e,this.initializeAutoMode())}async initializeAutoMode(){const{viewport:e,model:t}=this.options,i="string"==typeof e?document.querySelector(e):e;this.container=i,this.container||(console.warn("GLTFExploder: 未找到视口容器 (viewport)，将使用 body 作为默认容器"),this.container=document.body),this.scene=new a,this.scene.background=new h(16777215),this.camera=new d(45,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.renderer=new p({antialias:!0,alpha:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.toneMapping=c,this.renderer.toneMappingExposure=g.EXPOSURE.DEFAULT,this.container.appendChild(this.renderer.domElement),this.controls=new m(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.scene.add(new n(16777215,.6));const s=new o(16777215,1);if(s.position.set(5,10,7.5),this.scene.add(s),"string"==typeof t){(new u).load(t,e=>{const t=e.scene;this.scene?.add(t),this.initCore(t,this.scene,this.camera,this.renderer,this.options)})}else t instanceof r&&(this.scene.add(t),this.initCore(t,this.scene,this.camera,this.renderer,this.options));this.animate(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){if(!this.container||!this.camera||!this.renderer)return;const e=this.container.clientWidth,t=this.container.clientHeight;this.camera instanceof d&&(this.camera.aspect=e/t,this.camera.updateProjectionMatrix()),this.renderer.setSize(e,t)}animate(){requestAnimationFrame(this.animate.bind(this)),this.controls&&this.controls.update(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}initCore(t,i,n,s,o){this.core=new f(t,i,n,s,o),!1!==o.createUI&&(this.ui=function(t,i,n,s,o,l,r,a,h=g.PROGRESS.DEFAULT,d=g.MULTIPLIER.DEFAULT,p=g.EXPOSURE.DEFAULT,c=x.RADIAL,u=new e(0,1,0),m=!0){if(!1===t.createUI)return null;const y=t.container?b(t.container):document.body;switch(t.uiType||A.SLIDER){case A.PANEL:const e=t.hudContainer?b(t.hudContainer):document.body;return new I(y,e,i,n,s,o,l,r,a,h,d,p,c,u,m,t.models,t.initialModel,t.uiStyle);case A.SLIDER:default:return new S(y,i,h,t.uiStyle)}}(o,this.setProgress.bind(this),this.setMultiplier.bind(this),this.setExposure.bind(this),this.setMode.bind(this),this.setAxialVector.bind(this),this.handleModelChange.bind(this),this.handleHelperVisibilityChange.bind(this),g.PROGRESS.DEFAULT,g.MULTIPLIER.DEFAULT,s.toneMappingExposure,this.core.getMode(),this.core.getAxialVector(),!0))}handleModelChange(e){this.onModelChangeCallback?this.onModelChangeCallback(e):this.container&&this.scene&&this.loadModelAuto(e)}loadModelAuto(e){if(!this.scene)return;(new u).load(e,t=>{if(this.core){const e=this.core.model;e&&this.scene?.remove(e),this.core.dispose()}const i=t.scene;this.scene?.add(i),this.initCore(i,this.scene,this.camera,this.renderer,this.options),this.ui&&(this.ui.update(g.PROGRESS.DEFAULT),this.ui.updateModel&&this.ui.updateModel(e))})}handleHelperVisibilityChange(e){this.onHelperVisibilityChangeCallback&&this.onHelperVisibilityChangeCallback(e)}setModelChangeCallback(e){this.onModelChangeCallback=e}setHelperVisibilityChangeCallback(e){this.onHelperVisibilityChangeCallback=e}setModel(e){this.core?.setModel(e)}setInternalLightingVisible(e){this.core?.setInternalLightingVisible(e),this.ui&&this.ui.updateHelperVisibility&&this.ui.updateHelperVisibility(e)}setProgress(e){this.core?.setProgress(e),this.ui&&this.ui.update(e)}setMultiplier(e){this.core?.setMultiplier(e),this.ui&&this.ui.updateMultiplier&&this.ui.updateMultiplier(e)}setExposure(e){this.renderer&&(0===this.renderer.toneMapping&&(this.renderer.toneMapping=3),this.renderer.toneMappingExposure=e,this.core?.setInternalLightingExposure(e),this.ui&&this.ui.updateExposure&&this.ui.updateExposure(e))}setMode(e){this.core?.setMode(e),this.ui&&this.ui.updateMode&&this.ui.updateMode(e)}setAxialVector(e){this.core?.setAxialVector(e),this.ui&&this.ui.updateAxialVector&&this.ui.updateAxialVector(e)}reset(){this.core?.reset(),this.ui&&(this.ui.update(g.PROGRESS.DEFAULT),this.ui.updateMultiplier&&this.ui.updateMultiplier(g.MULTIPLIER.DEFAULT),this.ui.updateMode&&this.ui.updateMode(x.RADIAL))}setProgressChangeCallback(e){this.core?.setProgressChangeCallback(e)}getProgress(){return this.core?.getProgress()||0}showUI(){this.ui&&this.ui.show()}hideUI(){this.ui&&this.ui.hide()}dispose(){this.ui&&(this.ui.dispose(),this.ui=null),this.core?.dispose()}}export{L as GLTFExploder,A as UIType};
//# sourceMappingURL=gltf-exploder.esm.js.map
